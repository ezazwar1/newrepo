"use strict";function onPushNotification(t){}angular.module("GarnetRoom",["ionic","ngCordova","ngResource","ngCordovaOauth","LocalForageModule","ionic.contrib.ui.tdCards","monospaced.elastic","angularMoment","ui.slider"]).directive("grErrorImg",function(){return{restrict:"A",link:function(t,e,n){e.bind("error",function(){e.attr("src","images/error.png")})}}}).directive("grImg",["$timeout",function(t){return{restrict:"A",link:function(e,n,i){function o(e){return function(){e&&n.attr("src","images/error.png"),t(function(){ionic.requestAnimationFrame(function(){n[0].parentElement.style.transition="opacity ease 0.5s",n[0].parentElement.style.WebkitTransition="opacity ease 0.5s",n[0].parentElement.style.opacity=1,n[0].gr_deregisterWatch(),t(function(){n[0].parentElement.style.transition="none",n[0].parentElement.style.WebkitTransition="none"},500)})},100)}}n.bind("load",o(!1)),n.bind("error",o(!0)),n[0].gr_deregisterWatch=e.$watch("grImg",function(){n[0].parentElement.style.transition="none",n[0].parentElement.style.WebkitTransition="none",n[0].parentElement.style.opacity=0})}}}]).directive("grChatImg",["$timeout",function(t){return{restrict:"A",link:function(e,n,i){function o(e){return function(){e&&n.attr("src","images/error.png"),t(function(){ionic.requestAnimationFrame(function(){n[0].style.transition="opacity ease 0.5s",n[0].style.WebkitTransition="opacity ease 0.5s",n[0].style.opacity=1,n[0].gr_deregisterWatch(),t(function(){n[0].style.transition="none",n[0].style.WebkitTransition="none"},500)})},100)}}n.bind("load",o(!1)),n.bind("error",o(!0)),n[0].gr_deregisterWatch=e.$watch("grImg",function(){n[0].style.transition="none",n[0].style.WebkitTransition="none",n[0].style.opacity=0})}}}]).run(["CFG","IonicSrv","TDCardDelegate","$ionicPlatform","$rootScope","$state","$timeout","$ionicPopup","$ionicLoading","$http","$localForage","$cordovaEmailComposer","$cordovaSocialSharing","$ionicScrollDelegate","amMoment","CardsSrv","AuthSrv","LocSrv","EventsSrv","SyncSrv",function(t,e,n,i,o,r,a,s,l,c,d,u,p,g,h,f,m,v,b,y){function w(){x||(x=!0,o._urlCache={},o._user&&4===o._userProgress&&(b.stop(),y.stop(),v.stop(),ionic.Platform.isIOS()&&f.stop(),o.$broadcast("pauseEvent")))}function _(){x&&(x=!1,o._urlCache={},o._user&&4===o._userProgress&&(b.start(),y.start(),o._user.visible&&v.start(function(){f.start()})))}o._keyboardHeight=0,"en-US"===navigator.language?h.changeLocale("custom-en-us"):h.changeLocale("custom-en-gb");var x=!1;i.ready(function(){function e(){d.setItem("version",t.version).then(function(){i()},function(){o._toast("Local database error."),i()})}function i(){if(o._iosMargin=ionic.Platform.isWebView()&&ionic.Platform.isIOS()?20:0,ionic.Platform.isWebView()&&ionic.Platform.isAndroid()&&navigator.splashscreen.show(),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),cordova.plugins.Keyboard.disableScroll(!0)),ionic.Platform.isWebView()){if(m.start(),document.addEventListener("pause",w,!1),ionic.Platform.isIOS()&&document.addEventListener("resign",w,!1),document.addEventListener("resume",_,!1),ionic.Platform.isIOS()&&document.addEventListener("active",_,!1),"undefined"!=typeof shake&&shake.startWatch(function(){o.$evalAsync(function(){!o._detailModalActive&&o._undoCard&&r.is("app.home")&&(n.undoCardId(o._undoCard.cardId),o._cards.unshift(o._undoCard),o._undoCard=void 0)})},20,function(){}),ionic.Platform.isIOS()){var t=window.BackgroundFetch,e=function(){o._user&&o._user.visible?v.once(function(){f.once(function(){t.finish()})}):t.finish()},i=function(){};t.configure(e,i,{stopOnTerminate:!0})}}else!function(){if(!window.FB){var t=document.createElement("script");t.src=document.location.protocol+"//connect.facebook.net/en_US/sdk.js",t.async=!1,document.getElementById("fb-root").appendChild(t)}}(),a(function(){m.start()},500)}c.defaults.headers.common["x-gr-version"]=t.version,c.defaults.headers.common["x-gr-platform"]=ionic.Platform.isIOS()?"ios":"android",d.getItem("version").then(function(n){if("string"==typeof n){var i=t.version.split("."),r=t.minCompatibleVersion.split("."),a=n.split("."),s=1e6*parseInt(i[0],10)+1e3*parseInt(i[1],10)+parseInt(i[2],10),l=1e6*parseInt(r[0],10)+1e3*parseInt(r[1],10)+parseInt(r[2],10),c=1e6*parseInt(a[0],10)+1e3*parseInt(a[1],10)+parseInt(a[2],10);c>=l&&s>=c?e():o._clearLocalForage(e)}else o._clearLocalForage(e)},function(){o._clearLocalForage(e)})}),o._statusBarBlack=function(){ionic.Platform.isAndroid()&&StatusBar.backgroundColorByHexString("#000")},o._statusBarGarnet=function(){ionic.Platform.isAndroid()&&StatusBar.backgroundColorByHexString("#330516")},o._runTasks=function(t,e){t.length?t[t.length-1](function(){t.pop(),o._runTasks(t,e)}):e&&e()};var k=!1;o._showInstructionsModal=function(){k||(k=!0,o._instructionsModal=e.showModal(o,"fade-in","templates/modals/instructions.html",function(){"undefined"!=typeof StatusBar&&StatusBar.styleDefault(),o._statusBarBlack()}))},o._hideInstructionsModal=function(){"undefined"!=typeof StatusBar&&StatusBar.styleLightContent(),o._statusBarGarnet(),o._instructionsModal.hide(),a(function(){k=!1},10)},o._scrollTop=function(){g.scrollTop(!0)},o._scrollBottom=function(){g.scrollBottom(!0)};var M=0,S=0;o._toast=function(t,e){++M;var n=M,i=document.getElementById("toast");S+=e?2e4:5e3,o.$evalAsync(function(){i.style.display="block",a(function(){i.innerHTML+=t+"<br>",i.scrollTop=i.scrollHeight,i.style.opacity=.9,a(function(){n===M&&(i.style.opacity=0)},S-400,!1),a(function(){n===M&&(i.style.display="none",i.innerHTML="",S=0)},S,!1)})})},o._hideToast=function(){var t=document.getElementById("toast");t.style.opacity=0;var e=M;a(function(){e===M&&(t.style.display="none",t.innerHTML="",S=0)},400,!1)},o._clearLocalForage=function(t){d.clear().then(function(){t&&t()},function(){o._toast("Local database error."),t&&t()})},o._getItem=function(t,e){d.getItem(o._user.fb_id+t).then(function(t){e&&e(t)},function(){o._toast("Local database error."),e&&e()})},o._setItem=function(t,e,n){d.setItem(o._user.fb_id+t,e).then(function(){n&&n()},function(){o._toast("Local database error."),n&&n()})},o._removeItem=function(t,e){d.removeItem(o._user.fb_id+t).then(function(){e&&e()},function(){o._toast("Local database error."),e&&e()})},o._setItemTask=function(t,e){return function(n){o._setItem(t,e,function(){n()})}},o._removeItemTask=function(t){return function(e){o._removeItem(t,function(){e()})}};var I=!1;o._share=function(){p.share("Hey, have you tried Garnet Room?","",null,"http://garnetroom.co").then(function(t){I=!1},function(t){I=!1,o._toast("Unspecified error.")})};var P=!1;o._www=function(t,e){P||(P=!0,a(function(){var n=cordova.InAppBrowser.open(t,"_blank",e||ionic.Platform.isAndroid()?"location=yes,hardwareback=no":"location=no,hardwareback=no");n.addEventListener("exit",function(t){P=!1})}))},o._msToTime=function(t){return 2e3>t?t+" milliseconds":12e4>t?Math.round(t/1e3)+" seconds":72e5>t?Math.round(t/6e4)+" minutes":Math.round(t/36e5)+" hours"},o._imgUrl=function(e,n,i){i*=window.devicePixelRatio;for(var o,r,a=1/0,s=-(1/0),l=0;l<n.sizes.length;++l){var c=n.sizes[l]-i;c>=0&&a>c?(a=c,o=l):0>c&&c>s&&(s=c,r=l)}return i=a===1/0?n.sizes[r]:n.sizes[o],t.imgBase+"/"+t.imgPath+e+"/"+n._id+"_"+i+"."+n.ext},o._buildCard=function(t,e){t.type=e,t.score=0,t.picUrls=[];for(var n=0;n<t.pics.length;++n)t.picUrls.push(o._imgUrl(t._id,t.pics[n],window.innerWidth)),t.score+=t.pics[n].score,t.pics[n].up=!1,t.pics[n].down=!1;var i=80*window.devicePixelRatio;if(t.cons=[],t.cc_first){for(var r=o._user,n=0;n<t.cc_first.length;++n)for(var a=0;a<r.friends.length;++a)if(t.cc_first[n]===r.friends[a].id){t.cons.push({pic:"https://graph.facebook.com/"+r.friends[a].id+"/picture?width="+i+"&height="+i,name:r.friends[a].name,second:!1});break}for(var n=0;n<t.cc_second.length;++n)for(var a=0;a<r.friends.length;++a)if(t.cc_second[n]===r.friends[a].id){t.cons.push({pic:"https://graph.facebook.com/"+r.friends[a].id+"/picture?width="+i+"&height="+i,name:r.friends[a].name,second:!0});break}}if(t.birth&&(t.age=o._getAge(t.birth)),t.height){var s=Math.floor(t.height/30.48),l=Math.round(t.height/2.54-12*Math.floor(t.height/30.48));12===l&&(++s,l=0),t.heightFt=s+"' "+l+'"'}t.dist&&(t.distMi=Math.round(t.dist/1.60934))},o._buildPics=function(){var t=!o._picUrls;o._picUrls=[];for(var e=0,n=0;n<o._user.pics.length;++n)o._picUrls[n]=o._imgUrl(o._user._id,o._user.pics[n],o._picSize),e+=o._user.pics[n].score;if(o._user.score=e,document.images&&t&&o._picUrls.length){var i=new Image;i.src=o._picUrls[0]}},"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),o._getDistance=function(t,e){var n=6378,i=t[1].toRad(),o=e[1].toRad(),r=(e[1]-t[1]).toRad(),a=(e[0]-t[0]).toRad(),s=Math.sin(r/2)*Math.sin(r/2)+Math.cos(i)*Math.cos(o)*Math.sin(a/2)*Math.sin(a/2),l=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return n*l},o._getAge=function(t){var e=new Date(t),n=new Date,i=n.getFullYear(),o=i-e.getFullYear();return n>=new Date(i,e.getMonth(),e.getDate())?o:o-1},o._updateFlagCount=function(){var t=o._chats;o._flagCount=0;for(var e in t)t.hasOwnProperty(e)&&t[e].flag&&o._flagCount++},o._removeChat=function(e){var n=e.userId;s.show({title:"Unmatch "+e.name+"?",scope:o,buttons:[{text:"Cancel",type:"button-positive button-outline"},{text:"Confirm",type:"button-positive",onTap:function(t){return!0}}]}).then(function(i){i&&(l.show(),c["delete"](t.apiBase+"/user/"+n,{timeout:2e4}).then(function(t){n===o._curChatId&&r.is("app.chat")&&r.go("app.chats"),o._chats[n]&&(delete o._chats[n],o._updateFlagCount()),o._removeItem("c"+n,function(){o._removeItem("m"+n,function(){o._removeItem("d"+n,function(){o._removeItem("f"+n,function(){o._removeItem("p"+n,function(){l.hide()})})})})})},function(t){l.hide(),o._toast("Error unmatching "+e.name+". Please try again.")}))})},o._report=function(t){u.isAvailable().then(function(){var e={to:"support@garnetroom.co",subject:"Report-"+o._user.fb_id+"-"+t,isHtml:!1,body:"Please specify the issue below. We will not tell the member you reported them.\n\n"};u.open(e).then(null,function(){})},function(){return o._toast("Error opening email composer. Please make sure email is set up correctly.")})},o._resetChats=function(t){var e=[],n=o._user.fb_id;d.iterate(function(t,i){(i.indexOf(n+"c")>-1||i.indexOf(n+"d")>-1||i.indexOf(n+"f")>-1||i.indexOf(n+"p")>-1||i.indexOf(n+"m")>-1)&&!function(t){e.push(function(e){d.removeItem(t).then(function(){e()},function(){e()})})}(i)}).then(function(){o._runTasks(e,function(){t&&t()})},function(){o._runTasks(e,function(){t&&t()})})};var C,T=!1,L=!1;o._syncChats=function(){function e(n){if(L=!1,!o._user||C!==o._user._id||o._user.waitlist)return void(T=!1);var i=Date.now(),s=[];for(var l in o._chats)if(o._chats.hasOwnProperty(l)){var d=o._chats[l];if(n&&(d.sync=!0),s.length>=t.syncChunk)continue;d.sync&&(!d.lastSync||d.lastSync+t.chatsSyncInterval<i)&&(s.push(l),delete d.sync)}s.length?c.post(t.apiBase+"/users",{users:s},{timeout:2e4,gr_auto:!0}).then(function(n){o.$evalAsync(function(){for(var l=[],c=n.data.users?n.data.users:[],d=0;d<s.length;++d)if(o._chats[s[d]]){var u={lastSync:i};o._chats[s[d]].lastSync=i;for(var p=!0,g=0;g<c.length;++g){var h=c[g];if(s[d]===h._id){o._chats[h._id]&&(h.pic?(o._chats[h._id].picSm=u.picSm=o._imgUrl(h._id,h.pic,t.picSmSize),o._chats[h._id].picMd=u.picMd=o._imgUrl(h._id,h.pic,t.picMdSize),o._detailCache[h._id]&&delete o._detailCache[h._id]):(p=!1,h._id===o._curChatId&&r.is("app.chat")&&o.$broadcast("removedChat"),o._chats[h._id]&&(delete o._chats[h._id],o._updateFlagCount()),l.push(o._removeItemTask("c"+h._id)),l.push(o._removeItemTask("m"+h._id)),l.push(o._removeItemTask("d"+h._id)),l.push(o._removeItemTask("f"+h._id)),l.push(o._removeItemTask("p"+h._id))));break}}p&&l.push(o._setItemTask("p"+s[d],u))}o._runTasks(l,function(){a(function(){e()},100)})})},function(t){a(function(){e()},100)}):L?a(function(){e()},100):(T=!1,L=!1)}return o._user?void(T?L=!0:(C=o._user._id,T=!0,L=!1,e(!0))):(T=!1,void(L=!1))},o._openChat=function(t,e){t.msgs?(o._curChatId=t.userId,r.go("app.chat"),e&&e()):o._getItem("m"+t.userId,function(n){o._curChatId=t.userId,n?t.msgs=n:t.msgs=[],r.go("app.chat"),e&&e()})},o._removeCard=function(e){var n=o._cards,i=o._tempCards,r=o._cards[e]._id,a=o._cards[e].cardId,s=[],l=[];i.push(o._cards.splice(e,1)[0]),c.post(t.apiBase+"/pass/"+r,{up:s,down:l},{timeout:2e4}).then(function(t){for(var e=0;e<i.length;++e)if(i[e].cardId===a){i.splice(e,1);break}},function(t){for(var e=0;e<i.length;++e)if(i[e].cardId===a){n.unshift(i.splice(e,1)[0]);break}})}}]).factory("HttpInterceptor",["CFG","$q","$injector",function(t,e,n){return{responseError:function(i){if(i.status>=480&&i.status<500)return e.reject(i);switch(i.status){case-1:case 0:if(i.config.url===t.apiBase+"/events")break;var o=n.get("$rootScope");o._toast("Internet connection interrupted.");break;case 460:if(i.config.gr_auto)break;var o=n.get("$rootScope");o._toast("Too many requests. Please wait "+o._msToTime(i.data.t)+".");break;case 461:var o=n.get("$rootScope"),r=n.get("AuthSrv");o._user&&(o._toast("You were logged out automatically due to a server-side event or another device logging into your account.",!0),r.logout(!1,!1));break;case 462:var o=n.get("$rootScope"),r=n.get("AuthSrv"),a=n.get("$state");o._user&&r.logout(!1,!1,!0),a.go("update");break;default:if(i.config.gr_auto)break;var o=n.get("$rootScope");o._toast("Unspecified error (code "+i.status+").")}return e.reject(i)}}}]).config(["$httpProvider","$ionicConfigProvider","$stateProvider","$urlRouterProvider","$compileProvider","$localForageProvider",function(t,e,n,i,o,r){o.debugInfoEnabled(!1),r.config({driver:"webSQLStorage",name:"garnetroom"}),e.tabs.style("standard"),e.tabs.position("bottom"),e.views.swipeBackEnabled(!1),e.scrolling.jsScrolling(!1),e.form.toggle("large"),e.spinner.icon("ios"),e.navBar.alignTitle("center"),e.backButton.previousTitleText(!1),e.backButton.text("Back"),e.backButton.icon("ion-chevron-left"),t.interceptors.push("HttpInterceptor"),n.state("login",{url:"/login",templateUrl:"templates/views/login.html",controller:"LoginCtrl"}).state("update",{url:"/update",templateUrl:"templates/views/update.html",controller:"UpdateCtrl"}).state("app",{url:"/app",templateUrl:"templates/main.html",controller:"MainCtrl"}).state("app.home",{url:"/home",views:{homeTab:{templateUrl:"templates/views/home.html",controller:"HomeCtrl"}}}).state("app.profile",{url:"/profile",views:{profileTab:{templateUrl:"templates/views/profile.html",controller:"ProfileCtrl"}}}).state("app.preferences",{url:"/preferences",views:{preferencesTab:{templateUrl:"templates/views/preferences.html",controller:"PreferencesCtrl"}}}).state("app.chats",{url:"/chats",views:{chatsTab:{templateUrl:"templates/views/chats.html",controller:"ChatsCtrl"}}}).state("app.more",{url:"/more",views:{moreTab:{templateUrl:"templates/views/more.html",controller:"MoreCtrl"}}}).state("app.chat",{url:"/chat",views:{chatsTab:{templateUrl:"templates/views/chat.html",controller:"ChatCtrl"}}})}]);var GRDEV=!1;angular.module("GarnetRoom").constant("CFG",{version:"1.2.5",minCompatibleVersion:"1.2.4",apiBase:GRDEV?"http://localhost:8080/v1":"https://api.garnetroom.co/v1",imgBase:"http://images.garnetroom.co",imgPath:GRDEV?"0/":"",imgSourceSize:2048,imgMinSize:750,msgsChunk:30,syncChunk:25,maxMsgsPerMatch:200,picSmSize:40,picMdSize:80,minDistance:.5,showDateMinTime:12e5,profileCacheDuration:3e4,locInterval:3e5,chatsSyncInterval:36e5,picsModalMaxSize:110,picsModalBorder:2,sandbox:GRDEV}),angular.module("GarnetRoom").factory("AuthSrv",["CFG","IonicSrv","LocSrv","CardsSrv","SyncSrv","EventsSrv","$ionicHistory","$localForage","$rootScope","$timeout","$http","$state","$ionicPopup","$ionicLoading",function(t,e,n,i,o,r,a,s,l,c,d,u,p,g){function h(){if(ionic.Platform.isWebView())if(I)I=!1,window.GcmPushPlugin.register(function(e){S=e.gcm,void 0!==d.defaults.headers.common["x-gr-token"]&&d.post(t.apiBase+"/gcm",{gcm_token:S},{timeout:2e4,gr_auto:!0}).then(function(t){},function(t){})},function(t){},{senderId:"101059867316",jsCallback:"onPushNotification",badge:"true",sound:"true",alert:"true",usesGCM:!0,sandbox:t.sandbox});else if(S){if(void 0===d.defaults.headers.common["x-gr-token"])return;d.post(t.apiBase+"/gcm",{gcm_token:S},{timeout:2e4,gr_auto:!0}).then(function(t){},function(t){})}}function f(){P&&(P=!1,ionic.Platform.isWebView()&&c(function(){navigator.splashscreen.hide()},1e3))}function m(t,e){function n(){l._chats={},e?l._resetChats(function(){l._tempLastEvent=null,i()}):s.iterate(function(t,e){var n=e.substr(r.length+1);e.indexOf(r+"c")>-1&&(t.lastTime=new Date(t.lastEvent).getTime(),l._chats[n]=t)}).then(function(){return s.iterate(function(t,e){var n=e.substr(r.length+1);l._chats[n]&&(e.indexOf(r+"f")>-1&&(l._chats[n].flag=t),e.indexOf(r+"p")>-1&&(l._chats[n].picSm=t.picSm,l._chats[n].picMd=t.picMd,l._chats[n].lastSync=t.lastSync))})}).then(function(){i()},function(){l._toast("Local database error."),l._clearLocalForage(function(){l._chats={},l._tempLastEvent=null,i()})})}function i(){l._updateFlagCount(),l._user.friends=[],facebookConnectPlugin.api("me/friends?fields=id,name",null,function(t){!t||t.error?o():(l._user.friends=t.data,o())},function(t){o()})}function o(){d.defaults.headers.common["x-gr-token"]=l._user.token,l._picSize=Math.floor((window.innerWidth-64)/3),l._buildPics(),h(),l._user.pics.length>=1?(l._userProgress=4,v(),u.go("app.home")):(l._userProgress=2,u.go("app.profile")),f(),g.hide()}l._cards=[],l._cfg=t.cfg,l._curChatId=null,l._detailCache={},l._showLoading=!0,l._tempCards=[],l._undoCard=void 0,l._user=t.user,l._urlCache={};var r=l._user.fb_id;s.getItem(r+"_unitMi").then(function(t){return l._unitMi=null!==t&&void 0!==t?t:"en-US"===navigator.language?!0:!1,s.getItem(r+"_unitFt")}).then(function(t){return l._unitFt=null!==t&&void 0!==t?t:"en-US"===navigator.language?!0:!1,s.getItem(r+"_igToken")}).then(function(t){return l._igToken=t,s.getItem(r+"_showInstructions")}).then(function(t){return l._showInstructions=null!==t&&void 0!==t?t:2,s.getItem(r+"_lastEvent")}).then(function(t){l._tempLastEvent=l._lastEvent=t?t:null,null===l._tempLastEvent&&(e=!0),n()},function(){l._toast("Local database error."),l._clearLocalForage(function(){l._unitMi="en-US"===navigator.language?!0:!1,l._unitFt="en-US"===navigator.language?!0:!1,l._igToken=null,l._showInstructions=2,l._tempLastEvent=l._lastEvent=null,e=!0,n()})})}function v(){r.start(),o.init(),o.start(),n.init(),l._user.visible&&n.start(function(){i.start()})}function b(){M="undefined"!=typeof device?device.uuid:null,ionic.Platform.isWebView()||facebookConnectPlugin.browserInit(0x8daa0962c5b3,"v2.5"),facebookConnectPlugin.getLoginStatus(function(e){if(e&&"connected"===e.status&&e.authResponse){var n=e.authResponse.userID;d.post(t.apiBase+"/auth",{fb_token:e.authResponse.accessToken,device_id:M},{timeout:2e4,gr_auto:!0}).then(function(t){t.data.user.fb_id=n,m(t.data,!1)},function(t){462===t.status?f():t.status>0||503!==t.status||504!==t.status?facebookConnectPlugin.logout(function(){u.go("login"),f()},function(){u.go("login"),f()}):(u.go("login"),f())})}else u.go("login"),f()},function(){u.go("login"),f()})}function y(){p.show({title:"Insufficient permissions",subTitle:'<div style="text-align: justify">To ensure correct functioning of the app you need to grant the birthday, education history, work history, friends and public profile permissions. Please see our privacy policy for more information.</div>',scope:l,buttons:[{text:"Back",type:"button-positive"}]})}function w(){p.show({title:"Facebook account not verified",subTitle:"Please verify your Facebook account by adding a mobile phone number.",scope:l,buttons:[{text:"Back",type:"button-positive button-outline"},{text:"Help",type:"button-positive",onTap:function(t){return!0}}]}).then(function(t){t&&l._www("https://www.facebook.com/help/verify",!0)})}function _(){facebookConnectPlugin.login(["user_birthday","user_education_history","user_work_history","user_photos","user_friends","email","public_profile"],function(e){if(e&&"connected"===e.status&&e.authResponse){var n=e.authResponse.userID;d.post(t.apiBase+"/auth",{fb_token:e.authResponse.accessToken,device_id:M},{timeout:2e4}).then(function(t){t.data.user.fb_id=n,m(t.data,!0)},function(t){481===t.status?(g.hide(),C=!0,y()):483===t.status?(g.hide(),w(),facebookConnectPlugin.logout(function(){},function(){})):t.status>0?((480===t.status||482===t.status)&&l._toast("Facebook error."),facebookConnectPlugin.logout(function(){g.hide(),l._toast("Login failed (code 5).")},function(){g.hide(),l._toast("Login failed (code 4).")})):(g.hide(),l._toast("Login failed (code 3)."))})}else g.hide(),l._toast("Login failed (code 2). Facebook error.")},function(t){g.hide(),l._toast("Login canceled or failed. Internet connection possibly interrupted.")})}function x(){g.show(),d.defaults.headers.common["x-gr-token"]=void 0,facebookConnectPlugin.getLoginStatus(function(e){if(e&&"connected"===e.status&&e.authResponse){if(C)return C=!1,_();var n=e.authResponse.userID;d.post(t.apiBase+"/auth",{fb_token:e.authResponse.accessToken,device_id:M},{timeout:2e4,gr_auto:!0}).then(function(t){t.data.user.fb_id=n,m(t.data,!1)},function(t){481===t.status?(g.hide(),C=!0,y()):483===t.status?(g.hide(),w(),facebookConnectPlugin.logout(function(){},function(){})):t.status>0&&503!==t.status&&504!==t.status?facebookConnectPlugin.logout(function(){_()},function(){_()}):_()})}else _()},function(){_()})}function k(s,c,p){function h(){return s?void d.post(t.apiBase+"/gcm",{gcm_token:null},{timeout:2e4}).then(function(t){f()},function(t){f()}):f()}function f(){return c?void facebookConnectPlugin.getLoginStatus(function(t){t&&"connected"===t.status?facebookConnectPlugin.logout(function(){m()},function(){m()}):m()},function(t){m()}):m()}function m(){d.defaults.headers.common["x-gr-token"]=void 0,g.hide(),p||u.go("login"),a.clearCache()}e.removePopups(),e.removeModals(),r.stop(),i.stop(),o.stop(),n.stop(),l._user=void 0,g.show(),h()}var M,S=null,I=!0,P=!0,C=!1;return{start:b,startServices:v,login:x,logout:k}}]),angular.module("GarnetRoom").factory("CardsSrv",["CFG","$rootScope","$http","$timeout","$state",function(t,e,n,i,o){function r(i,r,l){if(i!==s)return void(l&&l());if(e._user.waitlist)return a(i,r,l);var c=e._cards.length+e._tempCards.length+(e._undoCard?1:0),d=e._cards.length;return e._cfg.cards_max&&c>=e._cfg.cards_max||e._showNoLocation?a(i,r,l,d):void n.post(t.apiBase+"/cards",{cards_num:c},{timeout:2e4,gr_auto:!0}).then(function(t){if(i!==s)return void(l&&l());if(t.data.hasOwnProperty("cards_max")&&(e._cfg.cards_max=t.data.cards_max),281===t.status)return a(i,r,l,d);for(var n=t.data.cards,c=0;c<n.length;++c)n[c].cardId=n[c]._id+Date.now(),e._buildCard(n[c],1);for(var c=n.length-1;c>=0;--c)e._chats[n[c]._id]&&(e._cards.unshift(n.splice(c,1)[0]),e._removeCard(0));e.$evalAsync(function(){var t=Math.min(e._cards.length,2);e._cards=e._cards.concat(n);for(var s=e._cards,c=0;c<s.length;++c)t>c?s[c].sortScore=1e6:s[c].sortScore=s[c].score;s.sort(function(t,e){var n=t.sortScore,i=e.sortScore;return i>n?1:n>i?-1:0}),e._cards.length&&!d&&(e._showLoading=!0),n.length&&2===e._showInstructions&&(o.is("app.home")?(e._showInstructions=0,e._setItem("_showInstructions",0),e._showInstructionsModal()):(e._showInstructions=1,e._setItem("_showInstructions",1))),a(i,r,l,d)})},function(t){return i!==s?void(l&&l()):void a(i,r,l,d)})}function a(t,n,o,a){!e._showLoading||e._cards.length||a||e.$evalAsync(function(){e._showLoading=!1}),o&&o(),n||i(function(){r(t)},e._cfg.cards_interval)}var s=0;return{start:function(){++s,r(s,!1)},stop:function(){++s},once:function(t){r(s,!0,t)}}}]),angular.module("GarnetRoom").factory("CropSrv",["$ionicModal","$ionicPlatform","IONIC_BACK_PRIORITY","$rootScope","$q",function(t,e,n,i,o){var r='<div class="jr-crop modal"><ion-spinner class="crop-spinner" icon="ios"></ion-spinner><div class="jr-crop-center-container"><div class="jr-crop-img" ng-style="{width: width + \'px\', height: height + \'px\'}"></div></div><div class="jr-crop-center-container"><div class="jr-crop-select" style="overflow: hidden" ng-style="{width: width + \'px\', height: height + \'px\'}"></div></div><div class="bar bar-footer bar-dark jr-crop-footer"><button class="button button-clear" ng-click="cancel()">{{cancelText}}</button><div class="title">{{title}}</div><button class="button button-clear" ng-click="crop()">{{chooseText}}</button></div></div>',a=ionic.views.View.inherit({promise:null,imgWidth:null,imgHeight:null,imgSelect:null,imgFull:null,posX:0,posY:0,scale:1,last_scale:1,last_posX:0,last_posY:0,initialize:function(t){var r=this;r.options=t,r.promise=o.defer(),r.loadImage().then(function(t){r.imgWidth=t.naturalWidth,r.imgHeight=t.naturalHeight,r.options.modal.el.querySelector(".jr-crop-img").appendChild(r.imgSelect=t.cloneNode()),r.options.modal.el.querySelector(".jr-crop-select").appendChild(r.imgFull=t.cloneNode()),r.bindHandlers(),r.initImage(),r.imgSelect.style.width=r.imgFull.style.width=r.imgWidth+"px",r.imgSelect.style.height=r.imgFull.style.height=r.imgHeight+"px",r.imgLoaded=!0}),r.options.cancel=this.cancel.bind(this),r.options.crop=this.crop.bind(this),i.deregisterCropModal=e.registerBackButtonAction(r.options.cancel,n.modal)},initImage:function(){var t=this.imgWidth/this.imgHeight,e=this.options.width/this.options.height;e>t?this.scale=this.last_scale=this.options.width/this.imgWidth:this.scale=this.last_scale=this.options.height/this.imgHeight;var n=(this.imgWidth-this.options.width)/2,i=(this.imgHeight-this.options.height)/2;this.posX=this.last_posX=-n,this.posY=this.last_posY=-i,this.setImageTransform()},cancel:function(){var t=this;t.options.modal.remove().then(function(){t.promise.reject("canceled")}),i.deregisterCropModal()},bindHandlers:function(){function t(){e(),i.posX>o&&(i.posX=o),i.posX<a&&(i.posX=a),i.posY>r&&(i.posY=r),i.posY<s&&(i.posY=s)}function e(){var t=i.scale*i.imgWidth,e=i.scale*i.imgHeight;o=(t-i.imgWidth)/2,r=(e-i.imgHeight)/2,a=-(t-o-i.options.width),s=-(e-r-i.options.height)}var n,i=this,o=0,r=0,a=0,s=0,l=0,c=0,d=i.options.width/i.options.minSize,u=i.imgWidth/i.imgHeight,p=i.options.width/i.options.height;n=u>p?i.options.height/i.imgHeight:i.options.width/i.imgWidth;var g={prevent_default_directions:["left","right","up","down"]};ionic.onGesture("touch transform drag dragstart dragend",function(e){switch(e.type){case"touch":i.last_scale=i.scale;break;case"drag":i.posX=i.last_posX+e.gesture.deltaX-l,i.posY=i.last_posY+e.gesture.deltaY-c,t();break;case"transform":i.scale=Math.max(n,Math.min(i.last_scale*e.gesture.scale,d)),t();break;case"dragend":i.last_posX=i.posX,i.last_posY=i.posY;break;case"dragstart":i.last_scale=i.scale,e.gesture.deltaX>1||e.gesture.deltaX<-1?(l=e.gesture.deltaX,c=e.gesture.deltaY):(l=0,c=0)}i.setImageTransform()},i.options.modal.el,g)},setImageTransform:function(){var t=this,e="translate3d("+t.posX+"px,"+t.posY+"px, 0) scale3d("+t.scale+","+t.scale+", 1)";t.imgSelect.style[ionic.CSS.TRANSFORM]=e,t.imgFull.style[ionic.CSS.TRANSFORM]=e},crop:function(){if(this.imgLoaded){i.deregisterCropModal();var t=this.imgWidth*this.scale,e=this.imgHeight*this.scale,n=(t-this.imgWidth)/2,o=(e-this.imgHeight)/2,r=(this.posX-n)/this.scale,a=(this.posY-o)/this.scale,s={};if(this.options.isUpload){var l=document.createElement("canvas"),c=l.getContext("2d");c.imageSmoothingEnabled=!0;var d=document.createElement("canvas"),u=d.getContext("2d");u.imageSmoothingEnabled=!0,d.width=this.options.width/this.scale,d.height=this.options.height/this.scale,u.drawImage(this.imgFull,r,a),l.width=this.options.minSize,l.height=this.options.minSize,c.drawImage(d,0,0,this.options.minSize,this.options.minSize),s.canvas=l,s.xOffset=0,s.yOffset=0,s.size=1}else s.xOffset=Math.min(1,Math.max(0,-r/this.imgWidth)),s.yOffset=Math.min(1,Math.max(0,-a/this.imgHeight)),s.size=Math.min(1,Math.max(0,this.options.width/this.imgWidth/this.scale)),s.ig_hack=this.ig_hack;this.options.modal.remove(),this.promise.resolve(s)}},loadImage:function(){var t=o.defer(),e=this;return angular.element("<img />").bind("load",function(n){!e.options.fallback||1080===this.naturalWidth&&1080===this.naturalHeight?(e.options.fallback&&(e.ig_hack=!0),t.resolve(this)):angular.element("<img />").bind("load",function(e){t.resolve(this)}).bind("error",function(e){t.reject()}).prop("src",e.options.fallback)}).bind("error",function(n){e.options.fallback?angular.element("<img />").bind("load",function(e){t.resolve(this)}).bind("error",function(e){t.reject()}).prop("src",e.options.fallback):t.reject()}).prop("src",e.options.original),t.promise}});return{defaultOptions:{width:0,height:0,aspectRatio:0,cancelText:"Cancel",chooseText:"Choose"},crop:function(e){e=this.initOptions(e);var n=i.$new(!0);return ionic.extend(n,e),n.modal=t.fromTemplate(r,{scope:n,animation:"scale-in"}),n.modal.show().then(function(){return new a(n).promise.promise})},initOptions:function(t){var e;return e=ionic.extend({},this.defaultOptions),e=ionic.extend(e,t),e.aspectRatio&&(!e.width&&e.height&&(e.width=200),e.width?e.height=e.width/e.aspectRatio:e.height&&(e.width=e.height*e.aspectRatio)),e}}}]),angular.module("GarnetRoom").factory("EventsSrv",["CFG","$rootScope","$q","$http","$timeout","$interval","$state","moment",function(t,e,n,i,o,r,a,s){function l(t,n){return function(i){e._setItem(t,n,function(){i()})}}function c(t){return function(n){e._removeItem(t,function(){n()})}}function d(e,n){(!e.hasMsgs||n[0].time-new Date(e.lastEvent).getTime()>=t.showDateMinTime)&&(n[0].stamp=!0);for(var i=1;i<n.length;++i)n[i].time-n[i-1].time>=t.showDateMinTime&&(n[i].stamp=!0)}function u(r){if(r===v){if(e._user.waitlist)return o(function(){u(r)},1e4);m=n.defer();var h=o(function(){m&&(m.resolve(),m=void 0)},e._cfg.events_timeout);i.post(t.apiBase+"/events",{last_event:e._tempLastEvent},{timeout:m.promise,gr_auto:!0}).then(function(n){if(o.cancel(h),m=void 0,r===v){ionic.Platform.isWebView()&&ionic.Platform.isIOS()&&window.GcmPushPlugin.setApplicationIconBadgeNumber({badge:0});var i=n.data,u=[],f=[],y=[],w=[];if(281===n.status||!i.last_event)return p(r);b=!0,u.push(l("_lastEvent",i.last_event));for(var _=0;_<i.dels.length;++_)i.dels[_]===e._curChatId&&a.is("app.chat")&&e.$broadcast("removedChat"),e._chats[i.dels[_]]&&(delete e._chats[i.dels[_]],e._updateFlagCount()),u.push(c("c"+i.dels[_])),u.push(c("m"+i.dels[_])),u.push(c("d"+i.dels[_])),u.push(c("f"+i.dels[_])),u.push(c("p"+i.dels[_]));for(var x=new Date(e._lastEvent),_=0;_<i.chats.length;++_){for(var k=i.chats[_],M=0;M<k.msgs.length;++M)k.msgs[M]={by:k.msgs[M].by,time:new Date(k.msgs[M].created).getTime(),text:k.msgs[M].text};if(e._chats[k.user_id]){var S=e._chats[k.user_id],I={userId:S.userId,name:S.name,lastMsg:S.lastMsg,hasMsgs:S.hasMsgs,lastEvent:S.lastEvent};k.msgs.length&&(I.lastMsg=k.msgs[k.msgs.length-1].text,d(I,k.msgs),I.hasMsgs=!0),I.lastEvent=k.last_event;for(var P=!1,M=0;M<k.msgs.length;++M)if(k.msgs[M].by!==e._user._id){P=!0;break}f.push(I),u.push(l("c"+k.user_id,I)),P&&(w.push(k.user_id),u.push(l("f"+k.user_id,!0))),k.msgs.length&&y.push({userId:k.user_id,msgs:k.msgs})}else{for(var M=e._cards.length-1;M>=2;--M)e._cards[M]._id===k.user_id&&e._removeCard(M);var I={userId:k.user_id,name:k.name,lastMsg:k.msgs.length?k.msgs[k.msgs.length-1].text:"Matched on "+s(k.last_event).format("L"),sync:!0};k.msgs.length&&d(I,k.msgs),I.hasMsgs=k.msgs.length?!0:!1,I.lastEvent=k.last_event,f.push(I),u.push(l("c"+k.user_id,I)),new Date(I.lastEvent)>x&&(w.push(k.user_id),u.push(l("f"+k.user_id,!0))),u.push(l("m"+k.user_id,k.msgs))}}var C=e._user._id;g(u,y,function(){e._runTasks(u,function(){e.$evalAsync(function(){if(e._user&&C===e._user._id){for(var n=e._chats,o=0;o<y.length;++o){var s=y[o];if(n[s.userId].msgs)if(s.userId===e._curChatId&&a.is("app.chat")){for(var l=n[s.userId].lastTime,c=s.msgs.length-1;c>=0;--c)s.msgs[c].stamp=!1,s.msgs[c].by===C&&s.msgs[c].time<=l&&s.msgs.splice(c,1);if(s.msgs.length){(!n[s.userId].msgs.length||s.msgs[0].time-l>=t.showDateMinTime)&&(s.msgs[0].stamp=!0);
for(var c=1;c<s.msgs.length;++c)s.msgs[c].time-s.msgs[c-1].time>=t.showDateMinTime&&(s.msgs[c].stamp=!0)}n[s.userId].msgs=n[s.userId].msgs.concat(s.msgs),e._msgLimit+=s.msgs.length,e.$broadcast("refreshChat")}else delete n[s.userId].msgs}for(var d=!1,o=0;o<f.length;++o){var u=f[o];u.sync&&(d=!0,delete u.sync),n[u.userId]?(u.hasOwnProperty("lastEvent")&&(n[u.userId].lastEvent=u.lastEvent),u.hasOwnProperty("lastMsg")&&(n[u.userId].lastMsg=u.lastMsg),u.hasOwnProperty("hasMsgs")&&(n[u.userId].hasMsgs=u.hasMsgs),u.hasOwnProperty("name")&&(n[u.userId].name=u.name)):n[u.userId]=u,n[u.userId].lastTime=new Date(n[u.userId].lastEvent).getTime()}d&&e._syncChats();for(var o=0;o<w.length;++o){var g=w[o];n[g]&&(g===e._curChatId&&a.is("app.chat")?e._removeItem("f"+g):n[g].name&&(n[g].flag=!0))}e._updateFlagCount(),e._tempLastEvent=e._lastEvent=i.last_event}b=!1,p(r)})})})}},function(t){o.cancel(h),m=void 0,r===v&&o(function(){p(r)},e._cfg.events_timeout)})}}function p(t){e._tempLastEvent?u(t):o(function(){u(t)},5e3)}function g(n,i,o){var r=[];if(!i.length)return o();for(var a=0;a<i.length;++a){var s=i[a];!function(i,o){r.push(function(r){e._getItem("m"+i,function(e){var a=e?e.concat(o):o;a=a.slice(-t.maxMsgsPerMatch),n.push(l("m"+i,a)),r()})})}(s.userId,s.msgs)}e._runTasks(r,o)}function h(){f(),b?!function(t){var e=r(function(){return t!==v?r.cancel(e):void(b||(r.cancel(e),u(t)))},100)}(v):u(v)}function f(){++v,m&&(m.resolve(),m=void 0)}var m,v=0,b=!1;return{start:h,stop:f}}]),angular.module("GarnetRoom").factory("IonicSrv",["$rootScope","$ionicPopup","$ionicModal","$ionicBackdrop","$timeout","$ionicBody",function(t,e,n,i,o,r){var a=[];return{showModal:function(t,e,i,o){var r={hide:function(){this.m&&this.m.remove();var t=a.indexOf(this);t>=0&&a.splice(t,1)}};return n.fromTemplateUrl(i,{scope:t,animation:e}).then(function(t){r.m=t,t.show(),a.push(r),o&&o()}),r},removeModals:function(){for(var t=a.length-1;t>=0;--t)a[t].hide()},removePopups:function(){for(var t=e._popupStack,n=t.length-1;n>=0;--n){var a=t.pop();a.remove(),t.length>0||(i.release(),o(function(){t.length||r.removeClass("popup-open")},400,!1),(e._backButtonActionDone||angular.noop)())}}}}]),angular.module("GarnetRoom").factory("IosRenderFixSrv",["$interval",function(t){var e,n,i=!1;return{start:function(){ionic.Platform.isWebView()&&ionic.Platform.isIOS()&&(e=t(function(){i=!i,document.getElementById("iosRenderFix").style.opacity=i?1:0},100))},stop:function(){ionic.Platform.isWebView()&&ionic.Platform.isIOS()&&t.cancel(e)},burst:function(){if(ionic.Platform.isWebView()&&ionic.Platform.isIOS()){if(n=0,e)return;e=t(function(){i=!i,document.getElementById("iosRenderFix").style.opacity=i?1:0,10===++n&&(t.cancel(e),e=void 0)},100)}}}}]),angular.module("GarnetRoom").factory("LocSrv",["CFG","$timeout","$rootScope","$http",function(t,e,n,i){function o(e,o,u){return e!==a?void(u&&u()):void navigator.geolocation.getCurrentPosition(function(d){if(e!==a)return void(u&&u());n.$evalAsync(function(){n._showNoLocation&&(n._showLoading=!0),n._showNoLocation=!1});var p=d.coords.longitude,g=d.coords.latitude,h=[p,g];return l&&n._getDistance(l,h)<t.minDistance?r(e,o,u):void i.post(t.apiBase+"/loc",{longitude:p,latitude:g},{timeout:2e4,gr_auto:!0}).then(function(t){return e!==a?void(u&&u()):(s=!0,280===t.status&&(l=h),c&&(c(),c=null),void r(e,o,u))},function(n){return e!==a?void(u&&u()):void r(e,o,u,s?t.locInterval:1e4)})},function(i){return e!==a?void(u&&u()):void(i.code===i.PERMISSION_DENIED||ionic.Platform.isAndroid()&&i.code===i.TIMEOUT?n.$evalAsync(function(){n._showNoLocation=!0,r(e,o,u,ionic.Platform.isAndroid()?500:d)}):n.$evalAsync(function(){n._showNoLocation&&(n._showLoading=!0),s?n._showNoLocation=!1:n._toast("Could not detect location. Retrying..."),r(e,o,u,s?t.locInterval:1e4)}))},{enableHighAccuracy:!0,maximumAge:t.locInterval/2,timeout:d})}function r(n,i,r,a){return i?void(r&&r()):void e(function(){o(n)},a?a:t.locInterval)}var a=0,s=!1,l=null,c=null,d=7e3;return{init:function(){s=!1,l=null,c=null},start:function(t){++a,t&&(c=null,s?t():c=t),o(a,!1)},stop:function(){++a},once:function(t){o(a,!0,t)},showLocationSettings:function(){ionic.Platform.isIOS()?cordova.plugins.settings.open(function(){},function(){n._toast("Could not open phone settings.")}):cordova.plugins.settings.openSetting("location_source",function(){},function(){n._toast("Could not open phone settings.")})}}}]),angular.module("GarnetRoom").factory("SyncSrv",["CFG","$rootScope","$http","$timeout",function(t,e,n,i){function o(i){if(i===a){var o=Date.now();n.get(t.apiBase+"/sync",{timeout:2e4,gr_auto:!0}).then(function(t){i===a&&(t.data.hasOwnProperty("cfg")&&(t.data.cfg.hasOwnProperty("sync_interval")&&(e._cfg.sync_interval=t.data.cfg.sync_interval),t.data.cfg.hasOwnProperty("cards_interval")&&(e._cfg.cards_interval=t.data.cfg.cards_interval),t.data.cfg.hasOwnProperty("events_timeout")&&(e._cfg.events_timeout=t.data.cfg.events_timeout)),t.data.hasOwnProperty("user")&&(t.data.user.hasOwnProperty("waitlist")&&(e._user.waitlist=t.data.user.waitlist),t.data.user.hasOwnProperty("vote")&&(e._user.vote=t.data.user.vote),!s&&o>=d&&t.data.user.hasOwnProperty("pics")&&(e._user.pics=t.data.user.pics,e._buildPics()),!l&&o>=u&&(t.data.user.hasOwnProperty("visible")&&(!e._user.visible&&t.data.user.visible?LocSrv.start(function(){CardsSrv.start()}):e._user.visible&&!t.data.user.visible&&(LocSrv.stop(),CardsSrv.stop()),e._user.visible=t.data.user.visible),t.data.user.hasOwnProperty("gender_flt")&&(e._user.gender_flt=t.data.user.gender_flt),t.data.user.hasOwnProperty("age_flt_min")&&(e._user.age_flt_min=t.data.user.age_flt_min),t.data.user.hasOwnProperty("age_flt_max")&&(e._user.age_flt_max=t.data.user.age_flt_max),t.data.user.hasOwnProperty("dist_flt")&&(e._user.dist_flt=t.data.user.dist_flt),t.data.user.hasOwnProperty("push_match")&&(e._user.push_match=t.data.user.push_match),t.data.user.hasOwnProperty("push_msg")&&(e._user.push_msg=t.data.user.push_msg)),!c&&o>=p&&(t.data.user.hasOwnProperty("gender")&&(e._user.gender=t.data.user.gender),t.data.user.hasOwnProperty("height")&&(e._user.height=t.data.user.height))),r(i))},function(t){i===a&&r(i)})}}function r(t){i(function(){o(t)},e._cfg.sync_interval)}var a=0,s=!1,l=!1,c=!1,d=0,u=0,p=0;return{init:function(){s=!1,l=!1,c=!1,d=0,u=0,p=0},start:function(){++a,o(a)},stop:function(){++a},pausePics:function(){s=!0},resumePics:function(){s=!1,d=Date.now()},pausePreferences:function(){l=!0},resumePreferences:function(){l=!1,u=Date.now()},pausePersonal:function(){c=!0},resumePersonal:function(){c=!1,p=Date.now()}}}]),angular.module("GarnetRoom").directive("chatScroll",["CFG","$timeout","$rootScope","$state",function(t,e,n,i){return{restrict:"A",link:function(o,r,a){r.bind("scroll",function(r){if(o.chatScrolling&&i.is("app.chat")){var a=document.getElementById("chatScroll"),s=a.scrollTop;void 0===o.oldScrollPos&&(o.oldScrollPos=1),!o.loadingMsgs&&0>=s&&s!==o.oldScrollPos&&n._msgLimit<o.chat.msgs.length&&(o.loadingMsgs=!0,o.$evalAsync(function(){a.style.opacity=0,e(function(){e(function(){o.$evalAsync(function(){var i=a.scrollHeight;n._msgLimit+=t.msgsChunk,e(function(){o.$evalAsync(function(){a.scrollTop=a.scrollHeight-i,e(function(){a.style.opacity=1,o.loadingMsgs=!1})})})})},150)})})),o.oldScrollPos=s}})}}}]).controller("ChatCtrl",["CFG","IonicSrv","SyncSrv","$scope","$rootScope","IosRenderFixSrv","$state","$ionicActionSheet","$ionicPopup","$ionicScrollDelegate","$timeout","$interval","$ionicModal","$ionicLoading","$cordovaEmailComposer","$cordovaClipboard","$http",function(t,e,n,i,o,r,a,s,l,c,d,u,p,g,h,f,m){function v(t){I=!0;var e=window.innerHeight-o._iosMargin-44-x.clientHeight;ionic.Platform.isAndroid()&&(e-=49),S>e&&(S=e,k.style.height=e+"px"),ionic.Platform.isIOS()&&(o._keyboardHeight=t.keyboardHeight),i.sending||d(function(){_.scrollBottom(!0)}),r.burst()}function b(t){I=!1;var e=window.innerHeight-o._iosMargin-44-49-x.clientHeight;e>S&&(S=e,k.style.height=e+"px"),o._keyboardHeight=0,r.burst()}var y;i.showActions=function(){s.show({buttons:[{text:"View profile"},{text:"Unmatch"},{text:"Report"}],buttonClicked:function(t){switch(t){case 0:i.showDetailModal();break;case 1:o._removeChat(o._chats[y]);break;case 2:o._report(y)}return!0}})},i.options={loop:!0,pagination:".detail-pager",lazyLoading:!0,preloadImages:!1,onSlideChangeStart:function(t){document.getElementById("vote-count-sm").style.opacity=0},onSlideChangeEnd:function(t){i.$evalAsync(function(){i.card.slideIdx=(t.activeIndex+i.card.pics.length-1)%i.card.pics.length,d(function(){document.getElementById("vote-count-sm").style.opacity=1})})}};var w=!1;i.showDetailModal=function(){function n(t){o._buildCard(t,2),i.card=t,i.options.loop=i.card.pics.length>1,i.card.slideIdx=0,i.card.zoomUrl=null,i.detailModal=e.showModal(i,"scale-in","templates/modals/detail.html",function(){o._statusBarBlack(),d(function(){w=!0},500)})}return o._detailCache[y]&&Date.now()-o._detailCache[y].timestamp<t.profileCacheDuration?n(o._detailCache[y].data):(g.show(),void m.get(t.apiBase+"/user/"+y,{timeout:2e4}).then(function(e){var i=e.data;return g.hide(),i.name=o._chats[y].name,o._detailCache[y]={data:angular.extend({},i),timestamp:Date.now()},o._chats[y].picSm=o._imgUrl(y,i.pics[0],t.picSmSize),o._chats[y].picMd=o._imgUrl(y,i.pics[0],t.picMdSize),o._chats[y].lastSync=Date.now(),o._setItem("p"+y,{picSm:o._chats[y].picSm,picMd:o._chats[y].picMd,lastSync:o._chats[y].lastSync}),n(i)},function(t){g.hide(),480===t.status?o._removeItem("c"+y,function(){o._removeItem("m"+y,function(){o._removeItem("d"+y,function(){o._removeItem("f"+y,function(){o._removeItem("p"+y,function(){o._chats[y]&&(delete o._chats[y],o._updateFlagCount()),i.input.message="",a.go("app.chats")})})})})}):o._toast("Error loading profile. Please try again.")}))},i.detailZoom=function(t){w&&i.$evalAsync(function(){if(i.card.zoomUrl)i.card.zoomUrl=null;else{i.card.zoomUrl=i.card.picUrls[t];var e=document.getElementById("detail-zoom-pic");e.style.opacity=0,d(function(){document.getElementById("detail-zoom").scrollLeft=(window.innerHeight-window.innerWidth)/2,d(function(){e.style.opacity=1})},20)}})},i.hideDetailModal=function(){i.detailModal&&(i.detailModal.hide(),w=!1,o._statusBarGarnet())};var _,x,k,M;i.$on("$ionicView.beforeEnter",function(){I=!1,i.chatScrolling=!1,y=o._curChatId,i.$evalAsync(function(){i.chat=o._chats[y],o._msgLimit=t.msgsChunk,d(function(){var t=document.getElementById("chatScroll");chatScroll.style.WebkitTransition=chatScroll.style.transition="none",t.style.opacity=0,t.scrollTop=t.scrollHeight-t.clientHeight,d(function(){t.scrollTop=t.scrollHeight-t.clientHeight,t.style.opacity=1,d(function(){chatScroll.style.WebkitTransition=chatScroll.style.transition="opacity ease 0.15s",i.chatScrolling=!0})})})}),o._getItem("d"+y,function(t){i.input={message:t}})}),i.$on("$ionicView.enter",function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.addEventListener("native.keyboardshow",v),window.addEventListener("native.keyboardhide",b),d(function(){_=c.$getByHandle("userMessageScroll"),x=document.body.querySelector("#userMessagesView .bar-footer"),k=document.body.querySelector("#userMessagesView #chatScroll"),M=angular.element(x.querySelector("textarea"))})}),i.$on("$ionicView.beforeLeave",function(){o._curChatId&&o._setItem("d"+y,i.input.message)}),i.$on("$ionicView.leave",function(){o._curChatId&&(window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),o._curChatId=null,o._msgLimit=t.msgsChunk,window.removeEventListener("native.keyboardshow",v),window.removeEventListener("native.keyboardhide",b),o._keyboardHeight=0)}),i.$on("refreshChat",function(t,e){d(function(){_&&_.scrollBottom(!0)})}),i.$on("removedChat",function(t,e){i.input.message="",a.go("app.chats")}),i.sending=!1,i.sendMessage=function(){i.sending=!0,M.one("blur",function(){M[0].focus()});var e=i.input.message;m.post(t.apiBase+"/user/"+y,{text:e},{timeout:2e4}).then(function(n){var r=n.data,a={by:o._user._id,time:new Date(r.last_event).getTime(),text:e};(!i.chat.msgs.length||a.time-i.chat.msgs[i.chat.msgs.length-1].time>=t.showDateMinTime)&&(a.stamp=!0),i.$evalAsync(function(){i.chat.msgs.push(a),i.chat.lastMsg=a.text,++o._msgLimit,i.chat.lastTime=new Date(r.last_event).getTime(),i.input.message="",i.sending=!1,d(function(){_.scrollBottom(!0)})})},function(t){i.$evalAsync(function(){i.sending=!1,480===t.status?o._removeItem("c"+y,function(){o._removeItem("m"+y,function(){o._removeItem("d"+y,function(){o._removeItem("f"+y,function(){o._removeItem("p"+y,function(){o._chats[y]&&(delete o._chats[y],o._updateFlagCount()),i.input.message="",a.go("app.chats")})})})})}):460!==t.status&&o._toast("Error sending message, please try again.")})})},i.onMessageHold=function(t,e,n){o._toast(moment(n.time).calendar()),s.show({buttons:[{text:"Copy"}],buttonClicked:function(t){switch(t){case 0:f.copy(n.text).then(function(){},function(){o._toast("Error copying message to clipboard.")})}return!0}})};var S=1/0,I=!1;i.$on("taResize",function(t,e){if(e){var n=e[0].offsetHeight;if(x){var i=n+1;i=Math.min(201,i>44?i:44),x.style.height=i+"px";var r=window.innerHeight-o._iosMargin-44-i+2;(!I||ionic.Platform.isAndroid())&&(r-=49),S=r,k.style.height=r+"px"}}})}]).directive("autolinker",["$timeout","$rootScope",function(t,e){return{restrict:"A",link:function(n,i,o){t(function(){var t=i.html();if(""===t)return!1;var n=Autolinker.link(t,{className:"autolinker",newWindow:!1});i.html(n);for(var o=i[0].getElementsByClassName("autolinker"),r=0;r<o.length;r++)angular.element(o[r]).bind("click",function(t){var n=t.target.href;return n&&e._www(n,!0),t.preventDefault(),!1})},0)}}}]),!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Autolinker=e()}(this,function(){var t=function(t){t=t||{},this.urls=this.normalizeUrlsCfg(t.urls),this.email="boolean"==typeof t.email?t.email:!0,this.twitter="boolean"==typeof t.twitter?t.twitter:!0,this.phone="boolean"==typeof t.phone?t.phone:!0,this.hashtag=t.hashtag||!1,this.newWindow="boolean"==typeof t.newWindow?t.newWindow:!0,this.stripPrefix="boolean"==typeof t.stripPrefix?t.stripPrefix:!0;var e=this.hashtag;if(e!==!1&&"twitter"!==e&&"facebook"!==e&&"instagram"!==e)throw new Error("invalid `hashtag` cfg - see docs");this.truncate=this.normalizeTruncateCfg(t.truncate),this.className=t.className||"",this.replaceFn=t.replaceFn||null,this.htmlParser=null,this.matchers=null,this.tagBuilder=null};return t.prototype={constructor:t,normalizeUrlsCfg:function(t){return null==t&&(t=!0),"boolean"==typeof t?{schemeMatches:t,wwwMatches:t,tldMatches:t}:{schemeMatches:"boolean"==typeof t.schemeMatches?t.schemeMatches:!0,wwwMatches:"boolean"==typeof t.wwwMatches?t.wwwMatches:!0,tldMatches:"boolean"==typeof t.tldMatches?t.tldMatches:!0}},normalizeTruncateCfg:function(e){return"number"==typeof e?{length:e,location:"end"}:t.Util.defaults(e||{},{length:Number.POSITIVE_INFINITY,location:"end"})},parse:function(t){for(var e=this.getHtmlParser(),n=e.parse(t),i=0,o=[],r=0,a=n.length;a>r;r++){var s=n[r],l=s.getType();if("element"===l&&"a"===s.getTagName())s.isClosing()?i=Math.max(i-1,0):i++;else if("text"===l&&0===i){var c=this.parseText(s.getText(),s.getOffset());o.push.apply(o,c)}}return o=this.compactMatches(o),this.hashtag||(o=o.filter(function(t){return"hashtag"!==t.getType()})),this.email||(o=o.filter(function(t){return"email"!==t.getType()})),this.phone||(o=o.filter(function(t){return"phone"!==t.getType()})),this.twitter||(o=o.filter(function(t){return"twitter"!==t.getType()})),this.urls.schemeMatches||(o=o.filter(function(t){return"url"!==t.getType()||"scheme"!==t.getUrlMatchType()})),this.urls.wwwMatches||(o=o.filter(function(t){return"url"!==t.getType()||"www"!==t.getUrlMatchType()})),this.urls.tldMatches||(o=o.filter(function(t){return"url"!==t.getType()||"tld"!==t.getUrlMatchType()})),o},compactMatches:function(t){t.sort(function(t,e){return t.getOffset()-e.getOffset()});for(var e=0;e<t.length-1;e++)for(var n=t[e],i=n.getOffset()+n.getMatchedText().length;e+1<t.length&&t[e+1].getOffset()<=i;)t.splice(e+1,1);return t},parseText:function(t,e){e=e||0;for(var n=this.getMatchers(),i=[],o=0,r=n.length;r>o;o++){for(var a=n[o].parseMatches(t),s=0,l=a.length;l>s;s++)a[s].setOffset(e+a[s].getOffset());i.push.apply(i,a)}return i},link:function(t){if(!t)return"";for(var e=this.parse(t),n=[],i=0,o=0,r=e.length;r>o;o++){var a=e[o];n.push(t.substring(i,a.getOffset())),n.push(this.createMatchReturnVal(a)),i=a.getOffset()+a.getMatchedText().length}return n.push(t.substring(i)),n.join("")},createMatchReturnVal:function(e){var n;if(this.replaceFn&&(n=this.replaceFn.call(this,this,e)),"string"==typeof n)return n;if(n===!1)return e.getMatchedText();if(n instanceof t.HtmlTag)return n.toAnchorString();var i=this.getTagBuilder(),o=i.build(e);return o.toAnchorString()},getHtmlParser:function(){var e=this.htmlParser;return e||(e=this.htmlParser=new t.htmlParser.HtmlParser),e},getMatchers:function(){if(this.matchers)return this.matchers;var e=t.matcher,n=[new e.Hashtag({serviceName:this.hashtag}),new e.Email,new e.Phone,new e.Twitter,new e.Url({stripPrefix:this.stripPrefix})];return this.matchers=n},getTagBuilder:function(){var e=this.tagBuilder;return e||(e=this.tagBuilder=new t.AnchorTagBuilder({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),e}},t.link=function(e,n){var i=new t(n);return i.link(e)},t.match={},t.matcher={},t.htmlParser={},t.truncate={},t.Util={abstractMethod:function(){throw"abstract"},trimRegex:/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,assign:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},defaults:function(t,e){for(var n in e)e.hasOwnProperty(n)&&void 0===t[n]&&(t[n]=e[n]);return t},extend:function(e,n){var i=e.prototype,o=function(){};o.prototype=i;var r;r=n.hasOwnProperty("constructor")?n.constructor:function(){i.constructor.apply(this,arguments)};var a=r.prototype=new o;return a.constructor=r,a.superclass=i,delete n.constructor,t.Util.assign(a,n),r},ellipsis:function(t,e,n){return t.length>e&&(n=null==n?"..":n,t=t.substring(0,e-n.length)+n),t},indexOf:function(t,e){if(Array.prototype.indexOf)return t.indexOf(e);for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n;return-1},splitAndCapture:function(t,e){for(var n,i=[],o=0;n=e.exec(t);)i.push(t.substring(o,n.index)),i.push(n[0]),o=n.index+n[0].length;return i.push(t.substring(o)),i},trim:function(t){return t.replace(this.trimRegex,"")}},t.HtmlTag=t.Util.extend(Object,{whitespaceRegex:/\s+/,constructor:function(e){t.Util.assign(this,e),this.innerHtml=this.innerHtml||this.innerHTML},setTagName:function(t){return this.tagName=t,this},getTagName:function(){return this.tagName||""},setAttr:function(t,e){var n=this.getAttrs();return n[t]=e,this},getAttr:function(t){return this.getAttrs()[t]},setAttrs:function(e){var n=this.getAttrs();return t.Util.assign(n,e),this},getAttrs:function(){return this.attrs||(this.attrs={})},setClass:function(t){return this.setAttr("class",t)},addClass:function(e){for(var n,i=this.getClass(),o=this.whitespaceRegex,r=t.Util.indexOf,a=i?i.split(o):[],s=e.split(o);n=s.shift();)-1===r(a,n)&&a.push(n);return this.getAttrs()["class"]=a.join(" "),this},removeClass:function(e){for(var n,i=this.getClass(),o=this.whitespaceRegex,r=t.Util.indexOf,a=i?i.split(o):[],s=e.split(o);a.length&&(n=s.shift());){var l=r(a,n);-1!==l&&a.splice(l,1)}return this.getAttrs()["class"]=a.join(" "),this},getClass:function(){return this.getAttrs()["class"]||""},hasClass:function(t){return-1!==(" "+this.getClass()+" ").indexOf(" "+t+" ")},setInnerHtml:function(t){return this.innerHtml=t,this},getInnerHtml:function(){return this.innerHtml||""},toAnchorString:function(){var t=this.getTagName(),e=this.buildAttrsStr();return e=e?" "+e:"",["<",t,e,">",this.getInnerHtml(),"</",t,">"].join("")},buildAttrsStr:function(){if(!this.attrs)return"";var t=this.getAttrs(),e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n+'="'+t[n]+'"');return e.join(" ")}}),t.RegexLib=function(){var t="A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",e="0-9------------------------------------",n=t+e,i=new RegExp("["+n+".\\-]*["+n+"\\-]"),o=/(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|press|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/;return{alphaNumericCharsStr:n,domainNameRegex:i,tldRegex:o}}(),t.AnchorTagBuilder=t.Util.extend(Object,{constructor:function(e){t.Util.assign(this,e)},build:function(e){return new t.HtmlTag({tagName:"a",attrs:this.createAttrs(e.getType(),e.getAnchorHref()),innerHtml:this.processAnchorText(e.getAnchorText())})},createAttrs:function(t,e){var n={href:e},i=this.createCssClass(t);return i&&(n["class"]=i),this.newWindow&&(n.target="_blank"),n},createCssClass:function(t){var e=this.className;return e?e+" "+e+"-"+t:""},processAnchorText:function(t){return t=this.doTruncate(t)},doTruncate:function(e){var n=this.truncate;if(!n)return e;var i=n.length,o=n.location;return"smart"===o?t.truncate.TruncateSmart(e,i,".."):"middle"===o?t.truncate.TruncateMiddle(e,i,".."):t.truncate.TruncateEnd(e,i,"..")}}),t.htmlParser.HtmlParser=t.Util.extend(Object,{htmlRegex:function(){var t=/!--([\s\S]+?)--/,e=/[0-9a-zA-Z][0-9a-zA-Z:]*/,n=/[^\s\0"'>\/=\x01-\x1F\x7F]+/,i=/(?:"[^"]*?"|'[^']*?'|[^'"=<>`\s]+)/,o=n.source+"(?:\\s*=\\s*"+i.source+")?";return new RegExp(["(?:","<(!DOCTYPE)","(?:","\\s+","(?:",o,"|",i.source+")",")*",">",")","|","(?:","<(/)?","(?:",t.source,"|","(?:","("+e.source+")","(?:","\\s+",o,")*","\\s*/?",")",")",">",")"].join(""),"gi")}(),htmlCharacterEntitiesRegex:/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;|&quot;|&#34;|&#39;)/gi,parse:function(t){for(var e,n,i=this.htmlRegex,o=0,r=[];null!==(e=i.exec(t));){var a=e[0],s=e[3],l=e[1]||e[4],c=!!e[2],d=e.index,u=t.substring(o,d);u&&(n=this.parseTextAndEntityNodes(o,u),r.push.apply(r,n)),s?r.push(this.createCommentNode(d,a,s)):r.push(this.createElementNode(d,a,l,c)),o=d+a.length}if(o<t.length){var p=t.substring(o);p&&(n=this.parseTextAndEntityNodes(o,p),r.push.apply(r,n))}return r},parseTextAndEntityNodes:function(e,n){for(var i=[],o=t.Util.splitAndCapture(n,this.htmlCharacterEntitiesRegex),r=0,a=o.length;a>r;r+=2){var s=o[r],l=o[r+1];s&&(i.push(this.createTextNode(e,s)),e+=s.length),l&&(i.push(this.createEntityNode(e,l)),e+=l.length)}return i},createCommentNode:function(e,n,i){return new t.htmlParser.CommentNode({offset:e,text:n,comment:t.Util.trim(i)})},createElementNode:function(e,n,i,o){return new t.htmlParser.ElementNode({offset:e,text:n,tagName:i.toLowerCase(),closing:o})},createEntityNode:function(e,n){return new t.htmlParser.EntityNode({offset:e,text:n})},createTextNode:function(e,n){return new t.htmlParser.TextNode({offset:e,text:n})}}),t.htmlParser.HtmlNode=t.Util.extend(Object,{offset:void 0,text:void 0,constructor:function(e){t.Util.assign(this,e)},getType:t.Util.abstractMethod,getOffset:function(){return this.offset},getText:function(){return this.text}}),t.htmlParser.CommentNode=t.Util.extend(t.htmlParser.HtmlNode,{comment:"",getType:function(){return"comment"},getComment:function(){return this.comment}}),t.htmlParser.ElementNode=t.Util.extend(t.htmlParser.HtmlNode,{tagName:"",closing:!1,getType:function(){return"element"},getTagName:function(){return this.tagName},isClosing:function(){return this.closing}}),t.htmlParser.EntityNode=t.Util.extend(t.htmlParser.HtmlNode,{getType:function(){return"entity"}}),t.htmlParser.TextNode=t.Util.extend(t.htmlParser.HtmlNode,{getType:function(){return"text"}}),t.match.Match=t.Util.extend(Object,{constructor:function(t,e){this.matchedText=t,this.offset=e},getType:t.Util.abstractMethod,getMatchedText:function(){return this.matchedText},setOffset:function(t){this.offset=t},getOffset:function(){return this.offset},getAnchorHref:t.Util.abstractMethod,getAnchorText:t.Util.abstractMethod}),t.match.Email=t.Util.extend(t.match.Match,{constructor:function(e,n,i){t.match.Match.prototype.constructor.call(this,e,n),this.email=i},getType:function(){return"email"},getEmail:function(){return this.email},getAnchorHref:function(){return"mailto:"+this.email},getAnchorText:function(){return this.email}}),t.match.Hashtag=t.Util.extend(t.match.Match,{constructor:function(e,n,i,o){t.match.Match.prototype.constructor.call(this,e,n),this.serviceName=i,this.hashtag=o},getType:function(){return"hashtag"},getServiceName:function(){return this.serviceName},getHashtag:function(){return this.hashtag},getAnchorHref:function(){var t=this.serviceName,e=this.hashtag;switch(t){case"twitter":return"https://twitter.com/hashtag/"+e;case"facebook":return"https://www.facebook.com/hashtag/"+e;case"instagram":return"https://instagram.com/explore/tags/"+e;default:throw new Error("Unknown service name to point hashtag to: ",t)}},getAnchorText:function(){return"#"+this.hashtag}}),t.match.Phone=t.Util.extend(t.match.Match,{constructor:function(e,n,i,o){t.match.Match.prototype.constructor.call(this,e,n),this.number=i,this.plusSign=o},getType:function(){return"phone"},getNumber:function(){return this.number},getAnchorHref:function(){return"tel:"+(this.plusSign?"+":"")+this.number},getAnchorText:function(){return this.matchedText}}),t.match.Twitter=t.Util.extend(t.match.Match,{constructor:function(e,n,i){t.match.Match.prototype.constructor.call(this,e,n),this.twitterHandle=i},getType:function(){return"twitter"},getTwitterHandle:function(){return this.twitterHandle},getAnchorHref:function(){return"https://twitter.com/"+this.twitterHandle},getAnchorText:function(){return"@"+this.twitterHandle}}),t.match.Url=t.Util.extend(t.match.Match,{constructor:function(e,n,i,o,r,a,s){t.match.Match.prototype.constructor.call(this,e,n),this.urlMatchType=o,this.url=i,this.protocolUrlMatch=r,this.protocolRelativeMatch=a,this.stripPrefix=s},urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,protocolRelativeRegex:/^\/\//,protocolPrepended:!1,getType:function(){return"url"},getUrlMatchType:function(){return this.urlMatchType},getUrl:function(){var t=this.url;return this.protocolRelativeMatch||this.protocolUrlMatch||this.protocolPrepended||(t=this.url="http://"+t,this.protocolPrepended=!0),t},getAnchorHref:function(){var t=this.getUrl();return t.replace(/&amp;/g,"&")},getAnchorText:function(){var t=this.getMatchedText();return this.protocolRelativeMatch&&(t=this.stripProtocolRelativePrefix(t)),this.stripPrefix&&(t=this.stripUrlPrefix(t)),t=this.removeTrailingSlash(t)},stripUrlPrefix:function(t){return t.replace(this.urlPrefixRegex,"")},stripProtocolRelativePrefix:function(t){return t.replace(this.protocolRelativeRegex,"")},removeTrailingSlash:function(t){return"/"===t.charAt(t.length-1)&&(t=t.slice(0,-1)),t}}),t.matcher.Matcher=t.Util.extend(Object,{constructor:function(e){t.Util.assign(this,e)},parseMatches:t.Util.abstractMethod}),t.matcher.Email=t.Util.extend(t.matcher.Matcher,{matcherRegex:function(){var e=t.RegexLib.alphaNumericCharsStr,n=new RegExp("["+e+"\\-;:&=+$.,]+@"),i=t.RegexLib.domainNameRegex,o=t.RegexLib.tldRegex;return new RegExp([n.source,i.source,"\\.",o.source].join(""),"gi")}(),parseMatches:function(e){for(var n,i=this.matcherRegex,o=[];null!==(n=i.exec(e));){var r=n[0];o.push(new t.match.Email(r,n.index,r))}return o}}),t.matcher.Hashtag=t.Util.extend(t.matcher.Matcher,{matcherRegex:new RegExp("#[_"+t.RegexLib.alphaNumericCharsStr+"]{1,139}","g"),nonWordCharRegex:new RegExp("[^"+t.RegexLib.alphaNumericCharsStr+"]"),parseMatches:function(e){for(var n,i=this.matcherRegex,o=this.nonWordCharRegex,r=this.serviceName,a=[];null!==(n=i.exec(e));){var s=n.index,l=e.charAt(s-1);if(0===s||o.test(l)){var c=n[0],d=n[0].slice(1);a.push(new t.match.Hashtag(c,s,r,d))}}return a}}),t.matcher.Phone=t.Util.extend(t.matcher.Matcher,{matcherRegex:/(?:(\+)?\d{1,3}[-\040.])?\(?\d{3}\)?[-\040.]?\d{3}[-\040.]\d{4}/g,parseMatches:function(e){for(var n,i=this.matcherRegex,o=[];null!==(n=i.exec(e));){var r=n[0],a=r.replace(/\D/g,""),s=!!n[1];o.push(new t.match.Phone(r,n.index,a,s))}return o}}),t.matcher.Twitter=t.Util.extend(t.matcher.Matcher,{matcherRegex:new RegExp("@[_"+t.RegexLib.alphaNumericCharsStr+"]{1,20}","g"),nonWordCharRegex:new RegExp("[^"+t.RegexLib.alphaNumericCharsStr+"]"),parseMatches:function(e){for(var n,i=this.matcherRegex,o=this.nonWordCharRegex,r=[];null!==(n=i.exec(e));){var a=n.index,s=e.charAt(a-1);if(0===a||o.test(s)){var l=n[0],c=n[0].slice(1);r.push(new t.match.Twitter(l,a,c))}}return r}}),t.matcher.Url=t.Util.extend(t.matcher.Matcher,{matcherRegex:function(){var e=/(?:[A-Za-z][-.+A-Za-z0-9]*:(?![A-Za-z][-.+A-Za-z0-9]*:\/\/)(?!\d+\/?)(?:\/\/)?)/,n=/(?:www\.)/,i=t.RegexLib.domainNameRegex,o=t.RegexLib.tldRegex,r=t.RegexLib.alphaNumericCharsStr,a=new RegExp("["+r+"\\-+&@#/%=~_()|'$*\\[\\]?!:,.;]*["+r+"\\-+&@#/%=~_()|'$*\\[\\]]");return new RegExp(["(?:","(",e.source,i.source,")","|","(","(//)?",n.source,i.source,")","|","(","(//)?",i.source+"\\.",o.source,")",")","(?:"+a.source+")?"].join(""),"gi")}(),wordCharRegExp:/\w/,openParensRe:/\(/g,closeParensRe:/\)/g,parseMatches:function(e){for(var n,i=this.matcherRegex,o=this.stripPrefix,r=[];null!==(n=i.exec(e));){var a=n[0],s=n[1],l=n[2],c=n[3],d=n[5],u=n.index,p=c||d,g=e.charAt(u-1);if(t.matcher.UrlMatchValidator.isValid(a,s)&&!(u>0&&"@"===g||u>0&&p&&this.wordCharRegExp.test(g))){
if(this.matchHasUnbalancedClosingParen(a))a=a.substr(0,a.length-1);else{var h=this.matchHasInvalidCharAfterTld(a,s);h>-1&&(a=a.substr(0,h))}var f=s?"scheme":l?"www":"tld",m=!!s;r.push(new t.match.Url(a,u,a,f,m,!!p,o))}}return r},matchHasUnbalancedClosingParen:function(t){var e=t.charAt(t.length-1);if(")"===e){var n=t.match(this.openParensRe),i=t.match(this.closeParensRe),o=n&&n.length||0,r=i&&i.length||0;if(r>o)return!0}return!1},matchHasInvalidCharAfterTld:function(t,e){if(!t)return-1;var n=0;e&&(n=t.indexOf(":"),t=t.slice(n));var i=/^((.?\/\/)?[A-Za-z0-9\u00C0-\u017F\.\-]*[A-Za-z0-9\u00C0-\u017F\-]\.[A-Za-z]+)/,o=i.exec(t);return null===o?-1:(n+=o[1].length,t=t.slice(o[1].length),/^[^.A-Za-z:\/?#]/.test(t)?n:-1)}}),t.matcher.UrlMatchValidator={hasFullProtocolRegex:/^[A-Za-z][-.+A-Za-z0-9]*:\/\//,uriSchemeRegex:/^[A-Za-z][-.+A-Za-z0-9]*:/,hasWordCharAfterProtocolRegex:/:[^\s]*?[A-Za-z\u00C0-\u017F]/,isValid:function(t,e){return!(e&&!this.isValidUriScheme(e)||this.urlMatchDoesNotHaveProtocolOrDot(t,e)||this.urlMatchDoesNotHaveAtLeastOneWordChar(t,e))},isValidUriScheme:function(t){var e=t.match(this.uriSchemeRegex)[0].toLowerCase();return"javascript:"!==e&&"vbscript:"!==e},urlMatchDoesNotHaveProtocolOrDot:function(t,e){return!(!t||e&&this.hasFullProtocolRegex.test(e)||-1!==t.indexOf("."))},urlMatchDoesNotHaveAtLeastOneWordChar:function(t,e){return t&&e?!this.hasWordCharAfterProtocolRegex.test(t):!1}},t.truncate.TruncateEnd=function(e,n,i){return t.Util.ellipsis(e,n,i)},t.truncate.TruncateMiddle=function(t,e,n){if(t.length<=e)return t;var i=e-n.length,o="";return i>0&&(o=t.substr(-1*Math.floor(i/2))),(t.substr(0,Math.ceil(i/2))+n+o).substr(0,e)},t.truncate.TruncateSmart=function(t,e,n){var i=function(t){var e={},n=t,i=n.match(/^([a-z]+):\/\//i);return i&&(e.scheme=i[1],n=n.substr(i[0].length)),i=n.match(/^(.*?)(?=(\?|#|\/|$))/i),i&&(e.host=i[1],n=n.substr(i[0].length)),i=n.match(/^\/(.*?)(?=(\?|#|$))/i),i&&(e.path=i[1],n=n.substr(i[0].length)),i=n.match(/^\?(.*?)(?=(#|$))/i),i&&(e.query=i[1],n=n.substr(i[0].length)),i=n.match(/^#(.*?)$/i),i&&(e.fragment=i[1]),e},o=function(t){var e="";return t.scheme&&t.host&&(e+=t.scheme+"://"),t.host&&(e+=t.host),t.path&&(e+="/"+t.path),t.query&&(e+="?"+t.query),t.fragment&&(e+="#"+t.fragment),e},r=function(t,e){var i=e/2,o=Math.ceil(i),r=-1*Math.floor(i),a="";return 0>r&&(a=t.substr(r)),t.substr(0,o)+n+a};if(t.length<=e)return t;var a=e-n.length,s=i(t);if(s.query){var l=s.query.match(/^(.*?)(?=(\?|\#))(.*?)$/i);l&&(s.query=s.query.substr(0,l[1].length),t=o(s))}if(t.length<=e)return t;if(s.host&&(s.host=s.host.replace(/^www\./,""),t=o(s)),t.length<=e)return t;var c="";if(s.host&&(c+=s.host),c.length>=a)return s.host.length==e?(s.host.substr(0,e-n.length)+n).substr(0,e):r(c,a).substr(0,e);var d="";if(s.path&&(d+="/"+s.path),s.query&&(d+="?"+s.query),d){if((c+d).length>=a){if((c+d).length==e)return(c+d).substr(0,e);var u=a-c.length;return(c+r(d,u)).substr(0,e)}c+=d}if(s.fragment){var p="#"+s.fragment;if((c+p).length>=a){if((c+p).length==e)return(c+p).substr(0,e);var g=a-c.length;return(c+r(p,g)).substr(0,e)}c+=p}if(s.scheme&&s.host){var h=s.scheme+"://";if((c+h).length<a)return(h+c).substr(0,e)}if(c.length<=e)return c;var f="";return a>0&&(f=c.substr(-1*Math.floor(a/2))),(c.substr(0,Math.ceil(a/2))+n+f).substr(0,e)},t}),angular.module("GarnetRoom").filter("searchFilter",["$rootScope",function(t){return function(e,n){var i=[];if(angular.forEach(e,function(t){i.push(t)}),t._hasMessages=!!i.length,i.sort(function(t,e){return t.lastTime>e.lastTime?-1:1}),!n.length)return i;for(var o=i.length-1;o>=0;--o){var r=Math.min(n.length,i[o].name.length);i[o].name.substr(0,r).toUpperCase()!==n.substr(0,r).toUpperCase()&&i.splice(o,1)}return i}}]).controller("ChatsCtrl",["CFG","$scope","$rootScope","$http","$timeout","$ionicHistory","$ionicPopup","$ionicLoading","IonicSrv",function(t,e,n,i,o,r,a,s,l){e.$on("$ionicView.beforeEnter",function(){n._syncChats()}),e.$on("$ionicView.enter",function(){r.clearHistory()}),e.$on("$ionicView.beforeLeave",function(){var t=[];for(var i in n._chats)if(n._chats.hasOwnProperty(i)){var o=n._chats[i];o.flag&&(o.flag=!1,function(e){t.push(function(t){n._removeItem("f"+e,function(){t()})})}(i))}n._runTasks(t),e.$evalAsync(function(){n._flagCount=0,e.showDelete=!1})}),e.toggleDelete=function(){e.$evalAsync(function(){e.showDelete=!e.showDelete})},e.search=!1,e.toggleSearch=function(){e.$evalAsync(function(){e.search&&(e.data.searchQuery=""),e.search=!e.search})},e.data={},e.data.searchQuery="",e.clearSearch=function(){e.$evalAsync(function(){e.data.searchQuery=""})},e.options={loop:!0,pagination:".detail-pager",lazyLoading:!0,preloadImages:!1,onSlideChangeStart:function(t){document.getElementById("vote-count-sm").style.opacity=0},onSlideChangeEnd:function(t){e.$evalAsync(function(){e.card.slideIdx=(t.activeIndex+e.card.pics.length-1)%e.card.pics.length,o(function(){document.getElementById("vote-count-sm").style.opacity=1})})}};var c=!1;e.showDetailModal=function(r){function a(t){n._buildCard(t,2),e.card=t,e.options.loop=e.card.pics.length>1,e.card.slideIdx=0,e.card.zoomUrl=null,e.detailModal=l.showModal(e,"scale-in","templates/modals/detail.html",function(){n._statusBarBlack(),o(function(){c=!0},500)})}var d=r.userId;return n._detailCache[d]&&Date.now()-n._detailCache[d].timestamp<t.profileCacheDuration?a(n._detailCache[d].data):(s.show(),void i.get(t.apiBase+"/user/"+d,{timeout:2e4}).then(function(e){var i=e.data;return s.hide(),i.name=n._chats[d].name,n._detailCache[d]={data:angular.extend({},i),timestamp:Date.now()},n._chats[d].picSm=n._imgUrl(d,i.pics[0],t.picSmSize),n._chats[d].picMd=n._imgUrl(d,i.pics[0],t.picMdSize),n._chats[d].lastSync=Date.now(),n._setItem("p"+d,{picSm:n._chats[d].picSm,picMd:n._chats[d].picMd,lastSync:n._chats[d].lastSync}),a(i)},function(t){s.hide(),480===t.status?n._removeItem("c"+d,function(){n._removeItem("m"+d,function(){n._removeItem("d"+d,function(){n._removeItem("f"+d,function(){n._removeItem("p"+d,function(){n._chats[d]&&n.$evalAsync(function(){delete n._chats[d],n._updateFlagCount()})})})})})}):n._toast("Error loading profile. Please try again.")}))},e.detailZoom=function(t){c&&e.$evalAsync(function(){if(e.card.zoomUrl)e.card.zoomUrl=null;else{e.card.zoomUrl=e.card.picUrls[t];var n=document.getElementById("detail-zoom-pic");n.style.opacity=0,o(function(){document.getElementById("detail-zoom").scrollLeft=(window.innerHeight-window.innerWidth)/2,o(function(){n.style.opacity=1})},20)}})},e.hideDetailModal=function(){e.detailModal&&(e.detailModal.hide(),c=!1,n._statusBarGarnet())}}]),angular.module("GarnetRoom").controller("HomeCtrl",["CFG","$http","$scope","$rootScope","$ionicHistory","$ionicPopup","$ionicLoading","$timeout","$state","IonicSrv","LocSrv","SyncSrv","IosRenderFixSrv","TDCardDelegate","CardsSrv",function(t,e,n,i,o,r,a,s,l,c,d,u,p,g,h){function f(n){if(i._undoCard){for(var o=i._cards,r=i._tempCards,a=i._undoCard._id,s=i._undoCard.cardId,l=[],c=[],d=0;d<i._undoCard.pics.length;++d){var u=i._undoCard.pics[d];u.up?l.push(u._id):u.down&&c.push(u._id)}r.push(i._undoCard),angular.isDefined(n)?i._undoCard=i._cards.splice(n,1)[0]:i._undoCard=void 0,e.post(t.apiBase+"/pass/"+a,{up:l,down:c},{timeout:2e4}).then(function(t){for(var e=0;e<r.length;++e)if(r[e].cardId===s){r.splice(e,1);break}},function(t){for(var e=0;e<r.length;++e)if(r[e].cardId===s){i._toast("Reinserted potential match into batch."),o.push(r.splice(e,1)[0]);break}})}else angular.isDefined(n)&&(i._undoCard=i._cards.splice(n,1)[0]);i._user.visible&&i._showLoading&&!i._cards.length&&h.start()}function m(t,e){v=!0,n.match=t,n.match.pic=e,n.matchModal=c.showModal(n,"fade-in","templates/modals/match.html",function(){"undefined"!=typeof StatusBar&&StatusBar.styleDefault(),i._statusBarBlack(),s(function(){var t=document.getElementsByClassName("match-pic");t[0].style.transform=t[0].style.webkitTransform="translate3d(0px, 0px, 0px)",t[1].style.transform=t[1].style.webkitTransform="translate3d(0px, 0px, 0px)"},50)})}n.$on("$ionicView.enter",function(){o.clearHistory(),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),1===i._showInstructions&&(i._showInstructions=0,i._setItem("_showInstructions",0),i._showInstructionsModal())}),n.$on("$ionicView.beforeEnter",function(){n.cardInfoHeight=window.innerHeight-window.innerWidth-93-(ionic.Platform.isIOS()&&ionic.Platform.isWebView()?20:0),n.cardInfoHeight>=179?n.showDist=!0:(n.showDist=!1,n.cardInfoHeight=Math.max(151,n.cardInfoHeight))}),n.$on("pauseEvent",function(t,e){f()}),n.$on("$ionicView.leave",function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),f()}),n.openSettings=function(){d.showLocationSettings()},n.enableDiscovery=function(){a.show(),e.post(t.apiBase+"/me",{visible:!0},{timeout:2e4}).then(function(t){i.$evalAsync(function(){a.hide(),i._cards.length||(i._showLoading=!0),d.start(function(){h.start()}),i._user.visible=!0})},function(t){a.hide(),i._toast("Error enabling discovery. Please try again.")})},n.transitionPass=function(t){f(t)},n.transitionLike=function(n){f();for(var o=i._cards,r=i._tempCards,a=o[n].cardId,s=o[n]._id,l=o[n].name,c=o[n].pics[0],d=o[n].picUrls[0],u=[],p=[],g=0;g<o[n].pics.length;++g){var b=o[n].pics[g];b.up?u.push(b._id):b.down&&p.push(b._id)}r.push(o.splice(n,1)[0]),e.post(t.apiBase+"/like/"+s,{up:u,down:p},{timeout:2e4}).then(function(e){if(282===e.status){if(i._chats[s])i._chats[s].lastTime=new Date(e.data.last_event).getTime();else{var n={userId:s,lastMsg:"Matched on "+moment(new Date(e.data.last_event)).format("L"),hasMsgs:!1,lastEvent:e.data.last_event,name:l,picSm:i._imgUrl(s,c,t.picSmSize),picMd:i._imgUrl(s,c,t.picMdSize),lastSync:Date.now(),lastTime:new Date(e.data.last_event).getTime(),msgs:[]};i._chats[s]=n,i._setItem("p"+s,{picSm:n.picSm,picMd:n.picMd,lastSync:n.lastSync})}v?(i._chats[s].flag=!0,i._updateFlagCount(),i._setItem("f"+s,!0)):m(i._chats[s],d)}for(var o=0;o<r.length;++o)if(r[o].cardId===a){r.splice(o,1);break}},function(t){for(var e=0;e<r.length;++e)if(r[e].cardId===a){i._toast("Reinserted potential match into batch."),o.push(r.splice(e,1)[0]);break}}),i._user.visible&&i._showLoading&&!i._cards.length&&h.start()},n.swipePass=function(t){g.isLocked(t)||(g.colorPassButton(t),g.pass(t))},n.swipeLike=function(t){g.isLocked(t)||(g.colorLikeButton(t),g.like(t))},n.closePass=function(t){g.isLocked(t)||(n.hideDetailModal(),g.colorPassButton(t),s(function(){g.pass(t)},200))},n.closeLike=function(t){g.isLocked(t)||(n.hideDetailModal(),g.colorLikeButton(t),s(function(){g.like(t)},200))};var v=!1;n.hideMatchModal=function(){"undefined"!=typeof StatusBar&&StatusBar.styleLightContent(),i._statusBarGarnet(),n.matchModal.hide(),v=!1},n.chat=function(){n.hideDetailModal(),l.go("app.chats"),s(function(){i._openChat(n.match,function(){s(function(){n.hideMatchModal()})})})},n.options={loop:!0,pagination:".detail-pager",lazyLoading:!0,preloadImages:!1,onSlideChangeStart:function(t){document.getElementById("vote-count").style.opacity=0},onSlideChangeEnd:function(t){n.$evalAsync(function(){n.card.slideIdx=(t.activeIndex+n.card.pics.length-1)%n.card.pics.length,s(function(){document.getElementById("vote-count").style.opacity=1})})}};var b=!1;n.showDetailModal=function(){n.card=i._cards[0],n.options.loop=n.card.pics.length>1,n.card.slideIdx=0,n.card.zoomUrl=null,n.detailModal=c.showModal(n,"scale-in","templates/modals/detail.html",function(){i._statusBarBlack(),s(function(){b=!0},500)}),i._detailModalActive=!0},n.detailZoom=function(t){b&&n.$evalAsync(function(){if(n.card.zoomUrl)n.card.zoomUrl=null;else{n.card.zoomUrl=n.card.picUrls[t];var e=document.getElementById("detail-zoom-pic");e.style.opacity=0,s(function(){document.getElementById("detail-zoom").scrollLeft=(window.innerHeight-window.innerWidth)/2,s(function(){e.style.opacity=1})},20)}})},n.hideDetailModal=function(){n.detailModal&&(n.detailModal.hide(),i._detailModalActive=!1,b=!1,i._statusBarGarnet())};var y,w;n.upvote=function(t,e){var o,r;void 0===e?(r=n.card,o=r.pics[t]):(r=i._cards[e],o=r.pics[0]);var a;r._id===y?a=w:(y=r._id,w=a=i._user.vote),n.$evalAsync(function(){o.up?(o.score-=a,r.score-=a,o.up=!1):(o.down&&(o.score+=a,r.score+=a,o.down=!1),o.score+=a,r.score+=a,o.up=!0)})},n.downvote=function(t,e){var o,r;void 0===e?(r=n.card,o=r.pics[t]):(r=i._cards[e],o=r.pics[0]);var a;r._id===y?a=w:(y=r._id,w=a=i._user.vote),n.$evalAsync(function(){o.down?(o.score+=a,r.score+=a,o.down=!1):(o.up&&(o.score-=a,r.score-=a,o.up=!1),o.score-=a,r.score-=a,o.down=!0)})}}]),angular.module("GarnetRoom").controller("LoginCtrl",["$scope","$rootScope","$ionicHistory","$interval","$timeout","AuthSrv","IonicSrv",function(t,e,n,i,o,r,a){function s(){ionic.requestAnimationFrame(function(){var t=-window.innerHeight/10,e=!1;i.cancel(l),o.cancel(c);var n=document.getElementById("login-man"),r=document.getElementById("login-woman");n.style.transition=n.style.webkitTransition="opacity linear 0s, transform linear 0s",r.style.transition=r.style.webkitTransition="opacity linear 0s, transform linear 0s",n.style.transform=n.style.webkitTransform="translate3d(0px, 0px, 0px)",r.style.transform=r.style.webkitTransform="translate3d(0px, 0px, 0px)",e?(n.style.opacity=.25,r.style.opacity=0):(n.style.opacity=0,r.style.opacity=.25),ionic.requestAnimationFrame(function(){e?(n.style.transition=n.style.webkitTransition="opacity linear 1s, transform linear 8s",n.style.transform=n.style.webkitTransform="translate3d("+t+"px, 0px, 0px)"):(r.style.transition=r.style.webkitTransition="opacity linear 1s, transform linear 8s",r.style.transform=r.style.webkitTransform="translate3d("+t+"px, 0px, 0px)")}),l=i(function(){ionic.requestAnimationFrame(function(){e=!e,e?(n.style.opacity=.25,r.style.opacity=0,n.style.transition=n.style.webkitTransition="opacity linear 1s, transform linear 8s",n.style.transform=n.style.webkitTransform="translate3d("+t+"px, 0px, 0px)"):(n.style.opacity=0,r.style.opacity=.25,r.style.transition=r.style.webkitTransition="opacity linear 1s, transform linear 8s",r.style.transform=r.style.webkitTransform="translate3d("+t+"px, 0px, 0px)"),c=o(function(){ionic.requestAnimationFrame(function(){e?(r.style.transition=r.style.webkitTransition="opacity linear 1s, transform linear 0s",r.style.transform=r.style.webkitTransform="translate3d(0px, 0px, 0px)"):(n.style.transition=n.style.webkitTransition="opacity linear 1s, transform linear 0s",n.style.transform=n.style.webkitTransform="translate3d(0px, 0px, 0px)")})},2e3)})},6e3)})}var l,c;t.$on("$ionicView.beforeEnter",function(){s(),document.addEventListener("resume",s,!1)}),t.$on("$ionicView.enter",function(){"undefined"!=typeof StatusBar&&StatusBar.styleDefault(),e._statusBarBlack(),n.clearCache(),n.clearHistory(),n.nextViewOptions({disableBack:!0,historyRoot:!0,disableAnimate:!1})}),t.$on("$ionicView.leave",function(){i.cancel(l),o.cancel(c),document.removeEventListener("resume",s,!1)}),t.fbLogin=function(){r.login()},t.showLearnModal=function(){t.learnModal=a.showModal(t,"fade-in","templates/modals/learn.html")}}]),angular.module("GarnetRoom").controller("MainCtrl",["$scope","$rootScope",function(t,e){t.$on("$ionicView.enter",function(){"undefined"!=typeof StatusBar&&StatusBar.styleLightContent(),e._statusBarGarnet()})}]),angular.module("GarnetRoom").controller("MoreCtrl",["CFG","$scope","$rootScope","$ionicPopup","$cordovaEmailComposer","$ionicLoading","$http","$ionicHistory","$localForage","IonicSrv","$timeout","AuthSrv",function(t,e,n,i,o,r,a,s,l,c,d,u){e.sandbox=t.sandbox,e.$on("$ionicView.enter",function(){s.clearHistory()}),e.$on("$ionicView.beforeEnter",function(){e.isIOS=ionic.Platform.isIOS(),e.version=t.version,e.year=(new Date).getFullYear()}),e.feedback=function(){o.isAvailable().then(function(){var t={to:"support@garnetroom.co",subject:"Feedback-"+n._user.fb_id,isHtml:!1};o.open(t).then(null,function(){})},function(){return n._toast("Error opening email composer. Please make sure email is set up correctly.")})},e.logout=function(){i.show({title:"Log out?",scope:e,buttons:[{text:"Cancel",type:"button-positive button-outline"},{text:"Confirm",type:"button-positive",onTap:function(t){return!0}}]}).then(function(t){t&&u.logout(!0,!0)})},e.deactivateAccount=function(){i.show({title:"Deactivate account?",subTitle:"Some data including your matches, messages and photos will be lost permanently. Please see our terms of use and privacy policy for more information.",scope:e,buttons:[{text:"Cancel",type:"button-positive button-outline"},{text:"Confirm",type:"button-positive",onTap:function(t){return!0}}]}).then(function(e){if(e){r.show();var i=n._user.fb_id;a["delete"](t.apiBase+"/me",{timeout:2e4}).then(function(t){n._user=void 0,l.iterate(function(t,e){e.indexOf(i)>-1&&l.removeItem(e)}).then(function(){u.logout(!1,!0)},function(){u.logout(!1,!0)})},function(t){r.hide(),n._toast("Error deactivating account. Please try again.")})}})}}]),angular.module("GarnetRoom").controller("PreferencesCtrl",["CFG","$scope","$rootScope","$state","$ionicLoading","$ionicHistory","$timeout","$http","CardsSrv","LocSrv","AuthSrv","SyncSrv",function(t,e,n,i,o,r,a,s,l,c,d,u){function p(r){if(3===n._userProgress&&!r)return void(e.tempSave=e.temp);var a=n._user,p=e.temp.gender_flt[0]&&!e.temp.gender_flt[1]?0:!e.temp.gender_flt[0]&&e.temp.gender_flt[1]?1:2,g={};a.visible!==e.temp.visible&&(g.visible=e.temp.visible),a.gender_flt!==p&&(g.gender_flt=p),a.age_flt_min!==e.temp.age_flt_min&&(g.age_flt_min=e.temp.age_flt_min),a.age_flt_max!==e.temp.age_flt_max&&(g.age_flt_max=e.temp.age_flt_max),a.dist_flt!==e.temp.dist_flt&&(g.dist_flt=e.temp.dist_flt),a.push_match!==e.temp.push_match&&(g.push_match=e.temp.push_match),a.push_msg!==e.temp.push_msg&&(g.push_msg=e.temp.push_msg),Object.keys(g).length?(o.show(),u.pausePreferences(),s.post(t.apiBase+"/me",g,{timeout:2e4}).then(function(t){n.$evalAsync(function(){o.hide(),angular.extend(n._user,g),n._cards.length||(n._showLoading=!0),r?(e.tempSave=void 0,d.startServices(),n._userProgress=4,i.go("app.home")):g.hasOwnProperty("visible")&&(g.visible?c.start(function(){l.start()}):(c.stop(),l.stop())),u.resumePreferences()})},function(t){o.hide(),n._toast("Error updating preferences. Please try again."),u.resumePreferences()})):r&&(e.tempSave=void 0,d.startServices(),n._userProgress=4,i.go("app.home"))}e.progressPreferences=function(){p(!0)},e.Math=Math,e.$on("$ionicView.enter",function(){r.clearHistory()}),e.$on("$ionicView.beforeEnter",function(){for(var t=document.getElementsByClassName("handle"),i=document.getElementsByClassName("track"),o=0;o<t.length;++o)angular.element(t[o]).addClass("gr-notransition");for(var o=0;o<i.length;++o)angular.element(i[o]).addClass("gr-notransition");a(function(){for(var e=0;e<t.length;++e)angular.element(t[e]).removeClass("gr-notransition");for(var e=0;e<i.length;++e)angular.element(i[e]).removeClass("gr-notransition")},100);var r=n._user;e.temp=e.tempSave&&3===n._userProgress?e.tempSave:{visible:3===n._userProgress?!0:r.visible,gender_flt:0===r.gender_flt?[!0,!1]:1===r.gender_flt?[!1,!0]:[!0,!0],age_flt_min:r.age_flt_min,age_flt_max:r.age_flt_max,dist_flt:r.dist_flt,push_match:r.push_match,push_msg:r.push_msg}}),e.setAllGender=function(t){for(var n=0,i=0;2>i;++i)e.temp.gender_flt[i]===!1&&++n;2===n&&(e.temp.gender_flt=[!0,!0],e.temp.gender_flt[t]=!1)},e.$on("$ionicView.beforeLeave",function(){p()})}]),angular.module("GarnetRoom").directive("albumsPagingScroll",function(){return{restrict:"A",link:function(t,e,n){e.bind("scroll",function(e){var n=document.getElementById("albums-paging-scroll");n.scrollTop+n.clientHeight>n.scrollHeight-n.clientHeight&&t.loadAlbumsFb()})}}}).directive("picsPagingScroll",function(){return{restrict:"A",link:function(t,e,n){e.bind("scroll",function(e){var n=document.getElementById("pics-paging-scroll");n.scrollTop+n.clientHeight>n.scrollHeight-n.clientHeight&&("fb"===t.picsModalData.type?t.loadPicsFb():t.loadPicsIg())})}}}).controller("ProfileCtrl",["CFG","$scope","$rootScope","$state","$cordovaOauth","$ionicPopup","$ionicHistory","$ionicLoading","$timeout","$http","$ionicScrollDelegate","SyncSrv","IonicSrv","CropSrv",function(t,e,n,i,o,r,a,s,l,c,d,u,p,g){function h(){for(var e=1,n=1/0;n>t.picsModalMaxSize;)n=Math.floor((window.innerWidth-t.picsModalBorder)/e-t.picsModalBorder),++e;return n}function f(){var n=Math.round((window.innerWidth-t.picsModalBorder)/(e.modalPicSize+t.picsModalBorder)),i=Math.ceil((window.innerHeight-44-(ionic.Platform.isIOS()?20:0)-t.picsModalBorder)/(e.modalPicSize+t.picsModalBorder));return n*i}function m(t,n){return function(i){I=!0,i.gesture.srcEvent.preventDefault(),n.style.zIndex=9999;var o=e.picData;o[t].qx=o[t].idx%3,o[t].qy=Math.floor(o[t].idx/3),ionic.requestAnimationFrame(function(){n.style.transition=n.style.webkitTransition="none",n.style.transform=n.style.webkitTransform="translate3d("+(e.picData[t].x+i.gesture.deltaX)+"px, "+(e.picData[t].y+i.gesture.deltaY)+"px, 0px)"})}}function v(t,i){return function(o){o.gesture.srcEvent.preventDefault();var r=e.picData,a=r[t].x+o.gesture.deltaX,s=r[t].y+o.gesture.deltaY,l=16+n._picSize,c=t%3,d=Math.floor(t/3),u=a+c*l,p=s+d*l,g=r[t].qx,h=r[t].qy,f=.5*l>u?0:1.5*l>u?1:2,m=.5*l>p?0:1,v=!1;if(f!==g||m!==h){v=!0,r[t].qx=f,r[t].qy=m;var b=g+3*h,y=f+3*m;if(b>y){for(var w=0;w<r.length;++w)if(!(!r[w].active||w===t||r[w].idx<y||r[w].idx>b)){++r[w].idx;var _=w%3,x=Math.floor(w/3),k=r[w].idx%3,M=Math.floor(r[w].idx/3);r[w].x=(k-_)*l,r[w].y=(M-x)*l,r[w].qx=k,r[w].qy=M}}else for(var w=0;w<r.length;++w)if(!(!r[w].active||w===t||r[w].idx<b||r[w].idx>y)){--r[w].idx;var _=w%3,x=Math.floor(w/3),k=r[w].idx%3,M=Math.floor(r[w].idx/3);r[w].x=(k-_)*l,r[w].y=(M-x)*l,r[w].qx=k,r[w].qy=M}}ionic.requestAnimationFrame(function(){if(i.style.transform=i.style.webkitTransform="translate3d("+a+"px, "+s+"px, 0)",v)for(var e=0;6>e;++e)r[e].active&&e!==t&&(r[e].el.style.transition=r[e].el.style.webkitTransition="all ease 0.15s",r[e].el.style.transform=r[e].el.style.webkitTransform="translate3d("+r[e].x+"px, "+r[e].y+"px, 0px)")})}}function b(t,i){return function(o){for(var r=e.picData,a=r[t].x+o.gesture.deltaX,s=r[t].y+o.gesture.deltaY,c=16+n._picSize,d=t%3,u=Math.floor(t/3),p=a+d*c,g=s+u*c,h=.5*c>p?0:1.5*c>p?1:2,f=.5*c>g?0:1,m=0,v=0;v<r.length;++v)r[v].active&&m++;r[t].idx=Math.min(m-1,h+3*f),r[t].qx=r[t].idx%3,r[t].qy=Math.floor(r[t].idx/3),r[t].x=(r[t].qx-d)*c,r[t].y=(r[t].qy-u)*c,ionic.requestAnimationFrame(function(){i.style.transition=i.style.webkitTransition="all ease 0.15s",i.style.transform=i.style.webkitTransform="translate3d("+r[t].x+"px, "+r[t].y+"px, 0px)",l(function(){i.style.zIndex=0,I=!1},100)})}}function y(t){t.gesture.srcEvent.preventDefault()}function w(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var n=t.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(e.length),o=0;o<e.length;o++)i[o]=e.charCodeAt(o);return new Blob([i],{type:n})}function _(t){ionic.Platform.isAndroid()&&window.resolveLocalFileSystemURL(t,function(t){t.remove(function(){},function(){})},function(){})}function x(i){c.post(t.apiBase+"/pic",i,{timeout:3e4}).then(function(t){n._user.pics[T]=t.data.pic,t.data.hasOwnProperty("vote")&&(n._user.vote=t.data.vote),n._buildPics(),l(function(){e.picLoading[T]=!1,u.resumePics()})},function(t){480===t.status?n._toast("Facebook error. You may need to log out and back in."):481===t.status&&n._toast("Instagram error. If connected, please disconnect Instagram and try again."),e.picLoading[T]=!1,u.resumePics()})}e.progressProfile=function(){return n._user.pics.length<1?n._toast("Please add at least one photo."):void n.$evalAsync(function(){n._userProgress=3,i.go("app.preferences")})};var k;e.$on("$ionicView.enter",function(){a.clearHistory(),k=!1}),e.picLoading=[!1,!1,!1,!1,!1,!1],e.$on("$ionicView.beforeEnter",function(){e.modalPicSize=h(),e.picsCount=f(),e.albumsCount=Math.ceil((window.innerHeight-44-(ionic.Platform.isIOS()?20:0))/100),e.units={unitMi:n._unitMi.toString(),unitFt:n._unitFt.toString()}}),e.$on("$ionicView.beforeLeave",function(){e.isEditing&&e.toggleEditing()}),e.saveUnitMi=function(){n._unitMi="true"===e.units.unitMi?!0:!1,n._setItem("_unitMi",n._unitMi)},e.saveUnitFt=function(){n._unitFt="true"===e.units.unitFt?!0:!1,n._setItem("_unitFt",n._unitFt)};var M,S,I=!1;e.isEditing=!1,e.toggleEditing=function(){if(!k){for(var i=0;i<e.picLoading.length;++i)if(e.picLoading[i])return;I||e.saving||e.$evalAsync(function(){function i(){for(var t=0;t<o.length;++t)ionic.offGesture(e.picData[t].dragstart,"dragstart",e.picData[t].dragstartCb),ionic.offGesture(e.picData[t].drag,"drag",e.picData[t].dragCb),ionic.offGesture(e.picData[t].dragend,"dragend",e.picData[t].dragendCb);ionic.offGesture(M,"drag",y);for(var t=0;6>t;++t)e.picLoading[t]=!1;e.saving=!1,u.resumePics()}if(e.isEditing){e.isEditing=!1;for(var o=[],r=0;r<n._user.pics.length;++r)o.push(n._user.pics[r]._id);for(var a=[],r=0;r<e.picData.length;++r)e.picData[r].active&&(a[e.picData[r].idx]=n._user.pics[r]._id);if(e.saving=!0,JSON.stringify(o)!==JSON.stringify(a)){for(var r=0;6>r;++r)e.picLoading[r]=!0;for(r=0;r<n._user.pics.length;++r)e.picData[r].el.style.transition=e.picData[r].el.style.webkitTransition="none",e.picData[r].el.style.transform=e.picData[r].el.style.webkitTransform="translate3d(0px, 0px, 0px)";c.post(t.apiBase+"/me",{pics:a},{timeout:2e4}).then(function(t){for(var o=[],r=0;r<e.picData.length;++r)e.picData[r].active&&(o[e.picData[r].idx]=n._user.pics[r]);t.data.hasOwnProperty("vote")&&(n._user.vote=t.data.vote),n._user.pics=o,n.$evalAsync(function(){n._buildPics(),l(function(){i()})})},function(t){i()})}else i()}else{e.isEditing=!0,u.pausePics(),e.picData=[{x:0,y:0,qx:0,qy:0,idx:0,active:!1},{x:0,y:0,qx:1,qy:0,idx:1,active:!1},{x:0,y:0,qx:2,qy:0,idx:2,active:!1},{x:0,y:0,qx:0,qy:1,idx:3,active:!1},{x:0,y:0,qx:1,qy:1,idx:4,active:!1},{x:0,y:0,qx:2,qy:1,idx:5,active:!1}],S=0;for(var r=0;r<n._user.pics.length;++r){var s=document.getElementById("pic"+r);if(!s)return;s.style.transform=s.style.webkitTransform="translate3d(0px, 0px, 0px)",e.picData[r].active=!0,S++,e.picData[r].el=s,e.picData[r].dragstartCb=m(r,s),e.picData[r].dragCb=v(r,s),e.picData[r].dragendCb=b(r,s),e.picData[r].dragstart=ionic.onGesture("dragstart",e.picData[r].dragstartCb,s),e.picData[r].drag=ionic.onGesture("drag",e.picData[r].dragCb,s),e.picData[r].dragend=ionic.onGesture("dragend",e.picData[r].dragendCb,s)}M=ionic.onGesture("drag",y,document.getElementById("profile-content")),d.scrollTop(!1)}})}},e.delPic=function(t){1>=S||r.show({title:"Delete photo?",subTitle:"Its score will be subtracted from your total score.",scope:e,buttons:[{text:"Cancel",type:"button-positive button-outline"},{text:"Confirm",type:"button-positive",onTap:function(t){return!0}}]}).then(function(i){if(i){var o=e.picData;o[t].active=!1;var r=16+n._picSize;S=0;for(var a=!1,s=0;s<o.length;++s)if(o[s].active&&S++,o[s].active&&!(o[s].idx<o[t].idx)){a=!0,--o[s].idx;var c=s%3,d=Math.floor(s/3),u=o[s].idx%3,p=Math.floor(o[s].idx/3);o[s].x=(u-c)*r,o[s].y=(p-d)*r,o[s].qx=u,o[s].qy=p}ionic.requestAnimationFrame(function(){o[t].el.style.transition=o[t].el.style.webkitTransition="all ease 0.0s",o[t].el.style.transform=o[t].el.style.webkitTransform="translate3d(0px, -1000px, 0px)",l(function(){ionic.requestAnimationFrame(function(){o[t].el.style.transition=o[t].el.style.webkitTransition="all ease 0.15s",o[t].el.style.opacity=1;for(var n=0,i=0;6>i;++i)o[i].active&&n++;if(1>=n&&l(function(){e.toggleEditing()},150),a)for(var i=0;6>i;++i)o[i].active&&(o[i].el.style.transition=o[i].el.style.webkitTransition="all ease 0.15s",o[i].el.style.transform=o[i].el.style.webkitTransform="translate3d("+o[i].x+"px, "+o[i].y+"px, 0px)")})},150)})}})};var P=0,C=null,T=null;e.addPic=function(t){if(!k){for(var i=0;i<e.picLoading.length;++i)if(e.picLoading[i])return;n._user.pics.length>t?(C=n._user.pics[t]._id,T=t):(C=null,T=n._user.pics.length),e.picPopup=r.show({template:'<div><ion-item class="item-icon-right" ng-click="addPicGallery('+t+')"><div class="fa fa-camera-retro" style="text-align: center; width: 20px"></div>&nbsp;Gallery<i class="icon ion-ios-arrow-right grey-icon"></i></ion-item><ion-item class="item-icon-right" ng-click="addPicFb('+t+')"><div class="fa fa-facebook-official" style="text-align: center; width: 20px"></div>&nbsp;Facebook<i class="icon ion-ios-arrow-right grey-icon"></i></ion-item><ion-item class="item-icon-right" ng-click="addPicIg('+t+')"><div class="fa fa-instagram" style="text-align: center; width: 20px"></div>&nbsp;Instagram<i class="icon ion-ios-arrow-right grey-icon"></i></ion-item></div><a ng-if="_igToken" ng-click="disconnectIg()" class="gr-button" style="width: 100%; text-align: center; display: block; font-size: 13px; padding-top: 10px;">Disconnect Instagram</a>',title:"Add photo from...",scope:e,buttons:[{text:"Back",type:"button-positive",onTap:function(t){return!0}}]})}},e.disconnectIg=function(){n._igToken=void 0,n._removeItem("_igToken")},e.hidePicsModal=function(){e.picsModal&&e.picsModal.hide()},e.addPicGallery=function(n){e.picPopup.close(),window.imagePicker.getPictures(function(t){if(t&&t.length){var n=t[0],i={original:n};e.showCropModal(i)}},function(t){},{maximumImagesCount:1,width:t.imgSourceSize,height:t.imgSourceSize,quality:100})},e.addPicFb=function(t){e.picPopup.close(),e.albumsModalData={albums:[],paging:!0,loading:!1,cursorsAfter:null,nextUrl:null},e.albumsModal=p.showModal(e,"scale-in","templates/modals/albums.html"),e.loadAlbumsFb(!0)},e.loadAlbumsFb=function(t){function i(t){t.paging&&t.paging.next?(e.albumsModalData.nextUrl=t.paging.next,e.albumsModalData.cursorsAfter=t.paging.cursors.after,e.albumsModalData.paging=!0):(e.albumsModalData.nextUrl=null,e.albumsModalData.cursorsAfter=null,e.albumsModalData.paging=!1),e.$evalAsync(function(){e.albumsModalData.loading=!1;for(var n=0;n<t.data.length;++n){var i=t.data[n];i.count&&e.albumsModalData.albums.push(i)}e.albumsModalData.paging&&e.albumsModalData.albums.length<e.albumsCount&&e.loadAlbumsFb()})}if(!e.albumsModalData.loading){e.albumsModalData.loading=!0;var o;if(e.albumsModalData.nextUrl)ionic.Platform.isWebView()&&ionic.Platform.isIOS()?o="me/albums?fields=id,name,count&after="+e.albumsModalData.cursorsAfter:(o=e.albumsModalData.nextUrl,o=o.replace("https://graph.facebook.com/",""));else{if(!t)return;o="me/albums?fields=id,name,count"}n._urlCache[o]?i(n._urlCache[o]):facebookConnectPlugin.api(o,t?["user_photos"]:null,function(t){n._urlCache[o]=t,i(t)},function(i){t?(e.hideAlbumsModal(),n._toast("Could not load Facebook albums. Please try again.")):n._toast("Facebook error. You may need to log out and back in.")})}},e.hideAlbumsModal=function(){e.albumsModal&&e.albumsModal.hide()},e.showPicsModal=function(t){e.picsModalData={title:t.name,pics:[],paging:!0,type:"fb",loading:!1,nextUrl:null,cursorsAfter:null,albumId:t.id},e.picsModal=p.showModal(e,"scale-in","templates/modals/pics.html"),++P,e.loadPicsFb(!0)},e.loadPicsFb=function(i){function o(t,e){for(var n,i,o=1/0,r=-(1/0),a=Math.min(e,e*t[0].width/t[0].height),s=0;s<t.length;++s){var l=t[s].width-a;l>=0&&o>l?(o=l,n=s):0>l&&l>r&&(r=l,i=s)}return o===1/0?t[i].source:t[n].source}function r(n){s===P&&(n.paging&&n.paging.next?(e.picsModalData.nextUrl=n.paging.next,e.picsModalData.cursorsAfter=n.paging.cursors.after,e.picsModalData.paging=!0):(e.picsModalData.nextUrl=null,e.picsModalData.cursorsAfter=null,e.picsModalData.paging=!1),e.$evalAsync(function(){e.picsModalData.loading=!1;for(var i=0;i<n.data.length;++i){var r=n.data[i],a={fb_id:r.id,thumb:r.picture,original:o(r.images,t.imgSourceSize)};e.picsModalData.pics.push(a)}e.picsModalData.paging&&e.picsModalData.pics.length<e.picsCount&&e.loadPicsFb()}))}if(!e.picsModalData.loading){e.picsModalData.loading=!0;var a,s=P;if(e.picsModalData.nextUrl)ionic.Platform.isWebView()&&ionic.Platform.isIOS()?a=e.picsModalData.albumId+"/photos?fields=id,picture,images&after="+e.picsModalData.cursorsAfter:(a=e.picsModalData.nextUrl,
a=a.replace("https://graph.facebook.com/",""));else{if(!i)return;a=e.picsModalData.albumId+"/photos?fields=id,picture,images"}n._urlCache[a]?r(n._urlCache[a]):facebookConnectPlugin.api(a,null,function(t){n._urlCache[a]=t,r(t)},function(t){n._toast("Facebook error. You may need to log out and back in.")})}},e.addPicIg=function(t){function i(){e.picsModalData={title:"Instagram Pictures",pics:[],paging:!0,type:"ig",loading:!1,nextUrl:null},e.picsModal=p.showModal(e,"scale-in","templates/modals/pics.html"),++P,e.loadPicsIg(!0)}return e.picPopup.close(),n._igToken?i():(k=!0,void l(function(){o.instagram("bf04c43435fa409e8314e9d219cd3ab4",["basic"]).then(function(t){return k=!1,t.access_token?(n._igToken=t.access_token,n._setItem("_igToken",t.access_token),void i()):n._toast("Instagram login canceled or failed.")},function(t){k=!1,n._toast("Instagram login canceled or failed.")})}))},e.loadPicsIg=function(t){function i(t){r===P&&(t.pagination&&t.pagination.next_url?(e.picsModalData.nextUrl=t.pagination.next_url,e.picsModalData.paging=!0):(e.picsModalData.nextUrl=null,e.picsModalData.paging=!1),e.$evalAsync(function(){e.picsModalData.loading=!1;for(var n=0;n<t.data.length;++n){var i=t.data[n];if("image"===i.type){var o={ig_id:i.id,thumb:i.images.thumbnail.url,original:i.images.standard_resolution.url};if(o.original.indexOf("/s640x640/sh0.08/e35")){o.fallback=o.original;var r=o.original.split("/s640x640/sh0.08/e35");o.original=r[0]+r[1]}e.picsModalData.pics.push(o)}}e.picsModalData.paging&&e.picsModalData.pics.length<e.picsCount&&e.loadPicsIg()}))}if(!e.picsModalData.loading){e.picsModalData.loading=!0;var o,r=P;if(e.picsModalData.nextUrl)o=e.picsModalData.nextUrl;else{if(!t)return;o="https://api.instagram.com/v1/users/self/media/recent/?access_token="+n._igToken}n._urlCache[o]?i(n._urlCache[o]):c({method:"get",url:o,headers:{"x-gr-token":void 0,"x-gr-version":void 0,"x-gr-platform":void 0},timeout:2e4}).then(function(t){n._urlCache[o]=t.data,i(t.data)},function(t){n._toast("Instagram error. If connected, please disconnect Instagram and try again.")})}},e.showCropModal=function(i){n._statusBarBlack(),g.crop({original:i.original,fallback:i.fallback,width:.75*window.innerWidth,height:.75*window.innerWidth,minSize:t.imgMinSize,isUpload:!i.ig_id&&!i.fb_id}).then(function(o){if(e.hidePicsModal(),e.hideAlbumsModal(),n._statusBarGarnet(),null===C&&T!==n._user.pics.length||null!==C&&C!==n._user.pics[T]._id)return n._toast("Error. Please try again.");u.pausePics(),e.picLoading[T]=!0;var r={_id:C,size:o.size,x_offset:o.xOffset,y_offset:o.yOffset};i.ig_id?(r.ig_id=i.ig_id,r.ig_token=n._igToken,o.ig_hack&&(r.ig_hack=!0),x(r)):i.fb_id?(r.fb_id=i.fb_id,x(r)):c.get(t.apiBase+"/upload",{timeout:2e4}).then(function(a){r.upload_id=a.data._id,r.upload_size=t.imgMinSize;var s=new FormData;s.append("key",t.imgPath+n._user._id+"/"+a.data._id+".jpg"),s.append("AWSAccessKeyId",a.data.aws_access_key_id),s.append("acl","public-read"),s.append("policy",a.data.policy),s.append("signature",a.data.signature),s.append("Content-Type","image/jpeg"),s.append("file",w(o.canvas.toDataURL("image/jpeg",.9))),c({method:"POST",url:"http://"+a.data.bucket+".s3.amazonaws.com/",data:s,headers:{"Content-Type":void 0,"x-gr-token":void 0,"x-gr-version":void 0,"x-gr-platform":void 0},timeout:6e4}).then(function(t){_(i.original),x(r)},function(t){_(i.original),n._toast("Photo upload failed. Please try again."),e.picLoading[T]=!1,u.resumePics()})},function(t){_(i.original),n._toast("Photo upload failed. Please try again."),e.picLoading[T]=!1,u.resumePics()})},function(){_(i.original),n._statusBarGarnet()})},e.options={loop:!0,pagination:".detail-pager",lazyLoading:!0,preloadImages:!1,onSlideChangeStart:function(t){document.getElementById("vote-count-sm").style.opacity=0},onSlideChangeEnd:function(t){e.$evalAsync(function(){e.card.slideIdx=(t.activeIndex+e.card.pics.length-1)%e.card.pics.length,l(function(){document.getElementById("vote-count-sm").style.opacity=1})})}};var L=!1;e.showDetailModal=function(){return n._user.pics.length?(e.options.loop=n._user.pics.length>1,n._buildCard(n._user,0),e.card=n._user,e.card.slideIdx=0,e.card.zoomUrl=null,void(e.detailModal=p.showModal(e,"scale-in","templates/modals/detail.html",function(){n._statusBarBlack(),l(function(){L=!0},500)}))):n._toast("You need to add at least one photo before you can view your full profile.")},e.detailZoom=function(t){L&&e.$evalAsync(function(){if(e.card.zoomUrl)e.card.zoomUrl=null;else{e.card.zoomUrl=e.card.picUrls[t];var n=document.getElementById("detail-zoom-pic");n.style.opacity=0,l(function(){document.getElementById("detail-zoom").scrollLeft=(window.innerHeight-window.innerWidth)/2,l(function(){n.style.opacity=1})},20)}})},e.hideDetailModal=function(){e.detailModal&&(e.detailModal.hide(),L=!1,n._statusBarGarnet())},e.showPersonalModal=function(){var t=n._user;e.temp={gender:t.gender.toString(),bio:JSON.parse(JSON.stringify(t.bio))},t.height?e.temp.height=t.height.toString():e.temp.height="0",e.personalModal=p.showModal(e,"scale-in","templates/modals/personal.html")},e.hidePersonalModal=function(){var i=n._user,o=!1,r={};e.temp.gender=parseInt(e.temp.gender),"0"===e.temp.height?e.temp.height=null:e.temp.height=parseInt(e.temp.height),e.temp.bio||(e.temp.bio=""),e.temp.gender!==i.gender&&(r.gender=e.temp.gender,o=!0),e.temp.height!==i.height&&(r.height=e.temp.height,o=!0),JSON.stringify(e.temp.bio)!==JSON.stringify(i.bio)&&(r.bio=e.temp.bio,o=!0),o?(s.show(),u.pausePersonal(),c.post(t.apiBase+"/me",r,{timeout:2e4}).then(function(t){r.hasOwnProperty("gender")&&(n._user.gender=r.gender),r.hasOwnProperty("height")&&(n._user.height=r.height),r.hasOwnProperty("bio")&&(n._user.bio=r.bio),s.hide(),e.personalModal.hide(),u.resumePersonal()},function(t){s.hide(),n._toast("Error updating personal details."),e.personalModal.hide(),u.resumePersonal()})):e.personalModal.hide()},e.syncFb=function(){r.show({title:"Refresh data from Facebook?",subTitle:"This includes your education, occupation, name and date of birth (private).",scope:e,buttons:[{text:"Cancel",type:"button-positive button-outline"},{text:"Confirm",type:"button-positive",onTap:function(t){return!0}}]}).then(function(e){e&&(s.show(),facebookConnectPlugin.api("me?fields=updated_time",null,function(e){!e||e.error?(s.hide(),n._toast("Facebook error. You may need to log out and back in.")):e.updated_time===n._user.fb_updated?(s.hide(),n._toast("All Facebook data is already up to date.")):c.get(t.apiBase+"/fb",{timeout:2e4}).then(function(t){s.hide(),281===t.status?n._toast("All Facebook data is already up to date."):(n._toast("Data successfully refreshed."),angular.extend(n._user,t.data))},function(t){s.hide(),480===t.status&&n._toast("Facebook error. You may need to log out and back in.")})},function(t){s.hide(),n._toast("Facebook error. You may need to log out and back in.")}))})}}]),angular.module("GarnetRoom").controller("UpdateCtrl",["$scope","$rootScope",function(t,e){t.appPage=function(){ionic.Platform.isIOS()?cordova.plugins.market.open("id1021569961",{success:function(){},failure:function(){e._toast("Error.")}}):cordova.plugins.market.open("co.garnetroom",{success:function(){},failure:function(){e._toast("Error.")}})}}]),!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.collide=t()}}(function(){return function t(e,n,i){function o(a,s){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return o(n?n:t)},c,c.exports,t,e,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,e,n){(function(t){(function(){var n,i,o;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:"undefined"!=typeof t&&null!==t&&t.hrtime?(e.exports=function(){return(n()-o)/1e6},i=t.hrtime,n=function(){var t;return t=i(),1e9*t[0]+t[1]},o=n()):Date.now?(e.exports=function(){return Date.now()-o},o=Date.now()):(e.exports=function(){return(new Date).getTime()-o},o=(new Date).getTime())}).call(this)}).call(this,t("qhDIRT"))},{qhDIRT:13}],2:[function(t,e,n){for(var i=t("performance-now"),o="undefined"==typeof window?{}:window,r=["moz","webkit"],a="AnimationFrame",s=o["request"+a],l=o["cancel"+a]||o["cancelRequest"+a],c=0;c<r.length&&!s;c++)s=o[r[c]+"Request"+a],l=o[r[c]+"Cancel"+a]||o[r[c]+"CancelRequest"+a];if(!s||!l){var d=0,u=0,p=[],g=1e3/60;s=function(t){if(0===p.length){var e=i(),n=Math.max(0,g-(e-d));d=n+e,setTimeout(function(){var t=p.slice(0);p.length=0;for(var e=0;e<t.length;e++)t[e].cancelled||t[e].callback(d)},n)}return p.push({handle:++u,callback:t,cancelled:!1}),u},l=function(t){for(var e=0;e<p.length;e++)p[e].handle===t&&(p[e].cancelled=!0)}}e.exports=function(){return s.apply(o,arguments)},e.exports.cancel=function(){l.apply(o,arguments)}},{"performance-now":3}],3:[function(t,e,n){e.exports=t(1)},{qhDIRT:13}],4:[function(t,e,n){function i(t,e,n){return Math.max(t,Math.min(e,n))}function o(t){if(!(this instanceof o))return new o(t);var e=this;t=t||{},this._={id:f(),percent:0,duration:500,reverse:!1,distance:100,deceleration:.998};var n=this._.emitter=new m;this._.onDestroy=function(){n.emit("destroy")},this._.onStop=function(t){n.emit("stop",t),t&&n.emit("complete")},this._.onStart=function(){n.emit("start")};var r=1e4;this._.onStep=function(t){n.emit("step",Math.round(t*r)/r)},t.duration&&this.duration(t.duration),t.percent&&this.percent(t.percent),t.easing&&this.easing(t.easing),t.reverse&&this.reverse(t.reverse),t.distance&&this.distance(t.distance),e._tick=function(t){var n=e._;if(n.onStep(c(e,n.percent)),Math.abs(n.velocity)<v)return n.velocity=0,e.stop();if(n.percent===s(e))return e.stop();if(t)if(n.velocity){var o=d(n.velocity,t,n.deceleration),r=n.percent*n.distance;n.percent=(r-o)/n.distance,(n.percent>1||n.percent<0)&&(n.percent=i(0,n.percent,1),n.velocity=0),n.velocity=o}else n.reverse?n.percent=n.percent-t/n.duration:n.percent=n.percent+t/n.duration;else;n.percent=i(0,n.percent,1)}}function r(t,e){return e&&t._tick(),t._.isRunning=!0,p.tickAction(t._.id,t._tick),t._.onStart(),t}function a(t){return!t._.isRunning&&t._.percent===s(t)}function s(t){return t._.reverse?0:1}function l(t){return t._.reverse?1:0}function c(t,e){return t._.easing?t._.easing(e,t._.duration):e}function d(t,e,n){var i=Math.pow(n,e);return t*i}function u(t){if("object"==typeof t){var e="string"==typeof t.type&&t.type.toLowerCase().trim();if(!g[e])throw new Error('Invalid easing dynamics object type "'+t.type+'". Available dynamics types: '+Object.keys(g).join(", ")+".");return g[e](t)}if("string"==typeof t){if(t=t.toLowerCase().trim(),0===t.indexOf("cubic-bezier(")){var n=t.replace("cubic-bezier(","").replace(")","").split(",").map(function(t){return t.trim()});return h["cubic-bezier"](n[0],n[1],n[2],n[3])}var i=h[t];if(!i)throw new Error('Invalid easing function "'+t+'". Available easing functions: '+Object.keys(h).join(", ")+".");return h[t]()}return"function"==typeof t?t:void 0}var p=t("./core/timeline"),g=t("./core/dynamics"),h=t("./core/easing-functions"),f=t("./util/uid"),m=t("./util/simple-emitter"),v=.0075;e.exports=o,o.prototype={reverse:function(t){return arguments.length?(this._.reverse=!!t,this):this._.reverse},easing:function(t){var e=typeof t;return arguments.length?(("function"===e||"string"===e||"object"===e)&&(this._.easing=u(t)),this):this._.easing},percent:function(t,e){var n=this;return arguments.length?("number"==typeof t&&(this._.percent=i(0,t,1)),this.isRunning()||(e?this._tick():p.tickAction(this._.id,function(){n._tick(),p.untickAction(n._.id)})),this):this._.percent},distance:function(t){return arguments.length?("number"==typeof t&&t>0&&(this._.distance=t),this):this._.distance},deceleration:function(t){return arguments.length?("number"==typeof t&&t>0&&1>t&&(this._.deceleration=t),this):this._.deceleration},duration:function(t){return arguments.length?("number"==typeof t&&t>0&&(this._.duration=t),this):this._.duration},isRunning:function(){return!!this._.isRunning},promise:function(){var t=this;return{then:function(e){t.once("stop",e)}}},on:function(t,e){return this._.emitter.on(t,e),this},once:function(t,e){return this._.emitter.once(t,e),this},off:function(t,e){return this._.emitter.off(t,e),this},destroy:function(){return this.stop(),this._.onDestroy(),this.off(),this},stop:function(){return this._.isRunning?(this._.isRunning=!1,p.untickAction(this._.id),this._.onStop(a(this)),this):void 0},restart:function(t){return this._.isRunning?void 0:(this._.percent=l(this),this.start(!!t))},start:function(t){return r(this,t)},velocity:function(t,e){return this._.velocity=t,r(this,e)}}},{"./core/dynamics":6,"./core/easing-functions":7,"./core/timeline":8,"./util/simple-emitter":11,"./util/uid":12}],5:[function(t,e,n){function i(t){return 1/(200*t)}function o(t,e,n,o){var a=3*t,s=3*(n-t)-a,l=1-a-s,c=3*e,d=3*(o-e)-c,u=1-c-d,p=function(t){return((l*t+s)*t+a)*t},g=function(t){return((u*t+d)*t+c)*t},h=function(t){return(3*l*t+2*s)*t+a},f=function(t,e){var n,i,o,r,a,s;for(o=t,s=0;8>s;s++){if(r=p(o)-t,Math.abs(r)<e)return o;if(a=h(o),Math.abs(a)<1e-6)break;o-=r/a}if(n=0,i=1,o=t,n>o)return n;if(o>i)return i;for(;i>n;){if(r=p(o),Math.abs(r-t)<e)return o;t>r?n=o:i=o,o=.5*(i-n)+n}return o},m=function(t,e){return g(f(t,e))};return function(t,e){return m(t,i(+e||r))}}e.exports={linear:o(0,0,1,1),ease:o(.25,.1,.25,1),easeIn:o(.42,0,1,1),easeOut:o(0,0,.58,1),easeInOut:o(.42,0,.58,1),cubicBezier:function(t,e,n,i){return o(t,e,n,i)}};var r=400},{}],6:[function(t,e,n){function i(t){return t=r({},a,t||{}),function(e,n){var i,o,r,a,s,l,c,d,u,p,g,h,f,m=t;return c=Math.max(1,t.frequency),d=Math.pow(20,t.friction/100),p=t.anticipationSize/100,l=Math.max(0,p),u=e/(1-p)-p/(1-p),p>e?(i=function(t){var e,n,i,o,r;return e=.8,o=p/(1-p),r=0,i=(o-e*r)/(o-r),n=(e-i)/o,n*t*m.anticipationStrength/100+i},f=p/(1-p)-p/(1-p),h=0/(1-p)-p/(1-p),s=Math.acos(1/i(f)),r=(Math.acos(1/i(h))-s)/(c*-p)):(i=function(t){return Math.pow(d/10,-t)*(1-t)},s=0,r=1),o=i(u),a=c*(e-p)*r+s,g=1-o*Math.cos(a)}}function o(t){function e(){var e,n,i,o,r;for(i=Math.min(t.bounce/100,80),r=t.gravity/100,n=Math.sqrt(2/r),o={a:-n,b:n,H:1},t.initialForce&&(o.a=0,o.b=2*o.b);o.H>.001;)e=o.b-o.a,o={a:o.b,b:o.b+e*i,H:o.H*i*i};return o.b}function n(){var n,i,o,r,s,l;for(n=e(),s=t.gravity/100*n*n,o=Math.min(t.bounce/100,80),i=Math.sqrt(2/s),a=[],r={a:-i,b:i,H:1},t.initialForce&&(r.a=0,r.b=2*r.b),a.push(r),l=[];r.b<1&&r.H>.001;)n=r.b-r.a,r={a:r.b,b:r.b+n*o,H:r.H*o*o},l.push(a.push(r));return l}function i(e,n,i,o){var r,a,s;return r=n-e,s=2/r*o-1-2*e/r,a=s*s*i-i+1,t.initialForce&&(a=1-a),a}function o(e,n){var o,r,s,l,c;for(o=t.bounce/100,s=t.gravity,l=0,r=a[l];!(e>=r.a&&e<=r.b)&&(l+=1,r=a[l]););return c=r?i(r.a,r.b,r.H,e):t.initialForce?0:1}t=r({},s,t||{});var a=[];return n(),o}var r=t("../util/extend");e.exports={spring:i,gravity:o};var a={frequency:15,friction:200,anticipationStrength:0,anticipationSize:0},s={bounce:40,gravity:1e3,initialForce:!1}},{"../util/extend":10}],7:[function(t,e,n){var i=(t("./dynamics"),t("./bezier"));e.exports={linear:function(){return function(t,e){return i.linear(t,e)}},ease:function(){return function(t,e){return i.ease(t,e)}},"ease-in":function(){return function(t,e){return i.easeIn(t,e)}},"ease-out":function(){return function(t,e){return i.easeOut(t,e)}},"ease-in-out":function(){return function(t,e){return i.easeInOut(t,e)}},"cubic-bezier":function(t,e,n,o,r){var a=i.cubicBezier(t,e,n,o);return function(t,e){return a(t,e)}}}},{"./bezier":5,"./dynamics":6}],8:[function(t,e,n){var i=t("raf"),o=t("performance-now"),r=e.exports={_actions:{},isTicking:!1,tickAction:function(t,e){r._actions[t]=e,r.isTicking||r.tick()},untickAction:function(t){delete r._actions[t],r.maybeStopTicking()},tick:function(){function t(){r._rafId=i(t);var n=o(),a=n-e;for(var s in r._actions)r._actions[s](a);e=n}var e=o();r.isTicking=!0,r._rafId=i(t)},maybeStopTicking:function(){r.isTicking&&!Object.keys(r._actions).length&&(i.cancel(r._rafId),r.isTicking=!1)}}},{"performance-now":1,raf:2}],9:[function(t,e,n){e.exports={animation:t("./animation")}},{"./animation":4}],10:[function(t,e,n){e.exports=function(t){for(var e=Array.prototype.slice.call(arguments,1),n=0;n<e.length;n++){var i=e[n];if(i)for(var o in i)t[o]=i[o]}return t}},{}],11:[function(t,e,n){function i(){this.listeners=[]}e.exports=i,i.prototype={on:function(t,e){"function"==typeof e&&(this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e))},once:function(t,e){function n(){i.off(t,e),i.off(t,n)}var i=this;this.on(t,e),this.on(t,n)},emit:function(t,e){var n=this.listeners[t]||[],i=0,o=n.length;if(2===arguments.length)for(i;o>i;i++)n[i]&&n[i](e);else for(i;o>i;i++)n[i]&&n[i]()},off:function(t,e){if(t){var n=this.listeners[t];if(n)if(e){var i=n.indexOf(e);n.splice(i,1)}else n.length=0}else for(var o in this.listeners)this.off(o)}}},{}],12:[function(t,e,n){var i=[];e.exports=function(){for(var t,e=i.length;e;){if(e--,t=i[e].charCodeAt(0),57==t)return i[e]="A",i.join("");if(90!=t)return i[e]=String.fromCharCode(t+1),i.join("");i[e]="0"}return i.unshift("0"),i.join("")}},{}],13:[function(t,e,n){function i(){}var o=e.exports={};o.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var n=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),n.length>0)){var i=n.shift();i()}},!0),function(t){n.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=i,o.addListener=i,o.once=i,o.off=i,o.removeListener=i,o.removeAllListeners=i,o.emit=i,o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")}},{}]},{},[9])(9)}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("../moment")):"function"==typeof define&&define.amd?define(["moment"],e):e(t.moment)}(this,function(t){return t.defineLocale("custom-en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L [at] LT"},relativeTime:{future:"a few seconds ago",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(t){var e=t%10,n=1===~~(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+n},week:{dow:1,doy:4}})}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("../moment")):"function"==typeof define&&define.amd?define(["moment"],e):e(t.moment)}(this,function(t){return t.defineLocale("custom-en-us",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"MM/DD/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L [at] LT"},relativeTime:{future:"a few seconds ago",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(t){var e=t%10,n=1===~~(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+n},week:{dow:1,doy:4}})});var facebookConnectPlugin=facebookConnectPlugin||{getLoginStatus:function(t,e){try{FB.getLoginStatus(function(e){t(e)})}catch(n){e&&e(n.message)}},showDialog:function(t,e,n){t.name||(t.name=""),t.message||(t.message=""),t.caption||(t.caption=""),t.description||(t.description=""),t.href||(t.href=""),t.picture||(t.picture="");try{FB.ui(t,function(t){!t||!t.request&&t.error_code?n(t):e(t)})}catch(i){n&&n(i.message)}},login:function(t,e,n){var i={};t&&t.length>0&&(i.auth_type="rerequest",i.scope=t.toString()),FB.login(function(t){t.authResponse?e(t):n(t.status)},i)},getAccessToken:function(t,e){var n=FB.getAccessToken();n?t(n):e&&e("NO_TOKEN")},logEvent:function(t,e,n,i,o){i()},logPurchase:function(t,e,n,i){n()},logout:function(t,e){try{FB.logout(function(e){t(e)})}catch(n){e&&e(n.message)}},api:function(t,e,n,i){try{FB.api(t,function(t){t.error?i(t):n(t)})}catch(o){i&&i(o.message)}},browserInit:function(t,e){e||(e="v2.0"),FB.init({appId:t,cookie:!0,xfbml:!1,status:!1,version:e})}};!function(t){for(var e=document.createElement("div"),n=["webkitTransformOrigin","transform-origin","-webkit-transform-origin","webkit-transform-origin","-moz-transform-origin","moz-transform-origin","MozTransformOrigin","mozTransformOrigin"],i="webkitTransformOrigin",o=0;o<n.length;o++)if(void 0!==e.style[n[o]]){i=n[o];break}for(var r=["webkitTransition","transition","-webkit-transition","webkit-transition","-moz-transition","moz-transition","MozTransition","mozTransition"],a="webkitTransition",o=0;o<r.length;o++)if(void 0!==e.style[r[o]]){a=r[o];break}var s=t.views.View.inherit({initialize:function(e){e=t.extend({},e),t.extend(this,e),this.el=e.el,this.width=this.parentWidth=window.innerWidth,this.dragLock=!1,this.buttonLock=!1,this.startX=this.startY=this.x=this.y=0,this.bindEvents()},swipeLike:function(){return this.transitionOut("right")},swipePass:function(){return this.transitionOut("left")},swipeUndo:function(){return this.transitionUndo()},swipeMsg:function(){return this.transitionMsg()},snapBack:function(){this.onSnapBack(this.x,this.y,this.rotationAngle)},isUnderThreshold:function(){return Math.abs(this.thresholdAmount)<.4},transitionOut:function(e){var n=this,i="object"==typeof e,o=i?this.x>0:"right"===e;if(i&&this.isUnderThreshold()){n.direction=0;var r=n.el.querySelector("#pass-button"),a=n.el.querySelector("#like-button");return a&&a.classList.remove("active"),r&&r.classList.remove("active"),void n.onSnapBack(this.x,this.y,this.rotationAngle)}n.dragLock=!0,n.buttonLock=!0;var s,l,c,d,u;l=o?2*window.innerWidth:-2*window.innerWidth,i?(s=Math.atan(e.gesture.deltaX/e.gesture.deltaY),c=l/Math.tan(s),d=e.gesture.velocityX,u=this.rotationAngle):(s=0,c=0,d=.5,u=o?1:-1);var p=.3-Math.min(Math.max(Math.abs(d)/10,.05),.2);t.requestAnimationFrame(function(){n.el.style.transform=n.el.style.webkitTransform="translate3d("+l+"px, "+c+"px,0) rotate("+u+"rad)",n.el.style.transition=n.el.style.webkitTransition="all "+p+"s ease-in-out"}),setTimeout(function(){o?n.onTransitionLike():n.onTransitionPass()},300)},transitionMsg:function(){var e=this;e.dragLock=!0,e.buttonLock=!0,t.requestAnimationFrame(function(){e.el.style.opacity="0",e.el.style.transform=e.el.style.webkitTransform="translate3d(0px, 0px, 0px) scale(2)",e.el.style.transition=e.el.style.webkitTransition="all 0.3s ease-in-out"}),setTimeout(function(){e.el.style.display="none",e.onTransitionMsg()},300)},bindEvents:function(){var e=this;t.onGesture("dragstart",function(n){e.buttonLock=!0,e.dragLock||t.requestAnimationFrame(function(){e._doDragStart(n)})},this.el),t.onGesture("drag",function(n){e.dragLock||(t.requestAnimationFrame(function(){e._doDrag(n)}),n.gesture.srcEvent.preventDefault())},this.el),t.onGesture("dragend",function(n){e.buttonLock=!1,e.dragLock||t.requestAnimationFrame(function(){e._doDragEnd(n)})},this.el)},_doDragStart:function(t){t.preventDefault();var e=this.el.offsetWidth,n=window.innerWidth/2+this.rotationDirection*(e/2),i=Math.abs(n-t.gesture.touches[0].pageX);this.touchDistance=10*i},_doDrag:function(t){t.preventDefault();var e=t.gesture.deltaX/1e3;this.rotationAngle=Math.atan(e),this.x=this.startX+t.gesture.deltaX,this.y=this.startY+t.gesture.deltaY,this.el.style.transform=this.el.style.webkitTransform="translate3d("+this.x+"px, "+this.y+"px, 0) rotate("+(this.rotationAngle||0)+"rad)",this.thresholdAmount=this.x/(this.parentWidth/2);var n=this;n.onPartialSwipe(n.thresholdAmount)},_doDragEnd:function(t){this.transitionOut(t)}});angular.module("ionic.contrib.ui.tdCards",["ionic"]).directive("tdCard",["$timeout",function(t){return{restrict:"E",template:'<div class="td-card" ng-transclude></div>',require:"^tdCards",transclude:!0,scope:{onTransitionPass:"&",onTransitionLike:"&",onTransitionMsg:"&",onPartialSwipe:"&",onSnapBack:"&"},compile:function(e,n){return function(e,n,i,o){var r=n[0],a=r.querySelector("#pass-button"),l=r.querySelector("#like-button"),c=r.querySelector("#dm-button");r.style.transform=r.style.webkitTransform="translate3d(0px, 0px, 0px)";var d=new s({el:r,id:e.$parent.card.cardId,$scope:e,passButton:a,likeButton:l,dmButton:c,direction:0,onPartialSwipe:function(t){var e=this;0>t?1!==e.direction&&(e.direction=1,e.likeButton&&e.likeButton.classList.remove("active"),e.passButton&&e.passButton.classList.add("active")):2!==e.direction&&(e.direction=2,e.passButton&&e.passButton.classList.remove("active"),e.likeButton&&e.likeButton.classList.add("active"))},onTransitionPass:function(){t(function(){e.onTransitionPass()})},onTransitionLike:function(){t(function(){e.onTransitionLike()})},onTransitionMsg:function(){t(function(){e.onTransitionMsg()})},onSnapBack:function(n,i,o){collide.animation({duration:150,percent:0,reverse:!1,easing:"ease-out"}).on("step",function(t){r.style.transform=r.style.webkitTransform="translate3d("+(n-n*t)+"px, "+(i-i*t)+"px, 0) rotate("+(o-o*t)+"rad)"}).start();t(function(){e.onSnapBack()})}});o.registerCard(d),e.$on("$destroy",function(){o.unregisterCard(d)})}}}}]).directive("tdCards",["$rootScope","$timeout",function(e,n){return{restrict:"E",template:'<div class="td-cards" ng-transclude></div>',transclude:!0,scope:{},controller:["$scope","$element","$attrs","TDCardDelegate",function(e,i,o,r){r._register(o.delegateHandle,this),e.$on("$destroy",function(){r._unregister(o.delegateHandle)}),this.cardInstances=[],this.getById=function(t){for(var e=0;e<this.cardInstances.length;++e)if(this.cardInstances[e].id===t)return this.cardInstances[e];return null},this.registerCard=function(e){e.dragLock=!0,e.buttonLock=!0,n(function(){t.requestAnimationFrame(function(){e.el.style.transform=e.el.style.webkitTransform="translate3d(0px, 0px, 0px) scale(1)",e.el.style.opacity="1",n(function(){e.dragLock=!1,e.buttonLock=!1},1e3)})}),this.undoCardId&&e.id===this.undoCardId?(this.undoCardId=null,this.cardInstances.unshift(e)):this.cardInstances.push(e);for(var i=0;i<this.cardInstances.length;++i)this.cardInstances[i].el.style.zIndex=1e4-i},this.unregisterCard=function(t){var e=this.cardInstances.indexOf(t);e>=0&&this.cardInstances.splice(e,1)}}]}}]).factory("TDCardDelegate",["$rootScope",function(t){var e;return{like:function(t){e.getById(t).swipeLike()},pass:function(t){e.getById(t).swipePass()},msg:function(t){e.getById(t).swipeMsg()},colorLikeButton:function(t){e.getById(t).dragLock=!0,e.getById(t).buttonLock=!0,e.getById(t).likeButton.classList.add("active")},colorPassButton:function(t){e.getById(t).dragLock=!0,e.getById(t).buttonLock=!0,e.getById(t).passButton.classList.add("active")},colorDmButton:function(t){e.getById(t).dragLock=!0,e.getById(t).buttonLock=!0,e.getById(t).dmButton.classList.add("active")},isLocked:function(t){return e.getById(t).buttonLock},undoCardId:function(t){e.undoCardId=t},_register:function(t,n){e=n},_unregister:function(t){e=void 0}}}])}(window.ionic),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="monospaced.elastic"),angular.module("monospaced.elastic",[]).constant("msdElasticConfig",{append:""}).directive("msdElastic",["$timeout","$window","msdElasticConfig",function(t,e,n){return{require:"ngModel",restrict:"A, C",link:function(i,o,r,a){function s(){var t=v;g=d,w=getComputedStyle(d),angular.forEach(C,function(e){t+=e+":"+w.getPropertyValue(e)+";"}),y.setAttribute("style",t)}function l(){var e,n,o,r,a;g!==d&&s(),h||(h=!0,y.value=d.value+f,y.style.overflowY=d.style.overflowY,e=""===d.style.height?"auto":parseInt(d.style.height,10),n=getComputedStyle(d).getPropertyValue("width"),"px"===n.substr(n.length-2,2)&&(r=parseInt(n,10)-k.width,y.style.width=r+"px"),o=y.scrollHeight,o>P?(o=P,a="scroll"):I>o&&(o=I),o+=k.height,d.style.overflowY=a||"hidden",e!==o&&(i.$emit("elastic:resize",u,e,o),d.style.height=o+"px"),i.$emit("taResize",u),t(function(){h=!1},1,!1))}function c(){h=!1,l()}var d=o[0],u=o;if("TEXTAREA"===d.nodeName&&e.getComputedStyle){u.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var p=d.value;d.value="",d.value=p;var g,h,f=r.msdElastic?r.msdElastic.replace(/\\n/g,"\n"):n.append,m=angular.element(e),v="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",b=angular.element('<textarea aria-hidden="true" tabindex="-1" style="'+v+'"/>').data("elastic",!0),y=b[0],w=getComputedStyle(d),_=w.getPropertyValue("resize"),x="border-box"===w.getPropertyValue("box-sizing")||"border-box"===w.getPropertyValue("-moz-box-sizing")||"border-box"===w.getPropertyValue("-webkit-box-sizing"),k=x?{width:parseInt(w.getPropertyValue("border-right-width"),10)+parseInt(w.getPropertyValue("padding-right"),10)+parseInt(w.getPropertyValue("padding-left"),10)+parseInt(w.getPropertyValue("border-left-width"),10),height:parseInt(w.getPropertyValue("border-top-width"),10)+parseInt(w.getPropertyValue("padding-top"),10)+parseInt(w.getPropertyValue("padding-bottom"),10)+parseInt(w.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},M=parseInt(w.getPropertyValue("min-height"),10),S=parseInt(w.getPropertyValue("height"),10),I=Math.max(M,S)-k.height,P=parseInt(w.getPropertyValue("max-height"),10),C=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];u.data("elastic")||(P=P&&P>0?P:9e4,y.parentNode!==document.body&&angular.element(document.body).append(y),u.css({resize:"none"===_||"vertical"===_?"none":"horizontal"}).data("elastic",!0),"onpropertychange"in d&&"oninput"in d?d.oninput=d.onkeyup=l:d.oninput=l,m.bind("resize",c),i.$watch(function(){return a.$modelValue},function(t){c()}),i.$on("elastic:adjust",function(){s(),c()}),t(l,0,!1),i.$on("$destroy",function(){b.remove(),m.unbind("resize",c)}))}}}}]),function(){var t,e,n,i,o,r,a,s,l,c,d,u,p,g,h,f,m;t="ui.slider",e="uislider",n=function(t){return angular.element(t)},u=function(t){return""+t+"px"},s=function(t){return t.css({opacity:0})},h=function(t){return t.css({opacity:1})},c=function(t,e){return t.css({left:e})},a=function(t){return t[0].offsetWidth/2},d=function(t){
return t[0].offsetLeft},m=function(t){return t[0].offsetWidth},r=function(t,e){return d(e)-d(t)-m(t)},i=function(t){return isNaN(t)?t:Math.min(Math.max(0,t),100)},g=function(t,e,n,i){var o,r,a,s;return null==i&&(i=0),null==n&&(n=1/Math.pow(10,e)),r=(t-i)%n,s=r>n/2?t+n-r:t-r,o=Math.pow(10,e),a=s*o/o,parseFloat(a.toFixed(e))},o={mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},touch:{start:"touchstart",move:"touchmove",end:"touchend"}},f=function(t){return{restrict:"E",scope:{floor:"@",ceiling:"@",values:"=?",step:"@",highlight:"@",precision:"@",buffer:"@",dragstop:"@",ngModel:"=?",ngModelLow:"=?",ngModelHigh:"=?"},template:'<div class="uibar"><div class="selection"></div></div>\n<div class="handle low"></div><div class="handle high"></div>\n<div class="bubble limit low">{{ values.length ? values[floor || 0] : floor }}</div>\n<div class="bubble limit high">{{ values.length ? values[ceiling || values.length - 1] : ceiling }}</div>\n<div class="bubble value low">{{ values.length ? values[local.ngModelLow || local.ngModel || 0] : local.ngModelLow || local.ngModel || 0 }}</div>\n<div class="bubble value high">{{ values.length ? values[local.ngModelHigh] : local.ngModelHigh }}</div>',compile:function(e,r){var s,l,p,h;return p=null==r.ngModel&&null!=r.ngModelLow&&null!=r.ngModelHigh,l=p?"ngModelLow":"ngModel",s="ngModelHigh",h=["floor","ceiling","values",l],p&&h.push(s),{post:function(e,r,f){var v,b,y,w,_,x,k,M,S,I,P,C,T,L,$,D,E,A,z,B,F,R,U,O,H,N,q,W,Y;if(W=function(){var t,e,i,o;for(i=r.children(),o=[],t=0,e=i.length;e>t;t++)x=i[t],o.push(n(x));return o}(),v=W[0],$=W[1],C=W[2],k=W[3],w=W[4],I=W[5],S=W[6],z=n(v.children()[0]),!p){for(Y=[C,S],O=0,N=Y.length;N>O;O++)F=Y[O],F.remove();f.highlight||z.remove()}for(e.local={},e.local[l]=e[l],e.local[s]=e[s],y=!1,E=n(document),M=b=L=P=D=T=R=A=void 0,_=function(){var t,n,i,o;for(null==e.step&&(e.step=1),null==e.floor&&(e.floor=0),null==e.precision&&(e.precision=0),p||(e.ngModelLow=e.ngModel),(null!=(o=e.values)?o.length:void 0)&&null==e.ceiling&&(e.ceiling=e.values.length-1),e.local[l]=e[l],e.local[s]=e[s],n=0,i=h.length;i>n;n++)t=h[n],"number"==typeof t&&(e[t]=g(parseFloat(e[t]),parseInt(e.precision),parseFloat(e.step),parseFloat(e.floor)));return M=a($),b=m(v),L=0,P=b-m($),D=parseFloat(e.floor),T=parseFloat(e.ceiling),R=T-D,A=P-L},B=function(){if(0!==m(v)){var t,n,h,x,k,T;return _(),n=function(t){return i((t-L)/A*100)},h=function(t){return i((t-D)/R*100)},x=function(t){return u(t*A/100)},T=function(){var t,n;switch(c(w,u(b-m(w))),n=h(e.local[l]),c($,x(n)),c(I,u(d($)-a(I)+M)),c(z,u(d($)+M)),!0){case p:return t=h(e.local[s]),c(C,x(t)),c(S,u(d(C)-a(S)+M)),z.css({width:x(t-n)});case"right"===f.highlight:return z.css({width:x(110-n)});case"left"===f.highlight:return z.css({width:x(n)}),c(z,0)}},t=function(t,i,o,a){var c,d,u,h;return c=o,d=function(){return i.removeClass("active"),t.removeClass("active"),E.unbind(a.move),E.unbind(a.end),e.dragstop&&(e[s]=e.local[s],e[l]=e.local[l]),c=o,e.$apply()},u=function(t){var i,o,a,d,u,h,f,m;if(i=t.clientX||(null!=(u=t.touches)&&null!=(h=u[0])?h.clientX:void 0)||(null!=(f=t.originalEvent)&&null!=(m=f.changedTouches)?m[0].clientX:void 0)||0,o=i-r[0].getBoundingClientRect().left-M,o=Math.max(Math.min(o,P),L),a=n(o),d=D+R*a/100,p)switch(c){case l:d>e.local[s]?(c=s,$.removeClass("active"),I.removeClass("active"),C.addClass("active"),S.addClass("active"),T()):e.buffer>0&&(d=Math.min(d,e.local[s]-e.buffer));break;case s:d<e.local[l]?(c=l,C.removeClass("active"),S.removeClass("active"),$.addClass("active"),I.addClass("active"),T()):e.buffer>0&&(d=Math.max(d,parseInt(e.local[l])+parseInt(e.buffer)))}return d=g(d,parseInt(e.precision),parseFloat(e.step),parseFloat(e.floor)),e.local[c]=d,e.dragstop||(e[c]=d),T(),e.$apply()},h=function(e){return _(),i.addClass("active"),t.addClass("active"),T(),e.stopPropagation(),e.preventDefault(),E.bind(a.move,u),E.bind(a.end,d)},t.bind(a.start,h)},k=function(){var e,n,i,r;for(r=["touch","mouse"],n=0,i=r.length;i>n;n++)e=r[n],t($,I,l,o[e]),t(C,S,s,o[e]);return y=!0},y||k(),T()}},t(B),H=0,q=h.length;q>H;H++)U=h[H],e.$watch(U,B,!0);return window.addEventListener("resize",B)}}}}},p=["$timeout",f],(l=function(n,i){return i.module(t,[]).directive(e,p)})(window,window.angular)}.call(this),angular.module("GarnetRoom").run(["$templateCache",function(t){t.put("templates/main.html",'<ion-view>\r\n  <ion-content style="display: none"><!--fixes no animation bug-->\r\n  </ion-content>\r\n  <ion-tabs>\r\n    <ion-tab title="<span class=\'fa fa-user\'></span>" href="#/app/profile"><ion-nav-view name="profileTab"></ion-nav-view></ion-tab>\r\n    <ion-tab title="<span class=\'fa fa-sliders\'></span>" href="#/app/preferences"><ion-nav-view name="preferencesTab"></ion-nav-view></ion-tab>\r\n    <ion-tab title="<span class=\'fa icon-logo\'></span>" href="#/app/home"><ion-nav-view name="homeTab"></ion-nav-view></ion-tab>\r\n    <ion-tab title="<span class=\'fa fa-comments\'></span>" href="#/app/chats" badge="_flagCount">\r\n      <div class="bar-shadow"></div>\r\n      <ion-nav-bar class="bar-positive" no-tap-scroll="true">\r\n        <ion-nav-back-button class="gr-header-button">\r\n        </ion-nav-back-button>\r\n      </ion-nav-bar>\r\n      <ion-nav-view name="chatsTab"></ion-nav-view>\r\n    </ion-tab>\r\n    <ion-tab title="<span class=\'fa fa-ellipsis-v\'></span>" href="#/app/more"><ion-nav-view name="moreTab"></ion-nav-view></ion-tab>\r\n  </ion-tabs>  \r\n</ion-view>'),t.put("templates/modals/albums.html",'<ion-modal-view>\r\n  <ion-header-bar class="bar-positive modal-shadow">\r\n    <div class="buttons">\r\n      <button class="button button-clear gr-header-button" ng-click="hideAlbumsModal()">Back</button>\r\n    </div>\r\n    <h1 class="title">Facebook Albums</h1>\r\n  </ion-header-bar>\r\n  <ion-content class="gr-content" albums-paging-scroll id="albums-paging-scroll">\r\n    <div class="list">\r\n      <div ng-repeat="album in albumsModalData.albums">\r\n        <div ng-if="$index > 0" class="border-16"></div>\r\n        <ion-item ng-click="showPicsModal(album)">\r\n          <h2>{{album.name}}</h2>\r\n          <p>{{album.count}} picture<span ng-if="album.count !== 1">s</span></p>\r\n        </ion-item>\r\n      </div>\r\n    </div>\r\n    <ion-spinner ng-if="albumsModalData.paging" class="paging-spinner" icon="ios"></ion-spinner>\r\n  </ion-content>\r\n</ion-modal-view>'),t.put("templates/modals/detail.html",'<ion-modal-view>\r\n  <ion-content ng-class="(card.type === 1) ? \'detail-content-has-footer\' : \'\'" style="top: 0px">\r\n    <div id="detailContent" class="parallax">\r\n      <div class="parallax__layer--back">\r\n        <ion-slides options="options" slider="slider" style="width: 100vw; height: 100vw; background-color: #000">\r\n          <ion-slide-page ng-repeat="pic in card.picUrls" style="width: 100vw; height: 100vw">\r\n            <img gr-img ng-src="{{pic}}" style="width: 100%" ng-click="detailZoom($index)" />\r\n          </ion-slide-page>\r\n        </ion-slides>\r\n      </div>\r\n      <div class="parallax__layer--base" style="margin-top: 100vw;">\r\n        <div style="position: absolute; top: -66px; right: 10px">\r\n          <div style="color: #fff; text-align: center; position: absolute; bottom: 0; right: 0; background-color: rgba(0,0,0,0.6); border-radius: 2px">\r\n            <div ng-if="card.type === 1" style="white-space: nowrap">\r\n              <div>\r\n                <button ng-click="upvote(card.slideIdx)" ng-class="(card.pics[card.slideIdx].up) ? \'gr-vote-button-active\' : \'\'" class="gr-vote-button gr-vote-button-up"><span class="fa fa-sort-up"></span></button>\r\n              </div>\r\n              <div id="vote-count" style="font-size: 18px; line-height: 0; padding: 0px 5px 0px 5px">\r\n                {{card.pics[card.slideIdx].score}}\r\n              </div>\r\n              <div>\r\n                <button ng-click="downvote(card.slideIdx)" ng-class="(card.pics[card.slideIdx].down) ? \'gr-vote-button-active\' : \'\'" class="gr-vote-button gr-vote-button-down"><span class="fa fa-sort-down"></span></button>\r\n              </div>\r\n            </div>\r\n            <div ng-if="card.type !== 1" style="font-size: 18px; line-height: 1; padding: 5px; white-space: nowrap">\r\n              <span class="fa fa-sort" style="opacity: 0.4"></span> <span id="vote-count-sm">{{card.pics[card.slideIdx].score}}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class="detail-head">\r\n          <div id="detail-head-name">\r\n            <span style="font-weight: 700">{{card.name}}</span>, {{card.age}}&nbsp;&nbsp;<span ng-if="card.verified" class="fa fa-check-circle"></span>\r\n          </div>\r\n          <div class="detail-pager"></div>\r\n        </div>                \r\n        <div style="padding: 16px"><!--standard + fading white-->\r\n          <table>\r\n            <tr>\r\n              <td style="color: #999">\r\n                Total score\r\n              </td>\r\n              <td style="padding-left: 16px">\r\n                {{card.score}}\r\n              </td>\r\n            </tr>\r\n            <tr ng-if="card.dist">\r\n              <td style="color: #999; padding-top: 4px">\r\n                Distance\r\n              </td>\r\n              <td style="padding-left: 16px">\r\n                <span ng-if="_unitMi">{{card.distMi}} mi</span>\r\n                <span ng-if="!_unitMi">{{card.dist}} km</span>\r\n              </td>\r\n            </tr>\r\n            <tr ng-if="card.height">\r\n              <td style="color: #999; padding-top: 4px">\r\n                Height\r\n              </td>\r\n              <td style="padding-left: 16px">\r\n                <span ng-if="_unitFt">{{card.heightFt}}</span>\r\n                <span ng-if="!_unitFt">{{card.height}} cm</span>\r\n              </td>\r\n            </tr>\r\n          </table>\r\n          <div ng-if="card.edu.length" style="padding-top: 16px; width: 100%">\r\n            <div style="border-top: 1px solid #eee; padding-top: 16px; width: 100%">\r\n              <div style="color: #999; margin-bottom: 4px">Education</div>\r\n              <div ng-repeat="edu in card.edu" class="detail-text-indent">{{edu}}</div>\r\n            </div>\r\n          </div>\r\n          <div ng-if="card.work.length" style="padding-top: 16px; width: 100%">\r\n            <div style="border-top: 1px solid #eee; padding-top: 16px; width: 100%">\r\n              <div style="color: #999; margin-bottom: 4px">Occupation</div>\r\n              <div ng-repeat="work in card.work" class="detail-text-indent">{{work}}</div>\r\n            </div>\r\n          </div>\r\n          <div ng-if="card.bio.length" style="padding-top: 16px; width: 100%">\r\n            <div style="border-top: 1px solid #eee; padding-top: 16px; width: 100%">\r\n              <div style="color: #999; margin-bottom: 4px">About me</div>\r\n              <div class="detail-text">{{card.bio}}</div>\r\n            </div>\r\n          </div>\r\n          <div ng-if="card.cons.length" style="padding-top: 16px; width: 100%">\r\n            <div style="border-top: 1px solid #eee; padding-top: 16px; width: 100%">\r\n              <div style="color: #999; margin-bottom: 4px">Common connections</div>\r\n              <div ng-repeat="con in card.cons" style="position: relative; display: inline-block">\r\n                <img ng-src="{{con.pic}}" style="width: 80px; border-radius: 40px; margin: 5px" />\r\n                <div style="position: absolute; top: 0px; left: 0px">\r\n                  <span ng-if="!con.second">1<sup>st</sup></span>\r\n                  <span ng-if="con.second">2<sup>nd</sup></span>\r\n                </div>\r\n                <div style="margin: 0px 5px 0px 5px;font-size: 14px; text-align: center; width: 80px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis">\r\n                  {{con.name}}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>    \r\n  </ion-content>\r\n  <div ng-if="card.type === 1" style="position: absolute; margin: auto; left: 0; right: 0; bottom: 0;">\r\n    <div class="hseparator"></div>\r\n    <div style="position: relative; background-color: #fff; display: flex">\r\n      <button ng-click="closePass(card.cardId)" class="button button-block button-positive button-outline gr-nav-button"><span class="fa icon-pass-button"></span></button>\r\n      <div class="vseparator"></div>\r\n      <button ng-click="closeLike(card.cardId)" class="button button-block button-positive button-outline gr-nav-button"><span class="fa icon-like-button"></span></button>\r\n    </div>\r\n  </div>\r\n\r\n  <ion-header-bar id="gradient-header">\r\n    <div class="buttons">\r\n      <button class="button button-clear gr-header-button" ng-click="hideDetailModal()">Back</button>\r\n    </div>\r\n    <h1 class="title"></h1>\r\n    <div ng-if="card.type !== 0" class="buttons">\r\n      <button class="button button-clear gr-header-button" ng-click="_report(card._id)">Report</button>\r\n    </div>\r\n  </ion-header-bar>  \r\n  <ion-content id="detail-zoom" ng-show="card.zoomUrl" style="z-index: 9999; left: 0px; top: 0px; overflow: scroll; -webkit-overflow-scrolling: auto !important; width: 100vw; height: 100vh; padding: 0px; margin: 0px">\r\n    <div style="width: 100vh; height: 100vh">\r\n      <img id="detail-zoom-pic" ng-src="{{card.zoomUrl}}" style="display: block; width: 100%" ng-click="detailZoom()" />\r\n    </div>\r\n  </ion-content>\r\n</ion-modal-view>'),t.put("templates/modals/instructions.html",'<ion-modal-view style="background-color: #fff">\r\n  <ion-header-bar style="background: none !important; border: none !important">\r\n    <h1 class="title">Instructions</h1>\r\n    <div class="buttons">\r\n      <button class="button button-clear gr-header-button" style="color: #333 !important" ng-click="_hideInstructionsModal()">Close</button>\r\n    </div>\r\n  </ion-header-bar>\r\n  <ion-content style="top: 0px">\r\n    <ion-slides options="{loop: false, lazyLoading: false, preloadImages: true, pagination: \'.gr-pager\'}" slider="instructionsSlider" style="text-align: center; width: 100%; height: 100%">\r\n      <ion-slide-page style="width: 100%; height: 100%; display: table">\r\n        <div style="display: table-cell; vertical-align:middle ">\r\n          <div class="padding">\r\n            <span class="fa fa-sort gr-mid" style="font-size: 72px; opacity: 1"></span>\r\n          </div>\r\n          <div style="padding: 16px 32px">\r\n            <div style="padding-bottom: 16px">\r\n              <span style="font-weight: 700">Up- or downvote</span> photos of other members <span style="white-space:nowrap">based on style.</span>\r\n            </div>\r\n            <div style="padding-bottom: 16px">\r\n              Members with high scores are prioritized by our matching algorithm and their vote is <span style="white-space:nowrap">given more influence.</span>\r\n            </div>\r\n            <div style="padding-bottom: 16px">\r\n              Profiles with exceedingly negative scores <span style="white-space:nowrap">will be hidden.</span>\r\n            </div>\r\n            <div style="padding-bottom: 16px">\r\n              You can always reset your score by <span style="white-space:nowrap">replacing your photos.</span>\r\n            </div>\r\n          </div>\r\n        </div>        \r\n      </ion-slide-page>\r\n      <ion-slide-page style="width: 100%; height: 100%; display: table">\r\n        <div style="display: table-cell; vertical-align:middle ">\r\n          <div class="padding">\r\n            <span class="fa fa-check gr-mid" style="font-size: 72px; opacity: 1"></span>\r\n          </div>\r\n          <div style="padding: 16px 32px">\r\n            <span style="font-weight: 700">Like</span> members who you want to <span style="white-space:nowrap">exchange messages with.</span>\r\n          </div>\r\n        </div>\r\n      </ion-slide-page>\r\n      <ion-slide-page style="width: 100%; height: 100%; display: table">\r\n        <div style="display: table-cell; vertical-align:middle ">\r\n          <div class="padding">\r\n            <span class="fa fa-times gr-mid" style="font-size: 72px; opacity: 1"></span>\r\n          </div>\r\n          <div style="padding: 16px 32px">\r\n            <span style="font-weight: 700">Pass</span> members who could not <span style="white-space:nowrap">capture your interest.</span>\r\n          </div>\r\n        </div>\r\n      </ion-slide-page>\r\n      <ion-slide-page style="width: 100%; height: 100%; display: table">\r\n        <div style="display: table-cell; vertical-align:middle ">\r\n          <div class="padding">\r\n            <span class="fa fa-undo gr-mid" style="font-size: 72px; opacity: 1"></span>\r\n          </div>\r\n          <div style="padding: 16px 32px">\r\n            <span style="font-weight: 700">Undo</span> an accidental pass by <span style="white-space:nowrap">shaking your phone.</span>\r\n          </div>\r\n        </div>\r\n      </ion-slide-page>        \r\n    </ion-slides>\r\n    <div class="gr-pager"></div>\r\n  </ion-content>\r\n</ion-modal-view>'),t.put("templates/modals/learn.html",'<ion-modal-view style="background-color: #fff">\r\n  <ion-header-bar style="background: none !important; border: none !important">\r\n    <h1 class="title"></h1>\r\n    <div class="buttons">\r\n      <button class="button button-clear gr-header-button-lg button-icon ion-ios-close-empty" style="color: #333 !important" ng-click="learnModal.hide()"></button>\r\n    </div>\r\n  </ion-header-bar>\r\n  <ion-content>\r\n    <ion-slides options="{loop: false, lazyLoading: false, preloadImages: true, pagination: \'.gr-pager\'}"  slider="loginSlider" style="text-align: center; width: 100%; height: 100%">\r\n      <ion-slide-page style="width: 100%; height: 100%">\r\n        <table style="width: 100%; height: 100%">\r\n          <tr style="height: 100%">\r\n            <td style="height: 100%; padding: 0px 32px">\r\n              <div style="width: 100%; height: 100%; display: table">\r\n                <div style="display: table-cell; vertical-align: middle">\r\n                  <img src="images/slides/1.svg" style="height: 8vw" />\r\n                </div>\r\n              </div>              \r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td>\r\n              <div style="width: 100%; padding: 0px 16px 64px 16px">\r\n                <img src="images/slides/1.jpg" style="width: 100%; display: block; border-radius: 4px" />\r\n              </div>              \r\n            </td>\r\n          </tr>          \r\n        </table>\r\n      </ion-slide-page>\r\n      <ion-slide-page style="width: 100%; height: 100%">\r\n        <table style="width: 100%; height: 100%">\r\n          <tr style="height: 100%">\r\n            <td style="height: 100%; padding: 0px 32px">\r\n              <div style="width: 100%; height: 100%; display: table">\r\n                <div style="display: table-cell; vertical-align: middle">\r\n                  <img src="images/slides/2.svg" style="height: 8vw" />\r\n                </div>\r\n              </div>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td>\r\n              <div style="width: 100%; padding: 0px 16px 64px 16px">\r\n                <img src="images/slides/2.jpg" style="width: 100%; display: block; border-radius: 4px" />\r\n              </div>\r\n            </td>\r\n          </tr>\r\n        </table>\r\n      </ion-slide-page>\r\n      <ion-slide-page style="width: 100%; height: 100%">\r\n        <div style="width: 100%; height: 100%; display: table; position: relative; top: -22px">\r\n          <div style="display: table-cell; vertical-align: middle">\r\n            <img src="images/slides/3.svg" style="height: 128vw" />\r\n          </div>\r\n        </div>\r\n      </ion-slide-page>\r\n      <ion-slide-page style="width: 100%; height: 100%">\r\n        <table style="width: 100%; height: 100%">\r\n          <tr style="height: 100%">\r\n            <td style="height: 100%; padding: 0px 32px">\r\n              <div style="width: 100%; height: 100%; display: table">\r\n                <div style="display: table-cell; vertical-align: middle">\r\n                  <img src="images/slides/4.svg" style="height: 8vw" />\r\n                </div>\r\n              </div>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td>\r\n              <div style="width: 100%; padding: 0px 16px 64px 16px">\r\n                <img src="images/slides/4.jpg" style="width: 100%; display: block; border-radius: 4px" />\r\n              </div>\r\n            </td>\r\n          </tr>\r\n        </table>\r\n      </ion-slide-page>\r\n      <ion-slide-page style="width: 100%; height: 100%">\r\n        <table style="width: 100%; height: 100%">\r\n          <tr style="height: 100%">\r\n            <td style="height: 100%; padding: 0px 32px">\r\n              <div style="width: 100%; height: 100%; display: table">\r\n                <div style="display: table-cell; vertical-align: middle">\r\n                  <img src="images/slides/5.svg" style="height: 8vw" />\r\n                </div>\r\n              </div>\r\n            </td>\r\n          </tr>\r\n          <tr>\r\n            <td>\r\n              <div style="width: 100%; padding: 0px 16px 64px 16px">\r\n                <img src="images/slides/5.jpg" style="width: 100%; display: block; border-radius: 4px" />\r\n              </div>\r\n            </td>\r\n          </tr>\r\n        </table>\r\n      </ion-slide-page>\r\n    </ion-slides>\r\n    <div class="gr-pager"></div>\r\n  </ion-content>\r\n</ion-modal-view>'),t.put("templates/modals/match.html",'<ion-modal-view style="background-color: #fff">\r\n  <ion-content>\r\n    <div style="display: table; position: absolute; width: 100%; height: 100%;">\r\n      <div style="display: table-cell; text-align: center; width: 100%; vertical-align: middle">\r\n        <img src="images/newmatch.svg" style="width: 200px; margin-bottom: 50px" />\r\n        <div style="padding: 0px 0px 25px 0px; font-size: 0px; line-height: 0px">\r\n          <img gr-error-img class="match-pic" ng-src="{{_picUrls[0]}}" style="transform: translate3d(-20px, 0px, 0px); -webkit-transform: translate3d(-20px, 0px, 0px)" />\r\n          <img gr-error-img class="match-pic" ng-src="{{match.pic}}" style="transform: translate3d(20px, 0px, 0px); -webkit-transform: translate3d(20px, 0px, 0px)" />\r\n        </div>\r\n        <div style="font-size: 18px; line-height: 18px; padding-bottom: 50px">\r\n          You and {{match.name}} like each other.\r\n        </div>\r\n        <button ng-click="chat()" class="button button-positive match-button">\r\n          Chat\r\n        </button>\r\n        <button ng-click="hideMatchModal()" class="button button-positive button-outline match-button">\r\n          Back\r\n        </button>        \r\n      </div>\r\n    </div>\r\n  </ion-content>\r\n</ion-modal-view>'),t.put("templates/modals/personal.html",'<ion-modal-view>\r\n  <ion-header-bar class="bar-positive modal-shadow">\r\n    <h1 class="title">Personal Details</h1>\r\n    <div class="buttons">\r\n      <button ng-click="hidePersonalModal()" class="button button-clear gr-header-button">Done</button>\r\n    </div>\r\n  </ion-header-bar>\r\n  <ion-content class="gr-content">\r\n    <ion-list>\r\n      <label class="item item-input item-select">\r\n        <div class="input-label">\r\n          I am...\r\n        </div>\r\n        <select ng-model="temp.gender">\r\n          <option value="0">Male</option>\r\n          <option value="1">Female</option>\r\n        </select>\r\n      </label>\r\n      <div class="border-16"></div>\r\n      <label class="item item-input item-select">\r\n        <div class="input-label">\r\n          Height\r\n        </div>\r\n        <select ng-model="temp.height">\r\n          <option value="0">No selection</option>\r\n          <option value="150">150 cm / 4\' 11"</option>\r\n          <option value="151">151 cm / 4\' 11"</option>\r\n          <option value="152">152 cm / 5\' 0"</option>\r\n          <option value="153">153 cm / 5\' 0"</option>\r\n          <option value="154">154 cm / 5\' 1"</option>\r\n          <option value="155">155 cm / 5\' 1"</option>\r\n          <option value="156">156 cm / 5\' 1"</option>\r\n          <option value="157">157 cm / 5\' 2"</option>\r\n          <option value="158">158 cm / 5\' 2"</option>\r\n          <option value="159">159 cm / 5\' 3"</option>\r\n          <option value="160">160 cm / 5\' 3"</option>\r\n          <option value="161">161 cm / 5\' 3"</option>\r\n          <option value="162">162 cm / 5\' 4"</option>\r\n          <option value="163">163 cm / 5\' 4"</option>\r\n          <option value="164">164 cm / 5\' 5"</option>\r\n          <option value="165">165 cm / 5\' 5"</option>\r\n          <option value="166">166 cm / 5\' 5"</option>\r\n          <option value="167">167 cm / 5\' 6"</option>\r\n          <option value="168">168 cm / 5\' 6"</option>\r\n          <option value="169">169 cm / 5\' 7"</option>\r\n          <option value="170">170 cm / 5\' 7"</option>\r\n          <option value="171">171 cm / 5\' 7"</option>\r\n          <option value="172">172 cm / 5\' 8"</option>\r\n          <option value="173">173 cm / 5\' 8"</option>\r\n          <option value="174">174 cm / 5\' 9"</option>\r\n          <option value="175">175 cm / 5\' 9"</option>\r\n          <option value="176">176 cm / 5\' 9"</option>\r\n          <option value="177">177 cm / 5\' 10"</option>\r\n          <option value="178">178 cm / 5\' 10"</option>\r\n          <option value="179">179 cm / 5\' 10"</option>\r\n          <option value="180">180 cm / 5\' 11"</option>\r\n          <option value="181">181 cm / 5\' 11"</option>\r\n          <option value="182">182 cm / 6\' 0"</option>\r\n          <option value="183">183 cm / 6\' 0"</option>\r\n          <option value="184">184 cm / 6\' 0"</option>\r\n          <option value="185">185 cm / 6\' 1"</option>\r\n          <option value="186">186 cm / 6\' 1"</option>\r\n          <option value="187">187 cm / 6\' 2"</option>\r\n          <option value="188">188 cm / 6\' 2"</option>\r\n          <option value="189">189 cm / 6\' 2"</option>\r\n          <option value="190">190 cm / 6\' 3"</option>\r\n          <option value="191">191 cm / 6\' 3"</option>\r\n          <option value="192">192 cm / 6\' 4"</option>\r\n          <option value="193">193 cm / 6\' 4"</option>\r\n          <option value="194">194 cm / 6\' 4"</option>\r\n          <option value="195">195 cm / 6\' 5"</option>\r\n          <option value="196">196 cm / 6\' 5"</option>\r\n          <option value="197">197 cm / 6\' 6"</option>\r\n          <option value="198">198 cm / 6\' 6"</option>\r\n          <option value="199">199 cm / 6\' 6"</option>\r\n          <option value="200">200 cm / 6\' 7"</option>\r\n          <option value="201">201 cm / 6\' 7"</option>\r\n          <option value="202">202 cm / 6\' 8"</option>\r\n          <option value="203">203 cm / 6\' 8"</option>\r\n          <option value="204">204 cm / 6\' 8"</option>\r\n          <option value="205">205 cm / 6\' 9"</option>\r\n          <option value="206">206 cm / 6\' 9"</option>\r\n          <option value="207">207 cm / 6\' 9"</option>\r\n          <option value="208">208 cm / 6\' 10"</option>\r\n          <option value="209">209 cm / 6\' 10"</option>\r\n          <option value="210">210 cm / 6\' 11"</option>\r\n          <option value="211">211 cm / 6\' 11"</option>\r\n          <option value="212">212 cm / 6\' 11"</option>\r\n          <option value="213">213 cm / 7\' 0"</option>\r\n          <option value="214">214 cm / 7\' 0"</option>\r\n          <option value="215">215 cm / 7\' 1"</option>\r\n          <option value="216">216 cm / 7\' 1"</option>\r\n          <option value="217">217 cm / 7\' 1"</option>\r\n          <option value="218">218 cm / 7\' 2"</option>\r\n          <option value="219">219 cm / 7\' 2"</option>\r\n          <option value="220">220 cm / 7\' 3"</option>\r\n        </select>\r\n      </label>\r\n      <div class="border-16"></div>\r\n      <label class="item item-input item-stacked-label">\r\n        <span class="input-label" style="width: 100%">About</span>\r\n        <textarea ng-trim="true" ng-model="temp.bio" placeholder="Introduce yourself..." maxlength="500" style="height: 80px"></textarea>\r\n        <div style="position: absolute; top: 16px; right: 16px; color: #888; font-size: 13px">{{500-temp.bio.length}}</div>\r\n      </label>\r\n    </ion-list>\r\n  </ion-content>\r\n</ion-modal-view>'),t.put("templates/modals/pics.html",'<ion-modal-view>\r\n    <ion-header-bar class="bar-positive modal-shadow">\r\n      <div class="buttons">\r\n        <button class="button button-clear gr-header-button" ng-click="hidePicsModal()">Back</button>\r\n      </div>\r\n      <h1 class="title">{{picsModalData.title}}</h1>\r\n    </ion-header-bar>\r\n    <ion-content class="gr-content" pics-paging-scroll id="pics-paging-scroll" style="line-height: 0px">\r\n      <div style="margin-top: 2px"></div>\r\n      <div ng-repeat="pic in picsModalData.pics" ng-click="showCropModal(pic)" class="gr-button" style="display: inline-block; margin: 0px 0px 2px 2px;">\r\n        <img gr-error-img class="center-cropped" ng-src="{{pic.thumb}}" style="width: {{::modalPicSize}}px; height: {{::modalPicSize}}px"/>\r\n      </div>\r\n      <ion-spinner ng-if="picsModalData.paging" class="paging-spinner" icon="ios"></ion-spinner>\r\n    </ion-content>\r\n</ion-modal-view>'),t.put("templates/views/chat.html",'<ion-view id="userMessagesView">\r\n  <!-- cache-view="false"-->\r\n  <ion-nav-title >\r\n    <div class="title gr-button" ng-click="showDetailModal()">\r\n      <div id="chat-title-pic-container">\r\n        <img gr-error-img id="chat-title-pic" ng-src="{{chat.picSm}}" />\r\n      </div>\r\n      {{chat.name}}\r\n    </div>    \r\n  </ion-nav-title>\r\n  <ion-nav-buttons side="right">\r\n    <button class="button button-clear gr-header-button-lg" ng-click="showActions()"><span class="fa fa-ellipsis-v" style="font-size: 20px !important;"></span></button>\r\n  </ion-nav-buttons>\r\n  <ion-content class="has-header has-footer" id="chatScroll" delegate-handle="userMessageScroll" chat-scroll>\r\n    <div ng-if="!chat.msgs.length" style="width: 100%; height: 100%; display: table">\r\n      <div style="display: table-cell; vertical-align: middle; width: 100%; text-align: center">\r\n        <a class="gr-button" ng-click="showDetailModal()">\r\n          <img gr-chat-img ng-src="{{chat.picMd}}" style="width: 80px; height: 80px; border-radius: 50%" />\r\n        </a>\r\n        <div ng-if="chat.name" style="color: #333; font-size: 18px">You matched with {{chat.name}}!</div>\r\n        <div ng-if="chat.name" style="color: #999">Start a conversation.</div>\r\n      </div>\r\n    </div>\r\n    <div ng-if="chat.msgs.length" style="width: 100%; height: 16px"></div>\r\n    <div ng-repeat="msg in chat.msgs | limitTo:-_msgLimit" class="message-wrapper" on-hold="onMessageHold($event, $index, msg)">\r\n      <div ng-if="msg.stamp" style="text-align: center; font-size: 13px">\r\n        {{msg.time | amCalendar}}\r\n      </div>\r\n      <div ng-if="_user._id !== msg.by">\r\n        <a class="gr-button" ng-click="showDetailModal()" style="height: 40px; width: 40px">\r\n          <img gr-error-img class="profile-pic left" ng-src="{{chat.picSm}}" />\r\n        </a>\r\n        <div class="chat-bubble left">\r\n          <div class="message" autolinker>{{msg.text}}</div>\r\n        </div>\r\n      </div>\r\n      <div ng-if="_user._id === msg.by">\r\n        <div class="chat-bubble right">\r\n          <div class="message" autolinker>{{msg.text}}</div>\r\n        </div>\r\n      </div>\r\n      <div class="cf"></div>\r\n    </div>\r\n    <div ng-if="chat.msgs.length" style="width: 100%; height: 10px"></div><!--instead of margin last-child because ios bug-->\r\n  </ion-content>\r\n  <ion-footer-bar class="message-footer" keyboard-attach>\r\n    <textarea ng-trim="true" ng-model="input.message" placeholder="Type your message..." maxlength="500" msd-elastic></textarea>\r\n    <button class="button button-clear footer-btn" ng-click="sendMessage()" ng-disabled="sending || !input.message || input.message === \'\'"><span class="fa fa-send"></span></button>\r\n  </ion-footer-bar>\r\n  <!--\r\n  <form name="sendMessageForm" ng-submit="sendMessage(sendMessageForm)" novalidate>\r\n    <ion-footer-bar class="item-input-inset message-footer" keyboard-attach>\r\n      <label class="item-input-wrapper">\r\n        <textarea ng-trim="true" ng-model="input.message" value="" placeholder="Type your message..." required minlength="1" maxlength="500" msd-elastic></textarea>\r\n      </label>\r\n      <button class="button button-clear footer-btn" type="submit" ng-disabled="sending || !input.message || input.message === \'\'"><span class="fa fa-send"></span></button>\r\n    </ion-footer-bar>\r\n  </form>\r\n    -->\r\n</ion-view>'),
t.put("templates/views/chats.html",'<ion-view>\r\n  <ion-nav-buttons side="left">\r\n    <button ng-if="_hasMessages" class="button button-clear gr-header-button-lg" ng-click="toggleDelete()" style="font-size: 20px !important;"><span class="fa fa-times"></span></button>\r\n  </ion-nav-buttons>\r\n  <ion-nav-title>\r\n    <h1 class="title" ng-click="_scrollTop()">\r\n      Matches\r\n    </h1>    \r\n  </ion-nav-title>\r\n  <ion-nav-buttons side="right">\r\n    <button ng-if="_hasMessages" class="button button-clear gr-header-button-lg" ng-click="toggleSearch()" style="font-size: 16px !important;">\r\n      <span class="fa fa-search"></span>\r\n    </button>\r\n  </ion-nav-buttons>\r\n  <ion-header-bar ng-if="_hasMessages && search" class="bar bar-subheader item-input-inset" style="border-bottom: 1px solid #ddd; height: 45px">\r\n    <div class="item-input-wrapper">\r\n      <i style="font-size: 20px" class="icon ion-ios-search placeholder-icon"></i>\r\n      <input type="search" placeholder="Search..." ng-model="data.searchQuery">\r\n      <button class="button button-icon ion-ios-close-empty" style="color: #aaa; position: relative; right: -10px" ng-click="clearSearch()"></button>\r\n    </div>\r\n  </ion-header-bar>\r\n  <ion-content ng-class="_hasMessages && search ? \'gr-content has-subheader\' : \'gr-content\'">\r\n    <ion-list show-delete="showDelete">\r\n      <div ng-repeat="chat in _chats | searchFilter:data.searchQuery" style="position: relative">\r\n        <div ng-if="$index > 0" ng-class="showDelete ? \'chats-border chats-border-delete\' : \'chats-border\'"></div>\r\n        <ion-item class="item-avatar-left match-item" ng-click="_openChat(chat)">\r\n          <img gr-chat-img ng-class="(chat.flag)?\'chat-active\':\'\'" ng-src="{{chat.picSm}}" style="border-radius: 50%; padding: 0px">\r\n          <h2>\r\n            {{chat.name}}            \r\n          </h2>          \r\n          <p>{{chat.lastMsg}}</p>\r\n          <ion-delete-button ng-click="_removeChat(chat)">\r\n            <span class="fa fa-times"></span>\r\n          </ion-delete-button>                              \r\n        </ion-item>       \r\n        <a class="chats-pic-button" ng-click="showDetailModal(chat)"></a>\r\n      </div>        \r\n    </ion-list>\r\n    <div ng-if="!_hasMessages" style="position: absolute; width: 100%; height: 100%; background-color: #fff; display: table; padding-bottom: 47px; top: 0; left: 0">\r\n      <div style="text-align: center; display: table-cell; vertical-align: middle">\r\n        <div style="font-size: 72px; line-height: 72px; opacity: 0.25">\r\n          <span class="fa fa-info gr-mid"></span>\r\n        </div>\r\n        <div class="padding-top padding-left padding-right">\r\n          You currently do not have any matches.\r\n        </div>\r\n      </div>\r\n      <button class="button button-block button-positive gr-noradius" ng-click="_share()" style="position: absolute; left: 0; bottom: 1px; margin: 0px">\r\n        Invite your friends\r\n      </button>\r\n    </div>\r\n    <div class="animate-show" ng-if="!_user.waitlist" ng-show="_tempLastEvent === null" style="position: absolute; width: 100%; height: 100%; background-color: #fff; display: table; top: 0; left: 0; z-index: 9999">\r\n      <div style="text-align: center; display: table-cell; vertical-align: middle; font-size: 0px">\r\n        <ion-spinner id="homeSpinner" icon="ripple" style="opacity: 0.25"></ion-spinner>\r\n      </div>\r\n    </div>\r\n  </ion-content>  \r\n\r\n  <div ng-if="_userProgress < 4">\r\n    <ion-content class="has-header has-tabs">\r\n      <div style="position: absolute; width: 100%; height: 100%; background-color: #fff; display: table; top: 0; left: 0;">\r\n        <div style="text-align: center; display: table-cell; vertical-align: middle">\r\n          <div style="font-size: 16px; padding: 16px">\r\n            This tab will become available when you have filled out your profile and <span style="white-space:nowrap">set your preferences.</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ion-content>\r\n  </div>\r\n</ion-view>'),t.put("templates/views/home.html",'<ion-view>\r\n  <ion-header-bar class="bar-positive modal-shadow">\r\n    <h1 class="title"><img class="gr-title" src="images/title-white.svg" /></h1>\r\n  </ion-header-bar>\r\n  <ion-content style="overflow: hidden"> \r\n    <div style="position: absolute; width: 100%; height: 100%; background-color: #fff; display: table; padding-bottom: 47px; top: 0; left: 0; z-index: 0">\r\n      <div style="text-align: center; display: table-cell; vertical-align: middle">\r\n        <div style="font-size: 72px; line-height: 72px; opacity: 0.25">\r\n          <span class="fa fa-clock-o gr-mid"></span>\r\n        </div>\r\n        <div class="padding-top padding-left padding-right">\r\n          At the moment there are no members within your preferences. Please <span style="white-space:nowrap">keep checking back.</span>\r\n        </div>\r\n      </div>\r\n      <button class="button button-block button-positive gr-noradius" ng-click="_share()" style="position: absolute; left: 0; bottom: 1px; margin: 0px">\r\n        Invite your friends\r\n      </button>\r\n    </div>\r\n\r\n    <div class="animate-show" ng-if="!disableLoading" ng-show="_showLoading" style="position: absolute; width: 100%; height: 100%; background-color: #fff; display: table; top: 0; left: 0; z-index: 0">\r\n      <div style="text-align: center; display: table-cell; vertical-align: middle; font-size: 0px">\r\n        <ion-spinner id="homeSpinner" icon="ripple" style="opacity: 0.25"></ion-spinner>\r\n      </div>\r\n    </div>\r\n\r\n    <td-cards ng-show="_cards.length" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: 0">\r\n      <td-card ng-repeat="card in _cards | limitTo:4" style="position: absolute; top: -1px; bottom: 0px; left:-1px; right:-1px; margin:auto; border: 1px solid #e6e6e6"\r\n               on-transition-pass="transitionPass($index)"\r\n               on-transition-like="transitionLike($index)"\r\n               on-transition-msg="transitionMsg($index)">\r\n        <img ng-click="showDetailModal()" gr-img ng-src="{{card.picUrls[0]}}" style="width: 100vw; height: 100vw; display: block">\r\n        <div style="position: absolute; left: 0; bottom: 0; width: 100%; height: {{cardInfoHeight}}px; background-color: #fff">\r\n          <div style="position: absolute; top: -66px; right: 10px">\r\n            <div style="color: #fff; text-align: center; position: absolute; bottom: 0; right: 0; background-color: rgba(0,0,0,0.6); border-radius: 2px">\r\n              <div style="white-space: nowrap">\r\n                <div>\r\n                  <button ng-click="upvote(0, $index)" ng-class="(card.pics[0].up) ? \'gr-vote-button-active\' : \'\'" class="gr-vote-button gr-vote-button-up"><span class="fa fa-sort-up"></span></button>\r\n                </div>\r\n                <div style="font-size: 18px; line-height: 0; padding: 0px 5px 0px 5px">\r\n                  {{card.pics[0].score}}\r\n                </div>\r\n                <div>\r\n                  <button ng-click="downvote(0, $index)" ng-class="(card.pics[0].down) ? \'gr-vote-button-active\' : \'\'" class="gr-vote-button gr-vote-button-down"><span class="fa fa-sort-down"></span></button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="detail-head" style="padding-top: 1px">\r\n            <span style="font-weight: 700">{{card.name}}</span>, {{card.age}}&nbsp;&nbsp;<span ng-if="card.verified" class="fa fa-check-circle"></span>\r\n            <span style="float: right; padding-right: 16px" class="gr-button" ng-click="showDetailModal()">\r\n              <span class="fa fa-sort" style="opacity: 0.4"></span> {{card.score}}&nbsp;&nbsp;&nbsp;<span class="fa fa-users" style="font-size: 16px; opacity: 0.4"></span> {{card.cons.length}}&nbsp;&nbsp;&nbsp;<span class="fa fa-camera-retro" style="opacity: 0.4"></span> {{card.picUrls.length}}\r\n            </span>\r\n          </div>\r\n          <div style="position: relative; line-height: 1.75; margin: 10px 16px 10px 16px">\r\n            <div style="color: #999">\r\n              <div>Education</div>\r\n              <div>Occupation</div>\r\n              <div ng-if="showDist">Distance</div>\r\n            </div>\r\n            <div style="position: absolute; top: 0; left: 0; padding-left: 96px; width: 100%">\r\n              <div style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis">\r\n                <span ng-if="card.edu.length">{{card.edu[0]}}</span>\r\n                <span ng-if="!card.edu.length">-</span>                \r\n              </div>\r\n              <div style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis">\r\n                <span ng-if="card.work.length">{{card.work[0]}}</span>\r\n                <span ng-if="!card.work.length">-</span>\r\n              </div>\r\n              <div ng-if="showDist" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis">\r\n                <span ng-if="!_unitMi">{{card.dist}} km</span>\r\n                <span ng-if="_unitMi">{{card.distMi}} mi</span>\r\n              </div>\r\n            </div>\r\n          </div>             \r\n          <div style="position: absolute; margin: auto; left: 0; right: 0; bottom: 0; background-color: #fff; padding: 0px">\r\n            <div class="hseparator"></div>\r\n            <div style="display: flex">\r\n              <button id="pass-button" ng-click="swipePass(card.cardId)" class="button button-block button-positive button-outline gr-nav-button"><span class="fa icon-pass-button"></span></button>\r\n              <div class="vseparator"></div>\r\n              <button id="like-button" ng-click="swipeLike(card.cardId)" class="button button-block button-positive button-outline gr-nav-button"><span class="fa icon-like-button"></span></button>\r\n            </div>\r\n          </div>   \r\n        </div>\r\n      </td-card>\r\n    </td-cards>  \r\n    \r\n    <div ng-if="_user.waitlist" style="position: absolute; width: 100%; height: 100%; background-color: #fff; display: table; padding-bottom: 47px; top: 0; left: 0; z-index: 0">\r\n      <div style="text-align: center; display: table-cell; vertical-align: middle">\r\n        <div style="font-size: 72px; line-height: 72px; opacity: 0.25">\r\n          <span class="fa icon-logo gr-mid"></span>\r\n        </div>\r\n        <div class="padding-top padding-left padding-right">\r\n          Thank you for your interest.<br />\r\n          You have been waitlisted for membership.<br />\r\n          We will send you a push notification when <span style="white-space:nowrap">your status changes.</span>\r\n        </div>\r\n      </div>\r\n      <button class="button button-block button-positive gr-noradius" ng-click="_share()" style="position: absolute; left: 0; bottom: 1px; margin: 0px">\r\n        Invite your friends\r\n      </button>\r\n    </div>\r\n\r\n    <div ng-if="_showNoLocation" style="position: absolute; width: 100%; height: 100%; background-color: #fff; display: table; padding-bottom: 47px; top: 0; left: 0; z-index: 0">\r\n      <div style="text-align: center; display: table-cell; vertical-align: middle">\r\n        <div style="font-size: 72px; line-height: 72px; opacity: 0.25">\r\n          <span class="fa fa-map-marker gr-mid"></span>\r\n        </div>\r\n        <div class="padding-top padding-left padding-right">\r\n          Please enable the (network-based) geolocation function of your phone to proceed. It may take a few seconds for the app to <span style="white-space:nowrap">detect the change.</span>\r\n        </div>\r\n      </div>\r\n      <button class="button button-block button-positive gr-noradius" ng-click="openSettings()" style="position: absolute; left: 0; bottom: 1px; margin: 0px">\r\n        Open location settings\r\n      </button>\r\n    </div> \r\n\r\n    <div ng-if="!_user.waitlist && _user.visible === false" style="position: absolute; width: 100%; height: 100%; background-color: #fff; display: table; padding-bottom: 47px; top: 0; left: 0; z-index: 0">\r\n      <div style="text-align: center; display: table-cell; vertical-align: middle">\r\n        <div style="font-size: 72px; line-height: 72px; opacity: 0.25">\r\n          <span class="fa fa-exclamation gr-mid"></span>\r\n        </div>\r\n        <div class="padding-top padding-left padding-right">\r\n          Enable discovery to see potential matches.\r\n        </div>\r\n      </div>\r\n      <button class="button button-block button-positive gr-noradius" ng-click="enableDiscovery()" style="position: absolute; left: 0; bottom: 1px; margin: 0px">\r\n        Enable discovery\r\n      </button>\r\n    </div>\r\n  </ion-content>\r\n\r\n  <div ng-if="_userProgress < 4">\r\n    <ion-content class="has-header has-tabs">\r\n      <div style="position: absolute; width: 100%; height: 100%; background-color: #fff; display: table; top: 0; left: 0;">\r\n        <div style="text-align: center; display: table-cell; vertical-align: middle">\r\n          <div style="font-size: 16px; padding: 16px">\r\n            This tab will become available when you have filled out your profile and <span style="white-space:nowrap">set your preferences.</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ion-content>\r\n  </div>\r\n</ion-view>\r\n'),t.put("templates/views/login.html",'<ion-view>\r\n  <ion-content>\r\n    <img id="login-man" src="images/login-man.jpg" style="position: absolute; left:0; top:0; width: 100vh; opacity: 0; z-index: -1" />\r\n    <img id="login-woman" src="images/login-woman.jpg" style="position: absolute; left:0; top:0; width: 100vh; opacity: 0; z-index: -1" />\r\n    <table style="width: 100%; height: 100%">\r\n      <tr style="height: 100%; width: 100%;">\r\n        <td style="position: relative; height: 100%; width: 100%; display: table">\r\n          <div style="display: table-cell; vertical-align: middle; text-align: center">\r\n            <img src="images/login-logo.svg" style="width: 65%; max-width: 240px; margin-top: 120px" />\r\n          </div>          \r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td>\r\n          <div id="login-separator"></div>\r\n          <button id="learn-more-button" class="button button-block gr-noradius" ng-click="showLearnModal()" style="margin: 0px">Learn more</button>\r\n          <button class="button button-block button-positive gr-noradius" ng-click="fbLogin()" style="margin: 0px">Log in with Facebook</button>\r\n          <div style="display: table;  width: 100%; min-height: 48px;">\r\n            <div class="padding" style="display: table-cell; vertical-align: middle; width: 100%; text-align: center; font-size: 13px; background-color: #fff">\r\n              By continuing, you agree to our <a class="gr-link" ng-click="_www(\'http://garnetroom.co/terms\')">terms of use</a> and <a class="gr-link" ng-click="_www(\'http://garnetroom.co/privacy\')">privacy policy</a>.\r\n            </div>\r\n          </div>\r\n        </td>\r\n      </tr>\r\n    </table>\r\n  </ion-content>\r\n</ion-view>'),t.put("templates/views/more.html",'<ion-view>\r\n  <ion-header-bar class="bar-positive modal-shadow">\r\n    <h1 ng-click="_scrollTop()" class="title">Account and More</h1>\r\n  </ion-header-bar>\r\n  <ion-content class="gr-content">\r\n    <div class="list">\r\n      <ion-item ng-click="_showInstructionsModal()" class="item-icon-right">\r\n        Instructions\r\n        <i class="icon ion-ios-arrow-right grey-icon"></i>\r\n      </ion-item>\r\n    </div>\r\n    <div class="gr-divider"></div>\r\n    <div class="list">     \r\n      <ion-item ng-click="_share()" class="item-icon-right">\r\n        Invite your friends\r\n        <i class="icon ion-ios-arrow-right grey-icon"></i>\r\n      </ion-item>\r\n    </div>\r\n    <div class="gr-divider"></div>      \r\n    <!--    \r\n    <div class="list">\r\n      <ion-item ng-click="rateUs()" class="item-icon-right">\r\n        Rate us on <span ng-if="isIOS">the App Store</span><span ng-if="!isIOS">Google Play</span>\r\n        <i class="icon ion-ios-arrow-right grey-icon"></i>\r\n      </ion-item>\r\n      <div class="border-16"></div>\r\n      <ion-item ng-click="likeUs()" class="item-icon-right">\r\n        Like us on Facebook\r\n        <i class="icon ion-ios-arrow-right grey-icon"></i>\r\n      </ion-item>\r\n    </div>\r\n    <div class="gr-divider"></div>\r\n      -->    \r\n    <div class="list">\r\n      <ion-item ng-click="_www(\'http://garnetroom.co/support\')" class="item-icon-right">\r\n        Support/FAQ\r\n        <i class="icon ion-ios-arrow-right grey-icon"></i>\r\n      </ion-item>\r\n      <div class="border-16"></div>\r\n      <ion-item ng-click="feedback()" class="item-icon-right">\r\n        Send feedback/report a problem\r\n        <i class="icon ion-ios-arrow-right grey-icon"></i>\r\n      </ion-item>\r\n    </div>\r\n    <div class="gr-divider"></div>\r\n    <div class="list">\r\n      <ion-item ng-click="logout()" class="item-icon-right">\r\n        Log out\r\n        <i class="icon ion-ios-arrow-right grey-icon"></i>\r\n      </ion-item>\r\n    </div>\r\n    <div class="gr-divider"></div>    \r\n    <div class="list">\r\n      <ion-item ng-click="_www(\'http://garnetroom.co/terms\')" class="item-icon-right">\r\n        Terms of use\r\n        <i class="icon ion-ios-arrow-right grey-icon"></i>\r\n      </ion-item>\r\n      <div class="border-16"></div>\r\n      <ion-item ng-click="_www(\'http://garnetroom.co/privacy\')" class="item-icon-right">\r\n        Privacy policy\r\n        <i class="icon ion-ios-arrow-right grey-icon"></i>\r\n      </ion-item>\r\n    </div>\r\n    <div class="gr-divider" style="text-align: center">\r\n      <br />\r\n      <span class="fa icon-logo" style="font-size: 72px; opacity: 0.2"></span><br /><br />\r\n      <span ng-if="isIOS">iOS</span><span ng-if="!isIOS">Android</span> version {{::version}}<span ng-if="sandbox"> dev</span><br> {{year}} Garnet Room Ltd.<br>All rights reserved.\r\n      <br /><br /><!--\r\n      <a class="gr-link" style="color:#555" ng-click="_www(\'http://garnetroom.co\')">garnetroom.co</a>\r\n      <br /><br />-->\r\n    </div>\r\n    <div class="list">\r\n      <ion-item ng-click="deactivateAccount()" class="item-icon-right">\r\n        Deactivate account\r\n        <i class="icon ion-ios-arrow-right grey-icon"></i>\r\n      </ion-item>\r\n    </div>\r\n  </ion-content>\r\n</ion-view>'),t.put("templates/views/preferences.html",'<ion-view><!--fixes range slider bug after modal opened-->\r\n  <ion-header-bar class="bar-positive modal-shadow">\r\n    <h1 ng-click="_scrollTop()" class="title">Preferences</h1>\r\n  </ion-header-bar>\r\n  <ion-header-bar ng-if="_userProgress === 3" class="bar-subheader" style="border-bottom: 1px solid #ddd; height: 45px">\r\n    <h1 class="title" style="font-size: 16px !important">Please set your preferences.</h1>\r\n  </ion-header-bar>\r\n  <ion-footer-bar ng-if="_userProgress === 3" class="bar-footer" style="padding: 0px; height: 47px; border: none">\r\n    <button ng-click="progressPreferences()" class="button button-positive gr-noradius" style="font-size: 16px; width: 100%">Done</button>\r\n  </ion-footer-bar>\r\n  <ion-content class="gr-content" ng-class="_userProgress === 3 ? \'gr-content has-subheader gr-has-continue-footer\' : \'gr-content\'">\r\n    <ion-list>\r\n      <div class="item item-toggle">\r\n        Discovery\r\n        <label class="toggle toggle-positive">\r\n          <input type="checkbox" ng-model="temp.visible">\r\n          <div class="track">\r\n            <div class="handle"></div>\r\n          </div>\r\n        </label>\r\n      </div>  \r\n    </ion-list>\r\n    <div class="gr-divider">\r\n      <span>\r\n        Disabling discovery will make you invisible to all members except those you are messaging with.\r\n        <br /><br />\r\n      </span>\r\n      <span style="font-size: 16px; font-weight: 400">I am looking for...</span>\r\n    </div>\r\n    <ion-list>\r\n      <div class="item item-toggle">\r\n        Men\r\n        <label class="toggle toggle-positive">\r\n          <input type="checkbox" ng-model="temp.gender_flt[0]" ng-click="setAllGender(0)">\r\n          <div class="track">\r\n            <div class="handle"></div>\r\n          </div>\r\n        </label>\r\n      </div>\r\n      <div class="border-16"></div>\r\n      <div class="item item-toggle">\r\n        Women\r\n        <label class="toggle toggle-positive">\r\n          <input type="checkbox" ng-model="temp.gender_flt[1]" ng-click="setAllGender(1)">\r\n          <div class="track">\r\n            <div class="handle"></div>\r\n          </div>\r\n        </label>\r\n      </div>\r\n    </ion-list>\r\n    <div class="gr-divider">\r\n      <br />\r\n      <span style="font-size: 16px; font-weight: 400">Age range<span style="float: right">{{temp.age_flt_min}} - {{temp.age_flt_max}}<span ng-if="temp.age_flt_max === 60">+</span></span></span>      \r\n    </div>\r\n    <ion-list>\r\n      <div class="item range">\r\n        <uislider floor="18" ceiling="60" ng-model-low="temp.age_flt_min" ng-model-high="temp.age_flt_max"></uislider>\r\n      </div>\r\n    </ion-list>\r\n    <div class="gr-divider">\r\n      <br />\r\n      <span style="font-size: 16px; font-weight: 400">Maximum distance<span style="float: right"><span ng-if="_unitMi">{{Math.round(temp.dist_flt/1.60934)}} mi</span><span ng-if="!_unitMi">{{temp.dist_flt}} km</span></span></span>\r\n    </div>\r\n    <ion-list>\r\n      <div class="item range">\r\n        <uislider highlight="left" floor="2" ceiling="200" ng-model="temp.dist_flt"></uislider>\r\n      </div>\r\n    </ion-list>\r\n    <div class="gr-divider">\r\n      <br />\r\n      <span style="font-size: 16px; font-weight: 400">Push notifications</span>\r\n    </div>\r\n    <ion-list>\r\n      <div class="item item-toggle">\r\n        Matches\r\n        <label class="toggle toggle-positive">\r\n          <input type="checkbox" ng-model="temp.push_match">\r\n          <div class="track">\r\n            <div class="handle"></div>\r\n          </div>\r\n        </label>\r\n      </div>\r\n      <div class="border-16"></div>\r\n      <div class="item item-toggle">\r\n        Messages\r\n        <label class="toggle toggle-positive">\r\n          <input type="checkbox" ng-model="temp.push_msg">\r\n          <div class="track">\r\n            <div class="handle"></div>\r\n          </div>\r\n        </label>\r\n      </div>\r\n    </ion-list>\r\n    <div class="gr-divider">\r\n      You may need to swipe through a few potential matches to see changes to your preferences taking effect.\r\n    </div>\r\n  </ion-content>\r\n\r\n  <div ng-if="_userProgress < 3" >\r\n    <ion-content>\r\n      <div style="position: absolute; width: 100%; height: 100%; background-color: #fff; display: table; top: 0; left: 0">\r\n        <div style="text-align: center; display: table-cell; vertical-align: middle">\r\n          <div style="font-size: 16px; padding: 16px">\r\n            This tab will become available when you have filled <span style="white-space:nowrap">out your profile.</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ion-content>\r\n  </div>\r\n</ion-view>'),t.put("templates/views/profile.html",'<ion-view>\r\n  <ion-header-bar class="bar-positive modal-shadow">    \r\n    <h1 ng-click="_scrollTop()" class="title">Profile</h1>    \r\n  </ion-header-bar>\r\n  <ion-header-bar ng-if="_userProgress === 2" class="bar-subheader" style="border-bottom: 1px solid #ddd; height: 45px">\r\n    <h1 class="title" style="font-size: 16px !important">Please fill out your profile.</h1>\r\n  </ion-header-bar>\r\n  <ion-footer-bar ng-if="_userProgress === 2" class="bar-footer" style="padding: 0px; height: 47px; border: none">\r\n    <button class="button button-positive gr-noradius" style="font-size: 16px; width: 100%" ng-click="progressProfile()">Continue</button>\r\n  </ion-footer-bar>\r\n  <ion-content id="profile-content" delegate-handle="profileScroll" ng-class="_userProgress === 2 ? \'gr-content has-subheader gr-has-continue-footer\' : \'gr-content\'">    \r\n    <div class="list">\r\n      <div class="item gr-item" style="padding: 0px; z-index: 99; overflow: visible">\r\n\r\n        <div style="position: relative; top: 0; left: 0; width: 100%; padding: 8px">\r\n\r\n          <div style="display: flex">\r\n            <div style="position: relative; width: {{::_picSize}}px; height: {{::_picSize}}px; margin: 8px; border: 1px solid #ddd; border-radius: 2px">\r\n              <img src="images/dummy.png" style="width: 100%; height: auto; border-radius: 2px" />\r\n            </div>\r\n            <div style="position: relative; width: {{::_picSize}}px; height: {{::_picSize}}px; margin: 8px; border: 1px solid #ddd; border-radius: 2px">\r\n              <img src="images/dummy.png" style="width: 100%; height: auto; border-radius: 2px" />\r\n            </div>\r\n            <div style="position: relative; width: {{::_picSize}}px; height: {{::_picSize}}px; margin: 8px; border: 1px solid #ddd; border-radius: 2px">\r\n              <img src="images/dummy.png" style="width: 100%; height: auto; border-radius: 2px" />              \r\n            </div>\r\n          </div>\r\n\r\n          <div style="display: flex">\r\n            <div style="position: relative; width: {{::_picSize}}px; height: {{::_picSize}}px; margin: 8px; border: 1px solid #ddd; border-radius: 2px">\r\n              <img src="images/dummy.png" style="width: 100%; height: auto; border-radius: 2px" />              \r\n            </div>\r\n            <div style="position: relative; width: {{::_picSize}}px; height: {{::_picSize}}px; margin: 8px; border: 1px solid #ddd; border-radius: 2px">\r\n              <img src="images/dummy.png" style="width: 100%; height: auto; border-radius: 2px" />              \r\n            </div>\r\n            <div style="position: relative; width: {{::_picSize}}px; height: {{::_picSize}}px; margin: 8px; border: 1px solid #ddd; border-radius: 2px">\r\n              <img src="images/dummy.png" style="width: 100%; height: auto; border-radius: 2px" />              \r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n\r\n        <div style="position: absolute; top: 0; left: 0; width: 100%; padding: 8px">\r\n\r\n          <div style="display: flex">\r\n            <div id="pic0" style="position: relative; width: {{::_picSize}}px; height: {{::_picSize}}px; margin: 8px">\r\n              <div ng-show="_user.pics.length <= 0 && !isEditing" ng-click="addPic(0)" class="gr-button" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%">\r\n                <div ng-if="_user.pics.length <= 0 && !isEditing" style="background-color: #ddd; width: 1px; height: 50%; position: absolute; margin: auto; left: 0; right: 0; top: 0; bottom: 0"></div>\r\n                <div ng-if="_user.pics.length <= 0 && !isEditing" style="background-color: #ddd; width: 50%; height: 1px; position: absolute; margin: auto; left: 0; right: 0; top: 0; bottom: 0"></div>\r\n              </div>\r\n              <div ng-if="!picLoading[0] && _user.pics.length > 0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff">\r\n                <img gr-img ng-src="{{_picUrls[0]}}" style="width: 100%; height: auto; border-radius: 2px" />\r\n                <div style="font-size: 16px; line-height: 14px; padding: 8px; position: absolute; left: 0; bottom: 0; height: 30px; width: 100%; background: rgba(0, 0, 0, 0.6); color: #fff; border-bottom-left-radius: 2px; border-bottom-right-radius: 2px">\r\n                  <span class="fa fa-sort" style="opacity: 0.4"></span> {{_user.pics[0].score}}\r\n                  <span ng-switch="isEditing">\r\n                    <span ng-if="!isEditing" ng-click="addPic(0)" class="profile-pic-button gr-button" style="float: right"><span ng-switch-when="false" class="fa fa-pencil"></span></span>\r\n                    <span ng-if="isEditing" ng-click="delPic(0)" class="profile-pic-button gr-button" style="float: right"><span ng-switch-when="true" class="fa fa-trash"></span></span>\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <div ng-if="picLoading[0]" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff; border: 1px solid #ddd; border-radius: 2px">\r\n                <ion-spinner class="pic-spinner" icon="ios"></ion-spinner>\r\n              </div>\r\n            </div>\r\n            <div id="pic1" style="position: relative; width: {{::_picSize}}px; height: {{::_picSize}}px; margin: 8px">\r\n              <div ng-show="_user.pics.length <= 1 && !isEditing" ng-click="addPic(1)" class="gr-button" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%">\r\n                <div ng-if="_user.pics.length <= 1 && !isEditing" style="background-color: #ddd; width: 1px; height: 50%; position: absolute; margin: auto; left: 0; right: 0; top: 0; bottom: 0"></div>\r\n                <div ng-if="_user.pics.length <= 1 && !isEditing" style="background-color: #ddd; width: 50%; height: 1px; position: absolute; margin: auto; left: 0; right: 0; top: 0; bottom: 0"></div>\r\n              </div>\r\n              <div ng-if="!picLoading[1] && _user.pics.length > 1" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff">\r\n                <img gr-img ng-src="{{_picUrls[1]}}" style="width: 100%; height: auto; border-radius: 2px" />\r\n                <div style="font-size: 16px; line-height: 14px; padding: 8px; position: absolute; left: 0; bottom: 0; height: 30px; width: 100%; background: rgba(0, 0, 0, 0.6); color: #fff; border-bottom-left-radius: 2px; border-bottom-right-radius: 2px">\r\n                  <span class="fa fa-sort" style="opacity: 0.4"></span> {{_user.pics[1].score}}\r\n                  <span ng-switch="isEditing">\r\n                    <span ng-if="!isEditing" ng-click="addPic(1)" class="profile-pic-button gr-button" style="float: right"><span ng-switch-when="false" class="fa fa-pencil"></span></span>\r\n                    <span ng-if="isEditing" ng-click="delPic(1)" class="profile-pic-button gr-button" style="float: right"><span ng-switch-when="true" class="fa fa-trash"></span></span>\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <div ng-if="picLoading[1]" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff; border: 1px solid #ddd; border-radius: 2px">\r\n                <ion-spinner class="pic-spinner" icon="ios"></ion-spinner>\r\n              </div>\r\n            </div>\r\n            <div id="pic2" style="position: relative; width: {{::_picSize}}px; height: {{::_picSize}}px; margin: 8px">\r\n              <div ng-show="_user.pics.length <= 2 && !isEditing" ng-click="addPic(2)" class="gr-button" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%">\r\n                <div ng-if="_user.pics.length <= 2 && !isEditing" style="background-color: #ddd; width: 1px; height: 50%; position: absolute; margin: auto; left: 0; right: 0; top: 0; bottom: 0"></div>\r\n                <div ng-if="_user.pics.length <= 2 && !isEditing" style="background-color: #ddd; width: 50%; height: 1px; position: absolute; margin: auto; left: 0; right: 0; top: 0; bottom: 0"></div>\r\n              </div>\r\n              <div ng-if="!picLoading[2] && _user.pics.length > 2" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff">\r\n                <img gr-img ng-src="{{_picUrls[2]}}" style="width: 100%; height: auto; border-radius: 2px" />\r\n                <div style="font-size: 16px; line-height: 14px; padding: 8px; position: absolute; left: 0; bottom: 0; height: 30px; width: 100%; background: rgba(0, 0, 0, 0.6); color: #fff; border-bottom-left-radius: 2px; border-bottom-right-radius: 2px">\r\n                  <span class="fa fa-sort" style="opacity: 0.4"></span> {{_user.pics[2].score}}\r\n                  <span ng-switch="isEditing">\r\n                    <span ng-if="!isEditing" ng-click="addPic(2)" class="profile-pic-button gr-button" style="float: right"><span ng-switch-when="false" class="fa fa-pencil"></span></span>\r\n                    <span ng-if="isEditing" ng-click="delPic(2)" class="profile-pic-button gr-button" style="float: right"><span ng-switch-when="true" class="fa fa-trash"></span></span>\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <div ng-if="picLoading[2]" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff; border: 1px solid #ddd; border-radius: 2px">\r\n                <ion-spinner class="pic-spinner" icon="ios"></ion-spinner>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div style="display: flex">\r\n            <div id="pic3" style="position: relative; width: {{::_picSize}}px; height: {{::_picSize}}px; margin: 8px">\r\n              <div ng-show="_user.pics.length <= 3 && !isEditing" ng-click="addPic(3)" class="gr-button" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%">\r\n                <div ng-if="_user.pics.length <= 3 && !isEditing" style="background-color: #ddd; width: 1px; height: 50%; position: absolute; margin: auto; left: 0; right: 0; top: 0; bottom: 0"></div>\r\n                <div ng-if="_user.pics.length <= 3 && !isEditing" style="background-color: #ddd; width: 50%; height: 1px; position: absolute; margin: auto; left: 0; right: 0; top: 0; bottom: 0"></div>\r\n              </div>\r\n              <div ng-if="!picLoading[3] && _user.pics.length > 3" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff">\r\n                <img gr-img ng-src="{{_picUrls[3]}}" style="width: 100%; height: auto; border-radius: 2px" />\r\n                <div style="font-size: 16px; line-height: 14px; padding: 8px; position: absolute; left: 0; bottom: 0; height: 30px; width: 100%; background: rgba(0, 0, 0, 0.6); color: #fff; border-bottom-left-radius: 2px; border-bottom-right-radius: 2px">\r\n                  <span class="fa fa-sort" style="opacity: 0.4"></span> {{_user.pics[3].score}}\r\n                  <span ng-switch="isEditing">\r\n                    <span ng-if="!isEditing" ng-click="addPic(3)" class="profile-pic-button gr-button" style="float: right"><span ng-switch-when="false" class="fa fa-pencil"></span></span>\r\n                    <span ng-if="isEditing" ng-click="delPic(3)" class="profile-pic-button gr-button" style="float: right"><span ng-switch-when="true" class="fa fa-trash"></span></span>\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <div ng-if="picLoading[3]" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff; border: 1px solid #ddd; border-radius: 2px">\r\n                <ion-spinner class="pic-spinner" icon="ios"></ion-spinner>\r\n              </div>\r\n            </div>\r\n            <div id="pic4" style="position: relative; width: {{::_picSize}}px; height: {{::_picSize}}px; margin: 8px">\r\n              <div ng-show="_user.pics.length <= 4 && !isEditing" ng-click="addPic(4)" class="gr-button" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%">\r\n                <div ng-if="_user.pics.length <= 4 && !isEditing" style="background-color: #ddd; width: 1px; height: 50%; position: absolute; margin: auto; left: 0; right: 0; top: 0; bottom: 0"></div>\r\n                <div ng-if="_user.pics.length <= 4 && !isEditing" style="background-color: #ddd; width: 50%; height: 1px; position: absolute; margin: auto; left: 0; right: 0; top: 0; bottom: 0"></div>\r\n              </div>\r\n              <div ng-if="!picLoading[4] && _user.pics.length > 4" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff">\r\n                <img gr-img ng-src="{{_picUrls[4]}}" style="width: 100%; height: auto; border-radius: 2px" />\r\n                <div style="font-size: 16px; line-height: 14px; padding: 8px; position: absolute; left: 0; bottom: 0; height: 30px; width: 100%; background: rgba(0, 0, 0, 0.6); color: #fff; border-bottom-left-radius: 2px; border-bottom-right-radius: 2px">\r\n                  <span class="fa fa-sort" style="opacity: 0.4"></span> {{_user.pics[4].score}}\r\n                  <span ng-switch="isEditing">\r\n                    <span ng-if="!isEditing" ng-click="addPic(4)" class="profile-pic-button gr-button" style="float: right"><span ng-switch-when="false" class="fa fa-pencil"></span></span>\r\n                    <span ng-if="isEditing" ng-click="delPic(4)" class="profile-pic-button gr-button" style="float: right"><span ng-switch-when="true" class="fa fa-trash"></span></span>\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <div ng-if="picLoading[4]" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff; border: 1px solid #ddd; border-radius: 2px">\r\n                <ion-spinner class="pic-spinner" icon="ios"></ion-spinner>\r\n              </div>\r\n            </div>\r\n            <div id="pic5" style="position: relative; width: {{::_picSize}}px; height: {{::_picSize}}px; margin: 8px">\r\n              <div ng-show="_user.pics.length <= 5 && !isEditing" ng-click="addPic(5)" class="gr-button" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%">\r\n                <div ng-if="_user.pics.length <= 5 && !isEditing" style="background-color: #ddd; width: 1px; height: 50%; position: absolute; margin: auto; left: 0; right: 0; top: 0; bottom: 0"></div>\r\n                <div ng-if="_user.pics.length <= 5 && !isEditing" style="background-color: #ddd; width: 50%; height: 1px; position: absolute; margin: auto; left: 0; right: 0; top: 0; bottom: 0"></div>\r\n              </div>\r\n              <div ng-if="!picLoading[5] && _user.pics.length > 5" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff">\r\n                <img gr-img ng-src="{{_picUrls[5]}}" style="width: 100%; height: auto; border-radius: 2px" />\r\n                <div style="font-size: 16px; line-height: 14px; padding: 8px; position: absolute; left: 0; bottom: 0; height: 30px; width: 100%; background: rgba(0, 0, 0, 0.6); color: #fff; border-bottom-left-radius: 2px; border-bottom-right-radius: 2px">\r\n                  <span class="fa fa-sort" style="opacity: 0.4"></span> {{_user.pics[5].score}}\r\n                  <span ng-switch="isEditing">\r\n                    <span ng-if="!isEditing" ng-click="addPic(5)" class="profile-pic-button gr-button" style="float: right"><span ng-switch-when="false" class="fa fa-pencil"></span></span>\r\n                    <span ng-if="isEditing" ng-click="delPic(5)" class="profile-pic-button gr-button" style="float: right"><span ng-switch-when="true" class="fa fa-trash"></span></span>\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <div ng-if="picLoading[5]" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff; border: 1px solid #ddd; border-radius: 2px">\r\n                <ion-spinner class="pic-spinner" icon="ios"></ion-spinner>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n        <div style="padding: 0px 16px 16px 16px">\r\n          <span ng-if="!isEditing" >Total score:<span style="margin-left: 10px; font-weight: 700">{{_user.score}}</span></span>\r\n          &nbsp; <!--keeps height-->  \r\n          <button ng-show="_user.pics.length > 1 && !saving" class="gr-button arrange-button" ng-click="toggleEditing()">\r\n            <span ng-if="!isEditing">Rearrange/delete</span>\r\n            <span ng-if="isEditing">Done</span>\r\n          </button>\r\n        </div>\r\n\r\n      </div>\r\n    </div>\r\n    <div class="gr-divider">\r\n      <span ng-if="!isEditing">\r\n        The score of each photo is calculated from the difference in up- and downvotes by other members.\r\n      </span>        \r\n      <br /><br />\r\n    </div>\r\n    <div ng-if="!isEditing" class="list">\r\n      <ion-item ng-click="showPersonalModal()" class="item-icon-right">\r\n        Add personal details\r\n        <i class="icon ion-ios-arrow-right grey-icon"></i>\r\n      </ion-item>\r\n      <div class="border-16"></div>\r\n      <ion-item ng-click="showDetailModal()" class="item-icon-right">\r\n        View your full profile\r\n        <i class="icon ion-ios-arrow-right grey-icon"></i>\r\n      </ion-item>\r\n      <div class="border-16"></div>      \r\n      <ion-item ng-click="syncFb()" class="item-icon-right">\r\n        Refresh education, occupation...\r\n        <i class="icon ion-ios-arrow-right grey-icon"></i>\r\n      </ion-item>\r\n    </div>\r\n    <div ng-if="!isEditing" class="gr-divider">\r\n      Education entries are primarily sorted by academic degree and secondarily by date of graduation. For occupation entries the Facebook order is retained.\r\n      <br /><br />\r\n    </div>\r\n    <div class="list" ng-if="!isEditing" >\r\n      <label class="item item-input item-select">\r\n        <div class="input-label">\r\n          Display distance in...\r\n        </div>\r\n        <select ng-model="units.unitMi" ng-change="saveUnitMi()">\r\n          <option value="false">Kilometers</option>\r\n          <option value="true">Miles</option>\r\n        </select>\r\n      </label>\r\n      <div class="border-16"></div>\r\n      <label class="item item-input item-select">\r\n        <div class="input-label">\r\n          Display height in...\r\n        </div>\r\n        <select ng-model="units.unitFt" ng-change="saveUnitFt()">\r\n          <option value="false">Centimeters</option>\r\n          <option value="true">Feet and inches</option>\r\n        </select>\r\n      </label>\r\n    </div>\r\n  </ion-content>\r\n</ion-view>'),
t.put("templates/views/update.html",'<ion-view>\r\n  <ion-content>\r\n    <div style="position: absolute; width: 100%; height: 100%; background-color: #fff; display: table; padding-bottom: 47px; top: 0; left: 0">\r\n      <div style="text-align: center; display: table-cell; vertical-align: middle">\r\n        <div style="font-size: 72px; line-height: 72px; opacity: 0.25">\r\n          <span class="fa icon-logo gr-mid"></span>\r\n        </div>\r\n        <div class="padding-top padding-left padding-right">\r\n          This version of Garnet Room is out of date.\r\n        </div>\r\n      </div>\r\n      <button class="button button-block button-positive gr-noradius" ng-click="appPage()" style="position: absolute; left: 0; bottom: 1px; margin: 0px">\r\n        Get the latest version\r\n      </button>\r\n    </div>\r\n  </ion-content>\r\n</ion-view>')}]);